
<!DOCTYPE HTML>
<html>
<head>
	<meta charset="utf-8">
	<title>Hell Walkthrough – Part 2 - FourFourFourFour</title>
	<meta name="author" content="recrudesce">

	
	<meta name="description" content="Part 1 | Part 2 | Part 3 | Part 4 | Part 5 So, yesterday we got a shell on Hell as www-data. Today we&rsquo;ll escalate through some of the users on &hellip;">
	
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

	<link href="/atom.xml" rel="alternate" title="FourFourFourFour" type="application/atom+xml">
	<link rel="canonical" href="">
	<link href="/favicon.png" rel="shortcut icon">
	<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
	<script async="true" src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
	
</head>


<body>
	<header id="header" class="inner"><h1><a href="/">FourFourFourFour</a></h1>
<nav id="main-nav"><ul class="main">
	<li><a href="/">Blog</a></li>
	<li><a href="/archives">Archives</a></li>
</ul>
</nav>
<nav id="mobile-nav">
	<div class="alignleft menu">
		<a class="button">Menu</a>
		<div class="container"><ul class="main">
	<li><a href="/">Blog</a></li>
	<li><a href="/archives">Archives</a></li>
</ul>
</div>
	</div>
	<div class="alignright search">
		<a class="button"></a>
		<div class="container">
			<form action="https://www.google.com/search" method="get">
				<input type="text" name="q" results="0">
				<input type="hidden" name="q" value="site:recrudesce.github.io">
			</form>
		</div>
	</div>
</nav>
<nav id="sub-nav" class="alignright">
	<div class="social">
		
		
		
		<a class="twitter" href="http://twitter.com/recrudesce" title="Twitter">Twitter</a>
		
		
    
		
		
		
		
		
		<a class="rss" href="/atom.xml" title="RSS">RSS</a>
		
    
	</div>
	<form class="search" action="https://www.google.com/search" method="get">
		<input class="alignright" type="text" name="q" results="0">
		<input type="hidden" name="q" value="site:recrudesce.github.io">
	</form>
</nav>

</header>
	
		
	
	<div id="content" class="inner"><article class="post">
	<h2 class="title">Hell Walkthrough – Part 2</h2>
	<div class="entry-content"><p><a href="http://fourfourfourfour.co/2014/07/17/hell-walkthrough-part-1/">Part 1</a> | Part 2 | <a href="http://fourfourfourfour.co/2014/07/19/hell-walkthrough-part-3/">Part 3</a> | <a href="http://fourfourfourfour.co/2014/07/20/hell-walkthrough-part-4/">Part 4</a> | <a href="http://fourfourfourfour.co/2014/07/21/hell-walkthrough-part-5/">Part 5</a></p>

<p>So, yesterday we got a shell on Hell as www-data. Today we&rsquo;ll escalate through some of the users on our quest to root.  If you&rsquo;ve not read <a href="http://fourfourfourfour.co/2014/07/17/hell-walkthrough-part-1/">Part 1</a>, I suggest you do so now.  I&rsquo;ll wait.  Go on, don&rsquo;t be shy, I&rsquo;ll still be here when you get back.</p>

<p>Done ?  Great - let us continue.</p>

<!-- more -->


<p>Catting /etc/passwd gives us a list of users that are potentially useful</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>cat /etc/passwd
</span><span class='line'>cat /etc/passwd
</span><span class='line'>root:x:0:0:root:/root:/bin/bash
</span><span class='line'>george:x:1000:1000:george,,,:/home/george:/bin/bash
</span><span class='line'>jack:x:1001:1001::/home/jack:/bin/sh
</span><span class='line'>milk_4_life:x:1002:1002::/home/milk_4_life:/bin/sh
</span><span class='line'>developers:x:1003:1003::/home/developers:/bin/sh
</span><span class='line'>bazza:x:1004:1004::/home/bazza:/bin/sh
</span><span class='line'>oj:x:1005:1005::/home/oj:/bin/sh
</span></code></pre></td></tr></table></div></figure>


<hr />

<h2>Imagine Jack and Jill, But With Half the Cast Replaced with a Cardboard Cutout of g0tmi1k</h2>

<p>Escalating from the www-data user to the jack user is pretty inconsequential. People who write web sites, especially disturbing ones such as this, will usually not bother to create separate accounts for things such as database logins.</p>

<p>A quick grep on the files in /super_secret_login_path_muhahaha/ for the word &ldquo;password&rdquo; results in the following</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>grep password /var/www/super_secret_login_path_muhahaha/*
</span><span class='line'>index.php:&lt;INPUT <span class="nv">name</span><span class="o">=</span><span class="s2">&quot;password&quot;</span> <span class="nv">id</span><span class="o">=</span><span class="s2">&quot;password&quot;</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;password&quot;</span> <span class="nv">value</span><span class="o">=</span><span class="s2">&quot;&quot;</span>/&gt;
</span><span class='line'>login.php:    <span class="nv">$password</span> <span class="o">=</span> mysql_escape_string<span class="o">(</span><span class="nv">$_POST</span><span class="o">[</span><span class="s2">&quot;password&quot;</span><span class="o">])</span><span class="p">;</span>
</span><span class='line'>login.php:    // mysql_connect<span class="o">(</span><span class="s2">&quot;127.0.0.1&quot;</span>, <span class="s2">&quot;Jack&quot;</span>, <span class="s2">&quot;zgcR6mU6pX&quot;</span><span class="o">)</span> or die <span class="o">(</span><span class="s2">&quot;Server Error&quot;</span><span class="o">)</span><span class="p">;</span> I<span class="s1">&#39;ll change this back once development is done. Got sick of typing my password.</span>
</span><span class='line'><span class="s1">login.php:   $sql = &quot;SELECT COUNT(*) FROM users WHERE username=&#39;</span><span class="nv">$username</span><span class="s1">&#39; and password=&#39;</span><span class="nv">$password</span><span class="err">&#39;</span><span class="s2">&quot;;</span>
</span><span class='line'><span class="s2">personal.php:&lt;INPUT name=&quot;</span>password<span class="s2">&quot; id=&quot;</span>password<span class="s2">&quot; type=&quot;</span>password<span class="s2">&quot; value=&quot;</span><span class="err">&quot;</span>/&gt;
</span></code></pre></td></tr></table></div></figure>


<p>Oooh, what do I spy with my little eye ? Could that be Jack&rsquo;s password commented out in login.php ? Let us try this password&hellip;</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>su jack
</span><span class='line'>Password: zgcR6mU6pX
</span><span class='line'>
</span><span class='line'><span class="nv">$ </span>whoami
</span><span class='line'>jack
</span><span class='line'><span class="err">$</span>
</span></code></pre></td></tr></table></div></figure>


<p>Well, that was easy. But then the 2nd hurdle usually is - you kinda get cocky after clearing the first one, that the second one is jumped based on pure thrill. Now we get to trip over on every hurdle between us and the finish line. Get the first aid kit ready, we&rsquo;re going to need it.</p>

<hr />

<h2>Got Milk ? Want Any ?</h2>

<p>Poking around Jack&rsquo;s home folder is like walking into a public toilet while bursting for a wee - you don&rsquo;t really want to touch anything, but have to else you&rsquo;re going to have problems.</p>

<p>The first thing that draws my eye is the g0tmi1k_pics folder. It&rsquo;s somewhere you know you don&rsquo;t want to go, but seems to have this strange come-hither vibe about it. It&rsquo;s like a car crash&hellip; gruesome but you can&rsquo;t help but look. So I did. Now I wish I didn&rsquo;t. Exhibit A, and B, and C.</p>

<p><a href="http://fourfourfourfour.co/wp-content/uploads/2014/07/1.jpg"><img src="http://fourfourfourfour.co/wp-content/uploads/2014/07/1.jpg" alt="1" /></a></p>

<p><a href="http://fourfourfourfour.co/wp-content/uploads/2014/07/2.jpg"><img src="http://fourfourfourfour.co/wp-content/uploads/2014/07/2.jpg" alt="2" /></a></p>

<p><a href="http://fourfourfourfour.co/wp-content/uploads/2014/07/3.jpg"><img src="http://fourfourfourfour.co/wp-content/uploads/2014/07/3.jpg" alt="3" /></a></p>

<p>Yeah&hellip;
Jack, you&rsquo;re a strange one, I&rsquo;ll give you that. Hang on, I think I can hear the men in white coats knocking. Yup, they&rsquo;re asking for you - shall I tell them you&rsquo;re &ldquo;out&rdquo; ?</p>

<p>So, while Jack might reuse passwords, he&rsquo;s sensible enough to use PGP when sending emails. /var/mail/jack/received contains an email, which is encrypted.</p>

<p>[plain]
&mdash;&ndash;BEGIN PGP MESSAGE&mdash;&ndash;
Version: BCPG C# v1.6.1.0</p>

<p>hQEMA726wSU/GKsKAQf/ZnGxyaHQ6wMhSzpbn2J2uVKoPFS3tHdnBzJ18kswBwOm
yff3Joe5RTtMgdjydD+37DSg6SikjcdzJiHV3y5QHqxVcNt5xo0BdYNCWoqjdMzJ
3g50VEwMg5DZwLvTmUr4f+CJ7bc/Cv2hHazKXnT7s71lqBLSCCsNwZuWpxYW1OMX
7CNE92QXayltmQ0GLajIMtzmGlszgwQkVjQ2h9wMGelVYHi5hYsEZzIdh6/9Jo24
rerlq1CY6/T70KsY6GyBoU3iKFgsIkwcb6whrlR/6SCK2vNmLlz2AfDSITYY+6vZ
MWXhiYbZSRyHq7gaYRKS6kzG6uLlsyq4YnQzhz8M+sm4dePDBvs7U6yAPJf4oAAH
9o01Fp3IJ1isvVMH5Fr8MwQjOAuo6Yh6TwbOrI/MVpphJQja8gDKVYr2tlqNS5me
V8xJ7ZUxsh67w/5s5s1JgEDQt+f4wckBc8Dx5k9SbS9iRUbZ0oLJ3IM8cUj3CDoo
svsh0u4ZWj4SrLsEdErcNX6gGihRl/xs3qdVOpXtesSvxEQcWHLqtMY94tb29faD
+oQPjG3V4cSY5r566esUAlCn7ooYyx6Dug==
=svWU
&mdash;&ndash;END PGP MESSAGE&mdash;&ndash;</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>As suspected, Jack uses PGP on the <span class="nb">local </span>host, therefore his PGP keys are stored in /home/jack/.pgp, <span class="nb">complete </span>with a note giving us a password hint.
</span></code></pre></td></tr></table></div></figure>


<p> bash</p>

<p>$ ls -l .pgp
ls -l .pgp
total 12
-rwx&mdash;&mdash; 1 jack jack   39 Jun 18 12:35 note
-rwx&mdash;&mdash; 1 jack jack 1802 Jun 18 12:20 pgp.priv
-rwx&mdash;&mdash; 1 jack jack  890 Jun 18 12:24 pgp.pub
$ cat .pgp/note
The usual password as with everything.
$</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>We can assume the password is either **g0tmi1k69** or **zgcR6mU6pX**. GPG is installed, so the next logical step is to try and decrypt the email using either of these two passwords and Jack<span class="err">&#39;</span>s PGP private key.
</span></code></pre></td></tr></table></div></figure>


<p> bash</p>

<p>$ gpg &ndash;import .pgp/pgp.priv
gpg: key 3F18AB0A: secret key imported
gpg: /home/jack/.gnupg/trustdb.gpg: trustdb created
gpg: key 3F18AB0A: public key &ldquo;<a href="&#109;&#x61;&#x69;&#108;&#x74;&#x6f;&#x3a;&#x6a;&#97;&#x63;&#x6b;&#x40;&#99;&#x6f;&#119;&#108;&#111;&#x76;&#x65;&#114;&#x73;&#46;&#99;&#111;&#109;">&#x6a;&#97;&#99;&#x6b;&#x40;&#x63;&#x6f;&#x77;&#108;&#x6f;&#118;&#x65;&#114;&#x73;&#46;&#99;&#111;&#x6d;</a>&rdquo; imported
gpg: Total number processed: 1
gpg:               imported: 1  (RSA: 1)
gpg:       secret keys read: 1
gpg:   secret keys imported: 1
$ gpg -o email.txt /var/mail/jack/received/message.eml</p>

<p>You need a passphrase to unlock the secret key for
user: &ldquo;<a href="&#109;&#x61;&#x69;&#108;&#116;&#111;&#58;&#106;&#97;&#99;&#107;&#64;&#99;&#111;&#x77;&#108;&#x6f;&#118;&#x65;&#114;&#x73;&#x2e;&#x63;&#x6f;&#x6d;">&#x6a;&#97;&#x63;&#x6b;&#x40;&#99;&#111;&#119;&#108;&#111;&#118;&#101;&#114;&#x73;&#46;&#99;&#x6f;&#x6d;</a>&rdquo;</p>

<p>2048-bit RSA key, ID 3F18AB0A, created 2014-06-18</p>

<p>Enter passphrase: g0tmi1k69
gpg: WARNING: cipher algorithm CAST5 not found in recipient preferences
gpg: encrypted with 2048-bit RSA key, ID 3F18AB0A, created 2014-06-18
      &ldquo;<a href="&#x6d;&#x61;&#105;&#x6c;&#116;&#111;&#x3a;&#106;&#97;&#99;&#x6b;&#x40;&#x63;&#x6f;&#119;&#108;&#111;&#x76;&#x65;&#114;&#x73;&#x2e;&#x63;&#111;&#x6d;">&#x6a;&#x61;&#99;&#107;&#64;&#x63;&#x6f;&#119;&#x6c;&#111;&#118;&#x65;&#x72;&#x73;&#x2e;&#99;&#111;&#x6d;</a>&rdquo;
gpg: WARNING: message was not integrity protected
$ cat email.txt
Ok Jack. I&rsquo;ve created the account &lsquo;milk_4_life&rsquo; as per your request. Please stop emailing me about this now or I&rsquo;m going to talk to HR like we discussed.</p>

<p>The password is &lsquo;4J0WWvL5nS&rsquo;</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>Thank you, Jack, <span class="k">for</span> being a predictable - yet persistent - weirdo. A quick hop and a skip over to the worryingly named milk_4_life account and we can carry.
</span></code></pre></td></tr></table></div></figure>


<p> bash</p>

<p>$ su milk_4_life
Password: 4J0WWvL5nS</p>

<p>$ whoami
milk_4_life
$
&#8220;`</p>

<p>Tomorrow we&rsquo;ll play a game. Oooh, cryptic.</p>
</div>


<div class="meta">
	<div class="date">








  


<time datetime="2014-07-18T21:27:04+01:00" pubdate data-updated="true"></time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/vms/'>vm&#8217;s</a>


</div>
	
</div>
</article>

	<div class="share">
	<div class="addthis_toolbox addthis_default_style ">
		
		
		<a class="addthis_button_tweet"></a>
		
		
		
	</div>
	
</div>


</div>
	<footer id="footer" class="inner">Copyright &copy; 2015

    recrudesce

</footer>
	<script src="/javascripts/slash.js"></script>
<script src="/javascripts/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
	$('.fancybox').fancybox();
})(jQuery);
</script> <!-- Delete or comment this line to disable Fancybox -->






</body>
</html>