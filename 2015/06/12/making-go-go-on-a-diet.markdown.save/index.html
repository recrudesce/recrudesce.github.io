
<!DOCTYPE HTML>
<html>
<head>
	<meta charset="utf-8">
	<title>Making Go Go on a Diet - FourFourFourFour</title>
	<meta name="author" content="recrudesce">

	
	<meta name="description" content="Recently I decided to look into the Go language - this was purely due to my inquisitive nature, and I thought it'd be fun to learn another language. &hellip;">
	
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

	<link href="/atom.xml" rel="alternate" title="FourFourFourFour" type="application/atom+xml">
	<link rel="canonical" href="">
	<link href="/favicon.png" rel="shortcut icon">
	<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
	<script async="true" src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
	
</head>


<body>
	<header id="header" class="inner"><h1><a href="/">FourFourFourFour</a></h1>
<nav id="main-nav"><ul class="main">
	<li><a href="/">Blog</a></li>
	<li><a href="/archives">Archives</a></li>
</ul>
</nav>
<nav id="mobile-nav">
	<div class="alignleft menu">
		<a class="button">Menu</a>
		<div class="container"><ul class="main">
	<li><a href="/">Blog</a></li>
	<li><a href="/archives">Archives</a></li>
</ul>
</div>
	</div>
	<div class="alignright search">
		<a class="button"></a>
		<div class="container">
			<form action="https://www.google.com/search" method="get">
				<input type="text" name="q" results="0">
				<input type="hidden" name="q" value="site:recrudesce.github.io">
			</form>
		</div>
	</div>
</nav>
<nav id="sub-nav" class="alignright">
	<div class="social">
		
		
		
		<a class="twitter" href="http://twitter.com/recrudesce" title="Twitter">Twitter</a>
		
		
    
		
		
		
		
		
		<a class="rss" href="/atom.xml" title="RSS">RSS</a>
		
    
	</div>
	<form class="search" action="https://www.google.com/search" method="get">
		<input class="alignright" type="text" name="q" results="0">
		<input type="hidden" name="q" value="site:recrudesce.github.io">
	</form>
</nav>

</header>
	
		
	
	<div id="content" class="inner"><article class="post">
	<h2 class="title">Making Go Go on a Diet</h2>
	<div class="entry-content">Recently I decided to look into the Go language - this was purely due to my inquisitive nature, and I thought it&#8217;d be fun to learn another language.  However, there&#8217;s some stranege things going on when you compile the source.
<!-- more -->

I wrote a small piece of code that interacted with the Twitter API to get the URL of an image included in a tweet, it&#8217;s 28 lines long - filesize is not particularly big either - 720 bytes.

&#8220;` bash
root@kali:~/Go/src/twimg# ls -lah
total 12K
drwxr-xr-x 2 root root 4.0K Jun 12 14:13 .
drwxr-xr-x 3 root root 4.0K Jun 12 14:13 ..
-rw-r&#8211;r&#8211; 1 root root  720 Jun 12 14:13 twimg.go
&#8220;`

The &#8220;`go build&#8220;` command,, by default will compile with Debug information, and Symbols.  Additionally, it will include the Go runtime, so that the binary will execute in environments that do not have Go installed.
Here&#8217;s the above sourcecode compiled with the default &#8220;`go build&#8220;` command

&#8220;` bash
root@kali:~/Go/src/twimg# go build
root@kali:~/Go/src/twimg# ls -lah
total 6.8M
drwxr-xr-x 2 root root 4.0K Jun 12 14:26 .
drwxr-xr-x 4 root root 4.0K Jun 12 14:18 ..
-rwxr-xr-x 1 root root 6.7M Jun 12 14:26 twimg
-rw-r&#8211;r&#8211; 1 root root  720 Jun 12 14:13 twimg.go
&#8220;`

6.7 MEG FROM A 720 BYTE FILE ?!  OK, so lets take a look at what it is and what it includes.

&#8220;` bash
root@kali:~/Go/src/twimg# file twimg
twimg: ELF 64-bit LSB executable, x86-64, version 1 (SYSV), dynamically linked (uses shared libs), not stripped
root@kali:~/Go/src/twimg# readelf -S twimg
There are 33 section headers, starting at offset 0x238:

Section Headers:
  [Nr] Name              Type             Address           Offset
       Size              EntSize          Flags  Link  Info  Align
  [ 0]                   NULL             0000000000000000  00000000
       0000000000000000  0000000000000000           0     0     0
  [ 1] .text             PROGBITS         0000000000400c00  00000c00
       000000000022574f  0000000000000000  AX       0     0     16
  [ 2] .plt              PROGBITS         0000000000626360  00226360
       0000000000000140  0000000000000010  AX       0     0     4
  [ 3] .rodata           PROGBITS         0000000000627000  00227000
       0000000000190348  0000000000000000   A       0     0     32
  [ 4] .typelink         PROGBITS         00000000007b7348  003b7348
       00000000000011c0  0000000000000000   A       0     0     8
  [ 5] .gosymtab         PROGBITS         00000000007b8508  003b8508
       0000000000000000  0000000000000000   A       0     0     1
  [ 6] .gopclntab        PROGBITS         00000000007b8520  003b8520
       00000000000cfa77  0000000000000000   A       0     0     32
  [ 7] .rela             RELA             0000000000887fa0  00487fa0
       0000000000000018  0000000000000018   A      14     0     8
  [ 8] .gnu.version      VERSYM           0000000000887fc0  00487fc0
       0000000000000032  0000000000000002   A      14     0     2
  [ 9] .gnu.version_r    VERNEED          0000000000888000  00488000
       0000000000000040  0000000000000000   A      11     2     8
  [10] .hash             HASH             0000000000888040  00488040
       0000000000000084  0000000000000004   A      14     0     8
  [11] .dynstr           STRTAB           00000000008880e0  004880e0
       000000000000016b  0000000000000000   A       0     0     1
  [12] .shstrtab         STRTAB           0000000000000000  00488260
       0000000000000185  0000000000000000           0     0     1
  [13] .rela.plt         RELA             0000000000888400  00488400
       00000000000001c8  0000000000000018   A      14     2     8
  [14] .dynsym           DYNSYM           00000000008885e0  004885e0
       0000000000000258  0000000000000018   A      11     0     8
  [15] .got              PROGBITS         0000000000889000  00489000
       0000000000000008  0000000000000008  WA       0     0     8
  [16] .got.plt          PROGBITS         0000000000889020  00489020
       00000000000000b0  0000000000000008  WA       0     0     8
  [17] .dynamic          DYNAMIC          00000000008890e0  004890e0
       0000000000000130  0000000000000010  WA      11     0     8
  [18] .noptrdata        PROGBITS         0000000000889220  00489220
       0000000000015e4c  0000000000000000  WA       0     0     32
  [19] .data             PROGBITS         000000000089f080  0049f080
       0000000000007030  0000000000000000  WA       0     0     32
  [20] .bss              NOBITS           00000000008a60c0  004a60c0
       0000000000008d80  0000000000000000  WA       0     0     32
  [21] .noptrbss         NOBITS           00000000008aee40  004aee40
       0000000000013248  0000000000000000  WA       0     0     32
  [22] .interp           PROGBITS         0000000000400be4  00000be4
       000000000000001c  0000000000000000   A       0     0     1
  [23] .symtab           SYMTAB           0000000000000000  004a7000
       000000000002f7d8  0000000000000018          24   191     8
  [24] .strtab           STRTAB           0000000000000000  004d67d8
       0000000000037778  0000000000000000           0     0     1
  [25] .tbss             NOBITS           0000000000000000  00000000
       0000000000000010  0000000000000000 WAT       0     0     8
  [26] .debug_abbrev     PROGBITS         0000000000000000  0050df50
       00000000000000fd  0000000000000000           0     0     1
  [27] .debug_line       PROGBITS         0000000000000000  0050e04d
       000000000002d725  0000000000000000           0     0     1
  [28] .debug_frame      PROGBITS         0000000000000000  0053b772
       00000000000379cc  0000000000000000           0     0     1
  [29] .debug_info       PROGBITS         0000000000000000  0057313e
       00000000000e6cac  0000000000000000           0     0     1
  [30] .debug_pubnames   PROGBITS         0000000000000000  00659dea
       000000000003eb4f  0000000000000000           0     0     1
  [31] .debug_pubtypes   PROGBITS         0000000000000000  00698939
       0000000000019406  0000000000000000           0     0     1
  [32] .debug_aranges    PROGBITS         0000000000000000  006b1d3f
       0000000000000030  0000000000000000           0     0     1
Key to Flags:
  W (write), A (alloc), X (execute), M (merge), S (strings), l (large)
  I (info), L (link order), G (group), T (TLS), E (exclude), x (unknown)
  O (extra OS processing required) o (OS specific), p (processor specific)
&#8220;`

So, a lot of debug information and symbols.  We can strip the DWARF debug information by running &#8220;`go build -ldflags &#8216;-w&#8217;&#8220;`

&#8220;` bash
root@kali:~/Go/src/twimg# go build -ldflags &#8216;-w&#8217;
root@kali:~/Go/src/twimg# ls -lah
total 5.1M
drwxr-xr-x 2 root root 4.0K Jun 12 14:28 .
drwxr-xr-x 4 root root 4.0K Jun 12 14:18 ..
-rwxr-xr-x 1 root root 5.1M Jun 12 14:28 twimg
-rw-r&#8211;r&#8211; 1 root root  720 Jun 12 14:13 twimg.go
&#8220;`

Now we&#8217;re down to 5.1M, still quite big, and symbols are still included

&#8220;` bash
root@kali:~/Go/src/twimg# readelf -S twimg
There are 26 section headers, starting at offset 0x238:

Section Headers:
  [Nr] Name              Type             Address           Offset
       Size              EntSize          Flags  Link  Info  Align
  [ 0]                   NULL             0000000000000000  00000000
       0000000000000000  0000000000000000           0     0     0
  [ 1] .text             PROGBITS         0000000000400c00  00000c00
       000000000022574f  0000000000000000  AX       0     0     16
  [ 2] .plt              PROGBITS         0000000000626360  00226360
       0000000000000140  0000000000000010  AX       0     0     4
  [ 3] .rodata           PROGBITS         0000000000627000  00227000
       0000000000190348  0000000000000000   A       0     0     32
  [ 4] .typelink         PROGBITS         00000000007b7348  003b7348
       00000000000011c0  0000000000000000   A       0     0     8
  [ 5] .gosymtab         PROGBITS         00000000007b8508  003b8508
       0000000000000000  0000000000000000   A       0     0     1
  [ 6] .gopclntab        PROGBITS         00000000007b8520  003b8520
       00000000000cfa77  0000000000000000   A       0     0     32
  [ 7] .rela             RELA             0000000000887fa0  00487fa0
       0000000000000018  0000000000000018   A      14     0     8
  [ 8] .gnu.version      VERSYM           0000000000887fc0  00487fc0
       0000000000000032  0000000000000002   A      14     0     2
  [ 9] .gnu.version_r    VERNEED          0000000000888000  00488000
       0000000000000040  0000000000000000   A      12     2     8
  [10] .hash             HASH             0000000000888040  00488040
       0000000000000084  0000000000000004   A      14     0     8
  [11] .shstrtab         STRTAB           0000000000000000  004880e0
       00000000000000dd  0000000000000000           0     0     1
  [12] .dynstr           STRTAB           00000000008881c0  004881c0
       000000000000016b  0000000000000000   A       0     0     1
  [13] .rela.plt         RELA             0000000000888340  00488340
       00000000000001c8  0000000000000018   A      14     2     8
  [14] .dynsym           DYNSYM           0000000000888520  00488520
       0000000000000258  0000000000000018   A      12     0     8
  [15] .got              PROGBITS         0000000000889000  00489000
       0000000000000008  0000000000000008  WA       0     0     8
  [16] .got.plt          PROGBITS         0000000000889020  00489020
       00000000000000b0  0000000000000008  WA       0     0     8
  [17] .dynamic          DYNAMIC          00000000008890e0  004890e0
       0000000000000130  0000000000000010  WA      12     0     8
  [18] .noptrdata        PROGBITS         0000000000889220  00489220
       0000000000015e4c  0000000000000000  WA       0     0     32
  [19] .data             PROGBITS         000000000089f080  0049f080
       0000000000007030  0000000000000000  WA       0     0     32
  [20] .bss              NOBITS           00000000008a60c0  004a60c0
       0000000000008d80  0000000000000000  WA       0     0     32
  [21] .noptrbss         NOBITS           00000000008aee40  004aee40
       0000000000013248  0000000000000000  WA       0     0     32
  [22] .interp           PROGBITS         0000000000400be4  00000be4
       000000000000001c  0000000000000000   A       0     0     1
  [23] .symtab           SYMTAB           0000000000000000  004a7000
       000000000002f7d8  0000000000000018          24   191     8
  [24] .strtab           STRTAB           0000000000000000  004d67d8
       0000000000037778  0000000000000000           0     0     1
  [25] .tbss             NOBITS           0000000000000000  00000000
       0000000000000010  0000000000000000 WAT       0     0     8
Key to Flags:
  W (write), A (alloc), X (execute), M (merge), S (strings), l (large)
  I (info), L (link order), G (group), T (TLS), E (exclude), x (unknown)
  O (extra OS processing required) o (OS specific), p (processor specific)
&#8220;`

A quick recompile without the symbols brings us down to 4.7M

&#8220;` bash
root@kali:~/Go/src/twimg# go build -ldflags &#8216;-w -s&#8217;
root@kali:~/Go/src/twimg# ls -lah
total 4.7M
drwxr-xr-x 2 root root 4.0K Jun 12 14:29 .
drwxr-xr-x 4 root root 4.0K Jun 12 14:18 ..
-rwxr-xr-x 1 root root 4.7M Jun 12 14:29 twimg
-rw-r&#8211;r&#8211; 1 root root  720 Jun 12 14:13 twimg.go
root@kali:~/Go/src/twimg# readelf -S twimg
There are 24 section headers, starting at offset 0x238:

Section Headers:
  [Nr] Name              Type             Address           Offset
       Size              EntSize          Flags  Link  Info  Align
  [ 0]                   NULL             0000000000000000  00000000
       0000000000000000  0000000000000000           0     0     0
  [ 1] .text             PROGBITS         0000000000400c00  00000c00
       000000000022574f  0000000000000000  AX       0     0     16
  [ 2] .plt              PROGBITS         0000000000626360  00226360
       0000000000000140  0000000000000010  AX       0     0     4
  [ 3] .rodata           PROGBITS         0000000000627000  00227000
       0000000000190348  0000000000000000   A       0     0     32
  [ 4] .typelink         PROGBITS         00000000007b7348  003b7348
       00000000000011c0  0000000000000000   A       0     0     8
  [ 5] .gosymtab         PROGBITS         00000000007b8508  003b8508
       0000000000000000  0000000000000000   A       0     0     1
  [ 6] .gopclntab        PROGBITS         00000000007b8520  003b8520
       00000000000cfa77  0000000000000000   A       0     0     32
  [ 7] .rela             RELA             0000000000887fa0  00487fa0
       0000000000000018  0000000000000018   A      14     0     8
  [ 8] .gnu.version      VERSYM           0000000000887fc0  00487fc0
       0000000000000032  0000000000000002   A      14     0     2
  [ 9] .gnu.version_r    VERNEED          0000000000888000  00488000
       0000000000000040  0000000000000000   A      12     2     8
  [10] .hash             HASH             0000000000888040  00488040
       0000000000000084  0000000000000004   A      14     0     8
  [11] .shstrtab         STRTAB           0000000000000000  004880e0
       00000000000000cd  0000000000000000           0     0     1
  [12] .dynstr           STRTAB           00000000008881c0  004881c0
       000000000000016b  0000000000000000   A       0     0     1
  [13] .rela.plt         RELA             0000000000888340  00488340
       00000000000001c8  0000000000000018   A      14     2     8
  [14] .dynsym           DYNSYM           0000000000888520  00488520
       0000000000000258  0000000000000018   A      12     0     8
  [15] .got              PROGBITS         0000000000889000  00489000
       0000000000000008  0000000000000008  WA       0     0     8
  [16] .got.plt          PROGBITS         0000000000889020  00489020
       00000000000000b0  0000000000000008  WA       0     0     8
  [17] .dynamic          DYNAMIC          00000000008890e0  004890e0
       0000000000000130  0000000000000010  WA      12     0     8
  [18] .noptrdata        PROGBITS         0000000000889220  00489220
       0000000000015e4c  0000000000000000  WA       0     0     32
  [19] .data             PROGBITS         000000000089f080  0049f080
       0000000000007030  0000000000000000  WA       0     0     32
  [20] .bss              NOBITS           00000000008a60c0  004a60c0
       0000000000008d80  0000000000000000  WA       0     0     32
  [21] .noptrbss         NOBITS           00000000008aee40  004aee40
       0000000000013248  0000000000000000  WA       0     0     32
  [22] .interp           PROGBITS         0000000000400be4  00000be4
       000000000000001c  0000000000000000   A       0     0     1
  [23] .tbss             NOBITS           0000000000000000  00000000
       0000000000000010  0000000000000000 WAT       0     0     8
Key to Flags:
  W (write), A (alloc), X (execute), M (merge), S (strings), l (large)
  I (info), L (link order), G (group), T (TLS), E (exclude), x (unknown)
  O (extra OS processing required) o (OS specific), p (processor specific)
&#8220;`
So, not really that much space to save.  The issue here is because the Go runtime is included.  If you plan on using the binary within environments that do not have the Go runtime installed, this is about as small as you could natively make this binary (without packing, of course - we&#8217;ll get to that later).  If you plan on only using the binary where the Go runtime is installed, we can use &#8220;`gccgo&#8220;` (at least version 4.7.3) to compile the source, and omit the inclusion of the runtime


</div>


<div class="meta">
	<div class="date">








  


<time datetime="2015-06-12T11:21:16+01:00" pubdate data-updated="true"></time></div>
	<div class="tags">

</div>
	
</div>
</article>

	<div class="share">
	<div class="addthis_toolbox addthis_default_style ">
		
		
		<a class="addthis_button_tweet"></a>
		
		
		
	</div>
	
</div>


</div>
	<footer id="footer" class="inner">Copyright &copy; 2015

    recrudesce

</footer>
	<script src="/javascripts/slash.js"></script>
<script src="/javascripts/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
	$('.fancybox').fancybox();
})(jQuery);
</script> <!-- Delete or comment this line to disable Fancybox -->




	<script type="text/javascript">
		var _gaq = _gaq || [];
		_gaq.push(['_setAccount', 'UA-52976545-1']);
		_gaq.push(['_trackPageview']);

		(function() {
			var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
			ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
			var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
		})();
	</script>



</body>
</html>